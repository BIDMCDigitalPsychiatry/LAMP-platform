<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="LAMP Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="LAMP Platform Blog Atom Feed"><title data-react-helmet="true">Using Document Transformations | LAMP Platform</title><meta data-react-helmet="true" property="og:url" content="https://docs.lamp.digital/jsonata"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Using Document Transformations | LAMP Platform"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><meta data-react-helmet="true" property="og:image" content="https://docs.lamp.digital/logo.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.lamp.digital/logo.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/./docs/assets/logo.png"><link data-react-helmet="true" rel="canonical" href="https://docs.lamp.digital/jsonata"><link data-react-helmet="true" rel="alternate" href="https://docs.lamp.digital/jsonata" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.lamp.digital/jsonata" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.75c88171.css">
<link rel="preload" href="/assets/js/styles.b006f77b.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.186aa2a6.js" as="script">
<link rel="preload" href="/assets/js/main.6f9a5eda.js" as="script">
<link rel="preload" href="/assets/js/1.f159de8f.js" as="script">
<link rel="preload" href="/assets/js/2.bd8092b6.js" as="script">
<link rel="preload" href="/assets/js/3.38c107f0.js" as="script">
<link rel="preload" href="/assets/js/1be78505.6a8119be.js" as="script">
<link rel="preload" href="/assets/js/277.6d1993e4.js" as="script">
<link rel="preload" href="/assets/js/ac3cc3f5.fec89e66.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.197e5422.js" as="script">
<link rel="preload" href="/assets/js/17896441.ce6f172a.js" as="script">
<link rel="preload" href="/assets/js/1ef91c47.93bf4537.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/logo.png" alt="LAMP Platform" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/logo.png" alt="LAMP Platform" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">LAMP Platform</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">User Guide</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/app">Download App</a></li><li><a class="dropdown__link" href="/bug">Report Bug</a></li><li><a class="dropdown__link" href="/faq">FAQ</a></li></ul></div><a class="navbar__item navbar__link" href="/api">API</a><a class="navbar__item navbar__link" href="/blog">What&#x27;s New</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://mindlamp.discourse.group/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a href="https://github.com/BIDMCDigitalPsychiatry/LAMP-platform/" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="mailto:team@digitalpsych.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Contact</a></li></ul></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/logo.png" alt="LAMP Platform" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/logo.png" alt="LAMP Platform" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">LAMP Platform</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/app">Download App</a></li><li class="menu__list-item"><a class="menu__link" href="/bug">Report Bug</a></li><li class="menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/api">API</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">What&#x27;s New</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a href="https://mindlamp.discourse.group/" target="_blank" rel="noopener noreferrer" class="menu__link">Forum</a></li><li class="menu__list-item"><a href="https://github.com/BIDMCDigitalPsychiatry/LAMP-platform/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="mailto:team@digitalpsych.org" target="_blank" rel="noopener noreferrer" class="menu__link">Contact</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Using Document Transformations</h1></header><div class="markdown"><p>Overview</p><p>The LAMP Platform supports Document Transformations using the JSONata query language developed by IBM. <a href="https://docs.jsonata.org/" target="_blank" rel="noopener noreferrer">The following documentation is extracted from the JSONata documentation website.</a></p><p>The following methods corresponding to API calls have been added to the JSONata engine:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.ActivityEvent.list(participant_id: string, origin: string | null, from: number | null, to: number | null, limit: number | null) =&gt; ActivityEvent[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.ActivityEvent.create(participant_id: string, activity_events: ActivityEvent | ActivityEvent[]) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Activity.list(study_id: string, ignore_binary: boolean = true, sibling: boolean = false) =&gt; Activity[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Activity.create(activity_id: string, activity: Activity) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Activity.get(activity_id: string) =&gt; Activity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Activity.set(activity_id: string, activity: Activity | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.ActivitySpec.list() =&gt; ActivitySpec[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.ActivitySpec.create(activity_spec: ActivitySpec) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.ActivitySpec.get(activity_spec_id: string) =&gt; ActivitySpec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.ActivitySpec.set(activity_spec_id: string, activity_spec: ActivitySpec | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Credential.list(type_id: string | null) =&gt; Credential[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Credential.create(type_id: string | null, credential: Credential) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Credential.get(type_id: string | null, access_key: string) =&gt; Credential</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Credential.set(type_id: string | null, access_key: string, credential: Credential | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Participant.list(study_id: string, sibling: boolean = false) =&gt; Participant[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Participant.create(study_id: string, participant: Participant) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Participant.get(participant_id: string) =&gt; Participant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Participant.set(participant_id: string, participant: Participant) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Researcher.list() =&gt; Researcher[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Researcher.create(researcher: Researcher) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Researcher.get(researcher_id: string) =&gt; Researcher</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Researcher.set(researcher_id: string, researcher: Researcher | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.SensorEvent.list(participant_id: string, origin: string | null, from: number | null, to: number | null, limit: number | null) =&gt; SensorEvent[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.SensorEvent.create(participant_id: string, sensor_events: SensorEvent | SensorEvent[]) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Sensor.list(study_id: string, ignore_binary: boolean = true, sibling: boolean = false) =&gt; Sensor[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Sensor.create(study_id: string, sensor: Sensor) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Sensor.get(sensor_id: string) =&gt; Sensor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Sensor.set(sensor_id: string, sensor: Sensor | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.SensorSpec.list() =&gt; SensorSpec[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.SensorSpec.create(sensor_spec: SensorSpec) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.SensorSpec.get(sensor_spec_id: string) =&gt; SensorSpec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.SensorSpec.set(sensor_spec_id: string, sensor_spec: SensorSpec | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Study.list(researcher_id: string) =&gt; Study[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Study.create(researcher_id: string, study: Study) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Study.get(study_id: string) =&gt; Study</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Study.set(study_id: string, study: Study | null) =&gt; void</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Type.parent(type_id: string) =&gt; string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Tag.list(type_id: string) =&gt; string[]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Tag.get(type_id: string, attachment_key: string) =&gt; any</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$LAMP.Tag.set(type_id: string, attachment_key: string, target: string, attachment_value: string) =&gt; void</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>JSONata is a lightweight query and transformation language for JSON data. Inspired by the &#x27;location path&#x27; semantics of XPath 3.1, it allows sophisticated queries to be expressed in a compact and intuitive notation.  A rich complement of built in operators and functions is provided for manipulating and combining extracted data, and the results of queries can be formatted into any JSON output structure using familiar JSON object and array syntax. Coupled with the facility to create user defined functions, advanced expressions can be built to tackle any JSON query and transformation task. <a href="http://try.jsonata.org/" target="_blank" rel="noopener noreferrer">Try it out here.</a></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="simple-queries"></a>Simple Queries<a class="hash-link" href="#simple-queries" title="Direct link to heading">#</a></h1><p>To support the extraction of values from a JSON structure, a location path syntax is defined. In common with XPath, this will select all possible values in the document that match the specified location path.  The two structural constructs of JSON are objects and arrays.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="navigating-json-objects"></a>Navigating JSON Objects<a class="hash-link" href="#navigating-json-objects" title="Direct link to heading">#</a></h2><p>A JSON object is an associative array (a.k.a map or hash). The location path syntax to navigate into an arbitrarily deeply nested structure of JSON objects comprises the field names separated by dot &#x27;.&#x27; delimiters. The expression returns the JSON value referenced after navigating to the last step in the location path.  If during the navigation of the location path, a field is not found, then the expression returns nothing (represented by Javascript <em>undefined</em>).  No errors are thrown as a result of non-existing data in the input document.</p><p>The following sample JSON document is used by examples throughout this guide, unless otherwise indicated:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;FirstName&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Fred&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Surname&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Smith&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Age&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Street&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hursley Park&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;City&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Winchester&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Postcode&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SO21 2JN&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Phone&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;home&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;number&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0203 544 1234&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;office&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;number&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;01962 001234&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;office&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;number&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;01962 001235&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;mobile&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;number&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;077 7700 1234&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Email&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;work&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fred.smith@my-work.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fsmith@my-work.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;home&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;freddy@my-social.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;frederic.smith@very-serious.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Other&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Over 18 ?&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Misc&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token null keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Alternative.Address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Street&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Brick Lane&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;City&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;London&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Postcode&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;E1 6RF&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples"></a>Examples<a class="hash-link" href="#examples" title="Direct link to heading">#</a></h4><p>Here are some example expressions and their results when applied to the above JSON document:</p><ul><li><p>Returns a JSON string (&quot;double quoted&quot;)</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Surname</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Smith&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Returns a JSON number</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Age</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">28</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Field references are separated by &#x27;.&#x27;</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Address.City</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Winchester&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Matched the path and returns the null value</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Other.Misc</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">null</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Path not found.  Returns nothing (i.e. Javascript <em>undefined</em>)
<strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Other.Nothing</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Field references containing whitespace or reserved tokens can be enclosed in backticks</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Other.`Over 18 ?`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="navigating-json-arrays"></a>Navigating JSON Arrays<a class="hash-link" href="#navigating-json-arrays" title="Direct link to heading">#</a></h2><p>JSON arrays are used when an ordered collection of values is required.  Each value in the array is associated with an index (position) rather than a name, so in order to address individual values in an array, extra syntax is required to specify the index.  This is done using square brackets after the field name of the array.  If the square brackets contains a number, or an expression that evaluates to a number, then the number represents the index of the value to select.  Indexes are zero offset, i.e. the first value in an array <code>arr</code> is <code>arr[0]</code>.  If the number is not an integer, then it is rounded <em>down</em> to an integer.  If the expression in square brackets is non-numeric, or is an expression that doesn&#x27;t evaluate to a number, then it is treated as a <a href="#predicates">predicate</a>.</p><p>Negative indexes count from the end of the array, for example, <code>arr[-1]</code> will select the last value, <code>arr[-2]</code> the second to last, etc. If an index is specified that exceeds the size of the array, then nothing is selected.</p><p>If no index is specified for an array (i.e. no square brackets after the field reference), then the whole array is selected. If the array contains objects, and the location path selects fields within these objects, then each object within the array will be queried for selection.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples-1"></a>Examples<a class="hash-link" href="#examples-1" title="Direct link to heading">#</a></h4><ul><li><p>Returns the first item (an object)</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[0]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;home&quot;, &quot;number&quot;: &quot;0203 544 1234&quot; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Returns the second item</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[1]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;office&quot;, &quot;number&quot;: &quot;01962 001234&quot; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Returns the last item</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[-1]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;mobile&quot;, &quot;number&quot;: &quot;077 7700 1234&quot; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Negative indexed count from the end</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[-2]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;office&quot;, &quot;number&quot;: &quot;01962 001235&quot; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Doesn&#x27;t exist - returns nothing
<strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[8]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Selects the <code>number</code> field in the first item</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[0].number</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;0203 544 1234&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>No index is given to <code>Phone</code> so it selects all of them (the whole array), then it selects all the <code>number</code> fields for each of them</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone.number</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;0203 544 1234&quot;, &quot;01962 001234&quot;, &quot;01962 001235&quot;, &quot;077 7700 1234&quot; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Might expect it to just return the first number, but it returns the first number of each of the items selected by <code>Phone</code></p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone.number[0]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;0203 544 1234&quot;, &quot;01962 001234&quot;, &quot;01962 001235&quot;, &quot;077 7700 1234&quot; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Applies the index to the array returned by <code>Phone.number</code>. One use of <a href="#parenthesized-expressions-and-blocks">parentheses</a>.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(Phone.number)[0]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;0203 544 1234&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Returns a range of items by creating an array of indexes</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[[0..1]]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;home&quot;, &quot;number&quot;: &quot;0203 544 1234&quot; },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;office&quot;, &quot;number&quot;: &quot;01962 001234&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="result-sequences"></a>Result sequences<a class="hash-link" href="#result-sequences" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sequence-flattening"></a>Sequence flattening<a class="hash-link" href="#sequence-flattening" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="empty-sequences-and-singleton-sequences"></a>Empty sequences and singleton sequences<a class="hash-link" href="#empty-sequences-and-singleton-sequences" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="top-level-arrays-nested-arrays-and-array-flattening"></a>Top level arrays, nested arrays and array flattening<a class="hash-link" href="#top-level-arrays-nested-arrays-and-array-flattening" title="Direct link to heading">#</a></h3><p>Consider the JSON document:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;ref&quot;: [ 1,2 ] },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;ref&quot;: [ 3,4 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>At the top level, we have an array rather than an object.  If we want to select the first object in this top level array, we don&#x27;t have a field name to append the <code>[0]</code> to.  We can&#x27;t use <code>[0]</code> on its own because that clashes with the <a href="#array-constructors">array constructor</a> syntax.  However, we can use the <em>context</em> reference <code>$</code> to refer to the start of the document as follows:</p><ul><li><p><code>$</code> at the start of an expression refers to the entire input document</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$[0]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;ref&quot;: [ 1,2 ] }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p><code>.ref</code> here returns the entire internal array</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$[0].ref</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ 1,2 ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>returns element on first position of the internal array</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$[0].ref[0]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Despite the structure of the nested array, the resultant selection is flattened into a single flat array.  The original nested structure of the input arrays is lost. See <a href="#array-constructors">Array constructors</a> for how to maintain the original structure in the results.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$.ref</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ 1, 2, 3, 4 ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="query-refinement-using-predicate-expressions"></a>Query refinement using predicate expressions<a class="hash-link" href="#query-refinement-using-predicate-expressions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="predicates"></a>Predicates<a class="hash-link" href="#predicates" title="Direct link to heading">#</a></h2><p>At any step in a location path, the selected items can be filtered using a predicate - <code>[expr]</code> where <code>expr</code> evaluates to a Boolean value.  Each item in the selection is tested against the expression, if it evaluates to <code>true</code>, then the item is kept; if <code>false</code>, it is removed from the selection. The expression is evaluated relative to the current (context) item being tested, so if the predicate expression performs navigation, then it is relative to this context item.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples-2"></a>Examples:<a class="hash-link" href="#examples-2" title="Direct link to heading">#</a></h4><ul><li><p>Select the <code>Phone</code> items that have a <code>type</code> field that equals <code>&quot;mobile&quot;</code>.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[type=&#x27;mobile&#x27;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;type&quot;: &quot;mobile&quot;,  &quot;number&quot;: &quot;077 7700 1234&quot; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Select the mobile phone number</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[type=&#x27;mobile&#x27;].number</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;077 7700 1234&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Select the office phone numbers - there are two of them!</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone[type=&#x27;office&#x27;].number</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;01962 001234&quot;,  &quot;01962 001235&quot; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="singleton-array-and-value-equivalence"></a>Singleton array and value equivalence<a class="hash-link" href="#singleton-array-and-value-equivalence" title="Direct link to heading">#</a></h2><p>Within a JSONata expression or subexpression, any value (which is not itself an array) and an array containing just that value are deemed to be equivalent.  This allows the language to be composable such that location paths that extract a single value from and object and location paths that extract multiple values from arrays can both be used as inputs to other expressions without needing to use different syntax for the two forms.</p><p>Consider the following examples:</p><ul><li><code>Address.City</code> returns the single value <code>&quot;Winchester&quot;</code></li><li><code>Phone[0].number</code> matches a single value, and returns that value <code>&quot;0203 544 1234&quot;</code></li><li><code>Phone[type=&#x27;home&#x27;].number</code> likewise matches the single value <code>&quot;0203 544 1234&quot;</code></li><li><code>Phone[type=&#x27;office&#x27;].number</code> matches two values, so returns an array <code>[ &quot;01962 001234&quot;,  &quot;01962 001235&quot; ]</code></li></ul><p>When processing the return value of a JSONata expression, it might be desirable to have the results in a consistent format regardless of how many values were matched.  In the first two expressions above, it is clear that each expression is addressing a single value in the structure and it makes sense to return just that value.  In the last two expressions, however, it is not immediately obvious how many values will be matched, and it is not helpful if the host language has to process the results in different ways depending on what gets returned.</p><p>If this is a concern, then the expression can be modified to make it return an array even if only a single value is matched. This is done by adding empty square brackets <code>[]</code> to a step within the location path.  The examples above can be re-written to always return an array as follows:</p><ul><li><code>Address[].City</code> returns <code>[ &quot;Winchester&quot;] </code></li><li><code>Phone[0][].number</code> returns <code>[ &quot;0203 544 1234&quot; ]</code></li><li><code>Phone[][type=&#x27;home&#x27;].number</code> returns <code>[ &quot;0203 544 1234&quot; ]</code></li><li><code>Phone[type=&#x27;office&#x27;].number[]</code> returns <code>[ &quot;01962 001234&quot;,  &quot;01962 001235&quot; ]</code></li></ul><p>Note that the <code>[]</code> can be placed either side of the predicates and on any step in the path expression</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="wildcards"></a>Wildcards<a class="hash-link" href="#wildcards" title="Direct link to heading">#</a></h2><p>Use of <code>*</code> instead of field name to select all fields in an object</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples-3"></a>Examples<a class="hash-link" href="#examples-3" title="Direct link to heading">#</a></h4><ul><li><p>Select the values of all the fields of <code>Address</code></p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Address.*</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;Hursley Park&quot;, &quot;Winchester&quot;, &quot;SO21 2JN&quot; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Select the <code>Postcode</code> value of any child object</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">*.Postcode</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;SO21 2JN&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="navigate-arbitrary-depths"></a>Navigate arbitrary depths<a class="hash-link" href="#navigate-arbitrary-depths" title="Direct link to heading">#</a></h2><p>Descendant wildcard <code>**</code> instead of <code>*</code> will traverse all descendants (multi-level wildcard).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples-4"></a>Examples<a class="hash-link" href="#examples-4" title="Direct link to heading">#</a></h4><ul><li><p>Select all <code>Postcode</code> values, regardless of how deeply nested they are in the structure</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">**.Postcode</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;SO21 2JN&quot;, &quot;E1 6RF&quot; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="manipulating-data-with-functions-and-expressions"></a>Manipulating data with functions and expressions<a class="hash-link" href="#manipulating-data-with-functions-and-expressions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="string-expressions"></a>String expressions<a class="hash-link" href="#string-expressions" title="Direct link to heading">#</a></h2><p>Path expressions that point to a string value will return that value.</p><p>String literals can also be created by enclosing the
sequence of characters in quotes. Either double quotes <code>&quot;</code> or single quotes <code>&#x27;</code> can be used, provided the same quote type is
used for the start and end of the string literal.  Single quote characters may be included within a double quoted string and
<em>vice versa</em> withought escaping.  Characters within the string literal may be escaped using the same format
as <a href="https://tools.ietf.org/html/rfc7159#section-7" target="_blank" rel="noopener noreferrer">JSON strings</a>.</p><p>Strings can be combined using the concatenation operator <code>&amp;</code>. This is an infix operator and will join the two strings
returned by the expressions either side of it.  This is the only operator that will attempt to typecast its operands to
the expected (string) type.</p><p><strong>Examples</strong></p><ul><li><p>Concatenate <code>FirstName</code> followed by space followed by <code>Surname</code></p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FirstName &amp; &#x27; &#x27; &amp; Surname</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Fred Smith&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Concatenates the <code>Street</code> and <code>City</code> from the <code>Address</code> object with a comma separator. Note the use of <a href="#parenthesized-expressions-and-blocks">parentheses</a></p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Address.(Street &amp; &#x27;, &#x27; &amp; City)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Hursley Park, Winchester&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Casts the operands to strings, if necessary</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">5&amp;0&amp;true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;50true&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="numeric-expressions"></a>Numeric expressions<a class="hash-link" href="#numeric-expressions" title="Direct link to heading">#</a></h2><p>Path expressions that point to a number value will return that value.  </p><p>Numeric literals can also be created using the same syntax as <a href="https://tools.ietf.org/html/rfc7159#section-6" target="_blank" rel="noopener noreferrer">JSON numbers</a>.</p><p>Numbers can be combined using the usual mathematical operators to produce a resulting number.  Supported operators:</p><ul><li><code>+</code> addition</li><li><code>-</code> subtraction</li><li><code>*</code> multiplication</li><li><code>/</code> division</li><li><code>%</code> remainder (modulo)</li></ul><p><strong>Examples</strong></p><p>Consider the following JSON document:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Numbers&quot;: [1, 2.4, 3.5, 10, 20.9, 30]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><table><thead><tr><th>Expression</th><th>Output</th><th>Comments</th></tr></thead><tbody><tr><td><code>Numbers[0] + Numbers[1]</code></td><td>3.4</td><td>Adding 2 prices</td></tr><tr><td><code>Numbers[0] - Numbers[4]</code></td><td>-19.9</td><td>Subtraction</td></tr><tr><td><code>Numbers[0] * Numbers[5]</code></td><td>30</td><td>Multiplying price by quantity</td></tr><tr><td><code>Numbers[0] / Numbers[4]</code></td><td>0.04784688995215</td><td>Division</td></tr><tr><td><code>Numbers[2] % Numbers[5]</code></td><td>3.5</td><td>Modulo operator</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="comparison-expressions"></a>Comparison expressions<a class="hash-link" href="#comparison-expressions" title="Direct link to heading">#</a></h2><p>Often used in predicates, for comparison of two values.  Returns Boolean <code>true</code> or <code>false</code>. Supported operators:</p><ul><li><code>=</code> equals</li><li><code>!=</code> not equals</li><li><code>&lt;</code> less than</li><li><code>&lt;=</code> less than or equal</li><li><code>&gt;</code> greater than</li><li><code>&gt;=</code> greater than or equal</li><li><code>in</code> value is contained in an array</li></ul><p><strong>Examples</strong></p><table><thead><tr><th>Expression</th><th>Output</th><th>Comments</th></tr></thead><tbody><tr><td><code>Numbers[0] = Numbers[5]</code></td><td>false</td><td>Equality</td></tr><tr><td><code>Numbers[0] != Numbers[4]</code></td><td>true</td><td>Inequality</td></tr><tr><td><code>Numbers[1] &lt; Numbers[5]</code></td><td>true</td><td>Less than</td></tr><tr><td><code>Numbers[1] &lt;= Numbers[5]</code></td><td>true</td><td>Less than or equal</td></tr><tr><td><code>Numbers[2] &gt; Numbers[4]</code></td><td>false</td><td>Greater than</td></tr><tr><td><code>Numbers[2] &gt;= Numbers[4]</code></td><td>false</td><td>Greater than or equal</td></tr><tr><td><code>&quot;01962 001234&quot; in Phone.number</code></td><td>true</td><td>Value is contained in</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boolean-expressions"></a>Boolean expressions<a class="hash-link" href="#boolean-expressions" title="Direct link to heading">#</a></h2><p>Used to combine Boolean results, often to support more sophisticated predicate expressions. Supported operators:</p><ul><li><code>and</code></li><li><code>or</code></li></ul><p>Note that <code>not</code> is supported as a function, not an operator.</p><p><strong>Examples</strong></p><table><thead><tr><th>Expression</th><th>Output</th><th>Comments</th></tr></thead><tbody><tr><td><code>(Numbers[2] != 0) and (Numbers[5] != Numbers[1])</code></td><td>true</td><td><code>and</code> operator</td></tr><tr><td><code>(Numbers[2] != 0) or (Numbers[5] = Numbers[1])</code></td><td>true</td><td><code>or</code> operator</td></tr></tbody></table><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="building-result-structures"></a>Building result structures<a class="hash-link" href="#building-result-structures" title="Direct link to heading">#</a></h1><p>So far, we have discovered how to extract values from a JSON document, and how to manipulate the data using numeric, string and other operators.  It is useful to be able to specify how this processed data is presented in the output.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="array-constructors"></a>Array constructors<a class="hash-link" href="#array-constructors" title="Direct link to heading">#</a></h2><p>As previously observed, when a location path matches multiple values in the input document, these values are returned as an array.  The values might be objects or arrays, and as such will have their own structure, but the <em>matched values</em> themselves are at the top level in the resultant array.</p><p>It is possible to build extra structure into the resultant array by specifying the construction of arrays (or <a href="#object-constructors">objects</a>) within the location path expression.  At any point in a location path where a field reference is expected, a pair of square brackets <code>[]</code> can be inserted to specify that the results of the expression within those brackets should be contained within a new array in the output.  Commas are used to separate multiple expressions within the array constructor.</p><p>Array constructors can also be used within location paths for making multiple selections without the broad brush use of wildcards.</p><p><strong>Examples</strong></p><ul><li><p>The four email addresses are returned in a flat array.</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Email.address</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;fred.smith@my-work.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;fsmith@my-work.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;freddy@my-social.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;frederic.smith@very-serious.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Each email object generates an array of addresses.</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Email.[address]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;fred.smith@my-work.com&quot;,  &quot;fsmith@my-work.com&quot; ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;freddy@my-social.com&quot;, &quot;frederic.smith@very-serious.com&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Selects the <code>City</code> value of both <code>Address</code> and <code>Alternative.Address</code> objects.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[Address, Other.`Alternative.Address`].City</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ &quot;Winchester&quot;, &quot;London&quot; ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="object-constructors"></a>Object constructors<a class="hash-link" href="#object-constructors" title="Direct link to heading">#</a></h2><p>In a similar manner to the way arrays can be constructed, JSON objects can also be constructed in the output.  At any point in a location path where a field reference is expected, a pair of braces <code>{}</code> containing key/value pairs separated by commas, with each key and value separated by a colon: <code>{key1: value2, key2:value2}</code>.  The keys and values can either be literals or can be expressions. The key must either be a string or an expression that evaluates to a string.</p><p>When an object constructor follows an expression that selects multiple values, the object constructor will create a single object that contains a key/value pair for each of those context values.  If an array of objects is required (one for each context value), then the object constructor should immediately follow the dot &#x27;.&#x27; operator.</p><p><strong>Examples</strong></p><ul><li><p>Produces an array of objects (one for each phone).</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone.{type: number}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;home&quot;: &quot;0203 544 1234&quot; }, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;office&quot;: &quot;01962 001234&quot; }, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;office&quot;: &quot;01962 001235&quot; }, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;mobile&quot;: &quot;077 7700 1234&quot;  } </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Combines the key/value pairs into a single object.  See <a href="#sorting-grouping">Grouping using object key expression</a> for more details.</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone{type: number}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;home&quot;: &quot;0203 544 1234&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;office&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;01962 001234&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;01962 001235&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;mobile&quot;: &quot;077 7700 1234&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Combines the key/value pairs into a single object.  In this case, for consistency, all numbers are grouped into arrays. See <a href="#singleton-array-and-value-equivalence">Singleton array and value equivalence</a> for more details.</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Phone{type: number[]}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;home&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;0203 544 1234&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;office&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;01962 001234&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;01962 001235&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;mobile&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;077 7700 1234&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="json-literals"></a>JSON literals<a class="hash-link" href="#json-literals" title="Direct link to heading">#</a></h2><p>The array and object constructors use the standard JSON syntax for JSON arrays and JSON objects.  In addition to this values of the other JSON data types can be entered into an expression using their native JSON syntax:</p><ul><li>strings - <code>&quot;hello world&quot;</code></li><li>numbers - <code>34.5</code></li><li>Booleans - <code>true</code> or <code>false</code></li><li>nulls - <code>null</code></li><li>objects - <code>{&quot;key1&quot;: &quot;value1&quot;, &quot;key2&quot;: &quot;value2&quot;}</code></li><li>arrays - <code>[&quot;value1&quot;, &quot;value2&quot;]</code></li></ul><p><strong>JSONata is a superset of JSON.</strong> This means that any valid JSON document is also a valid JSONata expression.  This property allows you to use a JSON document as a template for the desired output, and then replace parts of it with expressions to insert data into the output from the input document.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="query-composition"></a>Query composition<a class="hash-link" href="#query-composition" title="Direct link to heading">#</a></h1><p>In JSONata, everything is an <em>expression</em>. An expression comprises <em>values</em>, <em>functions</em> and <em>operators</em> which, when <em>evaluated</em>, produces a resulting value.  Functions and operators are applied to values which themselves can be the results of evaluating sub-expressions. In that way, the language is fully <em>composable</em> to any level of complexity.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="parenthesized-expressions-and-blocks"></a>Parenthesized expressions and blocks<a class="hash-link" href="#parenthesized-expressions-and-blocks" title="Direct link to heading">#</a></h2><p>Used to override the operator precedence rules.  E.g.</p><ul><li><code>(5 + 3) * 4</code></li></ul><p>Used to compute complex expressions on a context value</p><ul><li><code>Product.(Price * Quantity)</code> - both Price and Quantity are properties of the Product object</li></ul><p>Used to support &#x27;code blocks&#x27; - multiple expressions, separated by semicolons</p><ul><li><code>(expr1; expr2; expr3)</code></li></ul><p>Each expression in the block is evaluated <em>in sequential order</em>; the result of the last expression is returned from the block.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sorting-grouping-and-aggregation"></a>Sorting, Grouping and Aggregation<a class="hash-link" href="#sorting-grouping-and-aggregation" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sorting"></a>Sorting<a class="hash-link" href="#sorting" title="Direct link to heading">#</a></h2><p>Arrays contain an ordered collection of values.  If you need to re-order the values, then the array must be sorted.  In JSONata, there are two ways of sorting an array:</p><ol><li><p>Using the <a href="#sort"><code>$sort()</code></a> function.</p></li><li><p>Using the <a href="#order-by-">order-by</a> operator.</p></li></ol><p>The <a href="#order-by-">order-by</a> operator is a convenient syntax that can used directly in a path expression to sort the result sequences in ascending or descending order.  The <a href="#sort"><code>$sort()</code></a> function requires more syntax to be written, but is more flexible and supports custom comparator functions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="grouping"></a>Grouping<a class="hash-link" href="#grouping" title="Direct link to heading">#</a></h2><p>The JSONata <a href="#object-constructors">object constructor</a> syntax allows you to specify an expression for the key in any key/value pair (the value can obviously be an expression too). The key expression must evaluate to a string since this is a restriction on JSON objects.  The key and value expressions are evaluated for each item in the input context (see <a href="#the-jsonata-processing-model">processing model</a>). The result of each key/value expression pair is inserted into the resulting JSON object.</p><p>If the evaluation of any key expression results in a key that is already in the result object, then the result of its associated value expression will be grouped with the value(s) already associated with that key. Note that the value expressions are not evaluated until all of the grouping has been performed.  This allows for aggregation expressions to be evaluated over the collection of items for each group.</p><p><strong>Examples</strong></p><ul><li><p>Group all of the product sales by name, with the price of each item in each group</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product{`Product Name`: Price}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Bowler Hat&quot;: [ 34.45, 34.45 ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Trilby hat&quot;: 21.67,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Cloak&quot;: 107.99</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Group all of the product sales by name, with the price and the quantity of each item in each group</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">`Product Name`: {&quot;Price&quot;: Price, &quot;Qty&quot;: Quantity}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Bowler Hat&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Price&quot;: [ 34.45, 34.45 ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Qty&quot;: [ 2, 4 ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Trilby hat&quot;: { &quot;Price&quot;: 21.67, &quot;Qty&quot;: 1 },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Cloak&quot;: { &quot;Price&quot;: 107.99, &quot;Qty&quot;: 1 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p>Note in the above example, the value expression grouped all of the prices together and all of the quantities together into separate arrays.  This is because the context value is the sequence of all grouped Products and the <code>Price</code> expression will select all prices from all products.  If you want to collect the price and quantity into individual objects, then you need to evaluate the object constructor <em>for each</em> product in the context sequence.  The following example shows this.</p><ul><li><p>Explicit use of <code>$.{ ... }</code> to create an object for each item in the group.</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">`Product Name`: $.{&quot;Price&quot;: Price, &quot;Qty&quot;: Quantity}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Bowler Hat&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;Price&quot;: 34.45, &quot;Qty&quot;: 2 },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;Price&quot;: 34.45, &quot;Qty&quot;: 4 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Trilby hat&quot;: { &quot;Price&quot;: 21.67, &quot;Qty&quot;: 1 },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Cloak&quot;: { &quot;Price&quot;: 107.99, &quot;Qty&quot;: 1 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Multiply the Price by the Quantity for each product in each group</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product{`Product Name`: $.(Price*Quantity)}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Bowler Hat&quot;: [ 68.9, 137.8 ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Trilby hat&quot;: 21.67,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Cloak&quot;: 107.99</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>The total aggregated value in each group</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product{`Product Name`: $sum($.(Price*Quantity))}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Bowler Hat&quot;: 206.7,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Trilby hat&quot;: 21.67,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Cloak&quot;: 107.99</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aggregation"></a>Aggregation<a class="hash-link" href="#aggregation" title="Direct link to heading">#</a></h2><p>Often queries are just required to return aggregated results from a set of matching values.  A number of aggregation functions are available which return a single aggregated value when applied to an array of values.</p><p><strong>Examples</strong></p><ul><li><p>Total price of each product in each order</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$sum(Account.Order.Product.Price)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">198.56</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>More likely want to add up the total of the price times quantity for each order</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$sum(Account.Order.Product.(Price*Quantity))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">336.36</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p>Other <a href="#aggregation-functions">numeric aggregation functions</a> are available (i.e. average, min, max) and an <a href="#join">aggregator for strings</a>.  It is also possible to write complex custom aggregators using the <a href="#reduce"><code>$reduce()</code></a> higher-order function.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-jsonata-processing-model"></a>The JSONata processing model<a class="hash-link" href="#the-jsonata-processing-model" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-jsonata-type-system"></a>The JSONata type system<a class="hash-link" href="#the-jsonata-type-system" title="Direct link to heading">#</a></h2><p>JSONata is a superset of JSON and the JSONata type system is a superset of the JSON data types.  In common with all functional programming languages, the function is also a first-class data type.  The following data types are supported by JSONata:</p><ul><li>string</li><li>number</li><li>Boolean</li><li>null</li><li>object</li><li>array</li><li>function</li></ul><p>All but the last one are in common with JSON.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sequences"></a>Sequences<a class="hash-link" href="#sequences" title="Direct link to heading">#</a></h2><p>JSONata has been designed foremost as a query language, whereby a path expression can select zero, one or more than one values from the JSON document.  These values, each of which can be of any of the types listed above, are returned as a <em>result sequence</em>.  During the evaluation of expressions, which involves the results of subexpressions being combined or becoming the context inputs to other subexpressions, the sequences are subject to the process of <em>sequence flattening</em>.</p><p>The sequence flattening rules are as follows:</p><ol><li><p>An <strong>empty sequence</strong> is a sequence with no values and is considered to be &#x27;nothing&#x27; or &#x27;no match&#x27;.  It won&#x27;t appear in the output of any expression. If it is associated with an object property (key/value) pair in a result object, then that object will not have that property.</p></li><li><p>A <strong>singleton sequence</strong> is a sequence containing a single value.  It is considered equivalent to that value itself, and the output from any expression, or sub-expression will be that value without any surrounding structure.</p></li><li><p>A sequence containing more than one value is represented in the output as a JSON array.  This is still internally flagged as a sequence and subject to the next rule.  Note that if an expression matches an array from the input JSON, or a JSON array is explicitly constructed in the query using the <a href="#array-constructors">array constructor</a>, then this remains an array of values rather than a sequence of values and will not be subject to the sequence flattening rules.  However, if this array becomes the context of a subsequent expression, then the result of that <em>will</em> be a sequence.</p></li><li><p>If a sequence contains one or more (sub-)sequences, then the values from the sub-sequence are pulled up to the level of the outer sequence.  A result sequence will never contain child sequences (they are flattened).</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="jsonata-path-processing"></a>JSONata path processing<a class="hash-link" href="#jsonata-path-processing" title="Direct link to heading">#</a></h2><p>The JSONata path expression is a <em>declarative functional</em> language.</p><p><strong>Functional</strong> because it is based on the map/filter/reduce programming paradigm as supported by popular functional programming languages through the use of higher-order functions.</p><p><strong>Declarative</strong> because these higher-order functions are exposed through a lightweight syntax which lets the user focus on the intention of the query (declaration) rather than the programming constructs that control their evaluation.</p><p>A path expression is a sequence of one or more of the following functional stages:</p><table><thead><tr><th>Stage</th><th>Syntax</th><th>Action</th></tr></thead><tbody><tr><td><strong>Map</strong></td><td>seq<code>.</code>expr</td><td>Evaluates the RHS expression in the context of each item in the input sequence.  Flattens results into result sequence.</td></tr><tr><td><strong>Filter</strong></td><td>seq<code>[</code>expr<code>]</code></td><td>Filter results from previous stage by applying predicate expression between brackets to each item.</td></tr><tr><td><strong>Sort</strong></td><td>seq<code>^(</code>expr<code>)</code></td><td>Sorts (re-orders) the input sequence according to the criteria in parentheses.</td></tr><tr><td><strong>Index</strong></td><td>seq<code>#</code>$var</td><td>Binds a named variable to the current context position (zero offset) in the sequence.</td></tr><tr><td><strong>Join</strong></td><td>seq<code>@</code>$var</td><td>Binds a named variable to the current current context item in the sequence.  Can only be used directly following a map stage.</td></tr><tr><td><strong>Reduce</strong></td><td>seq<code>{</code> expr<code>:</code>expr<code>,</code> expr<code>:</code>expr ...<code>}</code></td><td>Group and aggregate the input sequence to a single result object as defined by the name/value expressions.  Can only appear as the final stage in a path expression.</td></tr></tbody></table><p>In the above table:</p><ul><li>In the &#x27;Syntax&#x27; column, &#x27;seq&#x27; refers to the input sequence for the current stage, which is the result sequence from the previous stage.</li><li>The &#x27;Action&#x27; column gives a brief outline of the stage&#x27;s behavior; fuller details are in the <a href="#path-operators">Path Operators</a> reference page.</li><li>The relative precedence of each operator affects the scope of its influence on the input sequence. Specifically,<ul><li>The Filter operator binds tighter than the Map operator.  This means, for example, that <code>books.authors[0]</code> will select the all of the first authors from <em>each</em> book rather than the first author from all of the books.</li><li>The Sort (order-by) operator has the lowest precedence, meaning that the full path to the left of it will be evaluated, and its result sequence will be sorted.</li><li>This operator precedence can be overridden by using parentheses.  For example, <code>(books.authors)[0]</code> will select the the first author from all of the books (single value).  Note, however, that parentheses also define a scope frame for variables, so any variables that have been bound within the parentheses block including those bound by the <code>@</code> and <code>#</code> operators will go out of scope at the end of the parens block.</li></ul></li><li>The variables bound by the <code>@</code> and <code>#</code> operators go out of scope at the end of the path expression.<ul><li>The Reduce stage, if used, will terminate the current path expression.  Although a Map operator can immediately follow this, it will be interpreted as the start of a new path expression, meaning that any previously bound context or index variables will be out of scope.</li></ul></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functional-programming-constructs"></a>Functional programming constructs<a class="hash-link" href="#functional-programming-constructs" title="Direct link to heading">#</a></h1><p>So far, we have introduced all the parts of the language that allow us to extract data from an input JSON document, combine the data using string and numeric operators, and format the structure of the output JSON document.  What follows are the parts that turn this into a Turing complete, functional programming language.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="comments"></a>Comments<a class="hash-link" href="#comments" title="Direct link to heading">#</a></h2><p>JSONata expressions can be interleaved with comments using &#x27;C&#x27; style comment delimeters.  For example,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/* Long-winded expressions might need some explanation */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $pi := 3.1415926535897932384626;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /* JSONata is not known for its graphics support! */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $plot := function($x) {(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $floor := $string ~&gt; $substringBefore(?, &#x27;.&#x27;) ~&gt; $number;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $index := $floor(($x + 1) * 20 + 0.5);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $join([0..$index].(&#x27;.&#x27;)) &amp; &#x27;O&#x27; &amp; $join([$index..40].(&#x27;.&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /* Factorial is the product of the integers 1..n */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $product := function($a, $b) { $a * $b };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial := function($n) { $n = 0 ? 1 : $reduce([1..$n], $product) };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $sin := function($x){ /* define sine in terms of cosine */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $cos($x - $pi/2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $cos := function($x){ /* Derive cosine by expanding Maclaurin series */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $x &gt; $pi ? $cos($x - 2 * $pi) : $x &lt; -$pi ? $cos($x + 2 * $pi) :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $sum([0..12].($power(-1, $) * $power($x, 2*$) / $factorial(2*$)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [0..24].$sin($*$pi/12).$plot($)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Produces <a href="http://try.jsonata.org/ryYn78Q0m" target="_blank" rel="noopener noreferrer">this</a>, if you&#x27;re interested!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conditional-logic"></a>Conditional logic<a class="hash-link" href="#conditional-logic" title="Direct link to heading">#</a></h2><p>If/then/else constructs can be written using the ternary operator &quot;? :&quot;.</p><p><code>predicate ? expr1 : expr2</code></p><p>The expression <code>predicate</code> is evaluated.  If its effective boolean value (see definition) is <code>true</code> then <code>expr1</code> is evaluated and returned, otherwise <code>expr2</code> is evaluated and returned.</p><p><strong>Examples</strong></p><p>TBD</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="variables"></a>Variables<a class="hash-link" href="#variables" title="Direct link to heading">#</a></h2><p>Any name that starts with a dollar &#x27;$&#x27; is a variable.  A variable is a named reference to a value.  The value can be one of any type in the language&#x27;s <a href="#the-jsonata-type-system">type system</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="built-in-variables"></a>Built-in variables<a class="hash-link" href="#built-in-variables" title="Direct link to heading">#</a></h3><ul><li><code>$</code> The variable with no name refers to the context value at any point in the input JSON hierarchy. Examples</li><li><code>$$</code> The root of the input JSON.  Only needed if you need to break out of the current context to temporarily navigate down a different path.  E.g. for cross-referencing or joining data. Examples</li><li>Native (built-in) functions.  See function library.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="variable-binding"></a>Variable binding<a class="hash-link" href="#variable-binding" title="Direct link to heading">#</a></h3><p>Values (of any type in the type system) can be bound to variables</p><p><code>$var_name := &quot;value&quot;</code></p><p>The stored value can be later referenced using the expression <code>$var_name</code>.</p><p>The scope of a variable is limited to the &#x27;block&#x27; in which it was bound.  E.g.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Invoice.(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $p := Product.Price;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $q := Product.Quantity;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $p * $q</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Returns Price multiplied by Quantity for the Product in the Invoice.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functions"></a>Functions<a class="hash-link" href="#functions" title="Direct link to heading">#</a></h2><p>The function is a first-class type, and can be stored in a variable just like any other data type.  A library of built-in functions is provided (link) and assigned to variables in the global scope.  For example, <code>$uppercase</code> contains a function which, when invoked with a string argument, <code>str</code>, will return a string with all the characters in <code>str</code> changed to uppercase.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="invoking-a-function"></a>Invoking a function<a class="hash-link" href="#invoking-a-function" title="Direct link to heading">#</a></h3><p>A function is invoked by following its reference (or definition) by parentheses containing a comma delimited sequence of arguments.</p><p><strong>Examples</strong></p><ul><li><code>$uppercase(&quot;Hello&quot;)</code> returns the string &quot;HELLO&quot;.</li><li><code>$substring(&quot;hello world&quot;, 0, 5)</code> returns the string &quot;hello&quot;</li><li><code>$sum([1,2,3])</code> returns the number 6</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-a-function"></a>Defining a function<a class="hash-link" href="#defining-a-function" title="Direct link to heading">#</a></h3><p>Anonymous (lambda) functions can be defined using the following syntax:</p><p><code>function($l, $w, $h){ $l * $w * $h }</code></p><p>and can be invoked using</p><p><code>function($l, $w, $h){ $l * $w * $h }(10, 10, 5)</code> which returns 500</p><p>The function can also be assigned to a variable for future use (within the block)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $volume := function($l, $w, $h){ $l * $w * $h };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $volume(10, 10, 5);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="function-signatures"></a>Function signatures<a class="hash-link" href="#function-signatures" title="Direct link to heading">#</a></h3><p>Functions can be defined with an optional signature which specifies the parameter types of the function.  If supplied,
the evaluation engine will validate the arguments passed to the function before it is invoked.  A dynamic error is
thown if the argument list does not match the signature.</p><p>A function signature is a string of the form <code>&lt;params:return&gt;</code>. <code>params</code> is a sequence of type symbols, each one representing an input argument&#x27;s type. <code>return</code> is a single type symbol representing the return value type.</p><p>Type symbols work as follows:</p><p>Simple types:</p><ul><li><code>b</code> - Boolean</li><li><code>n</code> - number</li><li><code>s</code> - string</li><li><code>l</code> - <code>null</code></li></ul><p>Complex types:</p><ul><li><code>a</code> - array</li><li><code>o</code> - object</li><li><code>f</code> - function</li></ul><p>Union types:</p><ul><li><code>(sao)</code> - string, array or object</li><li><code>(o)</code> - same as <code>o</code></li><li><code>u</code> - equivalent to <code>(bnsl)</code> i.e. Boolean, number, string or <code>null</code></li><li><code>j</code> - any JSON type. Equivalent to <code>(bnsloa)</code> i.e. Boolean, number, string, <code>null</code>, object or array, but not function</li><li><code>x</code> - any type. Equivalent to <code>(bnsloaf)</code></li></ul><p>Parametrised types:</p><ul><li><code>a&lt;s&gt;</code> - array of strings</li><li><code>a&lt;x&gt;</code> - array of values of any type</li></ul><p>Some examples of signatures of built-in JSONata functions:</p><ul><li><code>$count</code> has signature <code>&lt;a:n&gt;</code>; it accepts an array and returns a number.</li><li><code>$append</code> has signature <code>&lt;aa:a&gt;</code>; it accepts two arrays and returns an array.</li><li><code>$sum</code> has signature <code>&lt;a&lt;n&gt;:n&gt;</code>; it accepts an array of numbers and returns a number.</li><li><code>$reduce</code> has signature <code>&lt;fa&lt;j&gt;:j&gt;</code>; it accepts a reducer function <code>f</code> and an <code>a&lt;j&gt;</code> (array of JSON objects) and returns a JSON object.</li></ul><p>Each type symbol may also have <em>options</em> applied.</p><ul><li><code>+</code> - one or more arguments of this type<ul><li>E.g. <code>$zip</code> has signature <code>&lt;a+&gt;</code>; it accepts one array, or two arrays, or three arrays, or...</li></ul></li><li><code>?</code> - optional argument<ul><li>E.g. <code>$join</code> has signature <code>&lt;a&lt;s&gt;s?:s&gt;</code>; it accepts an array of strings and an optional joiner string which defaults to the empty string. It returns a string.</li></ul></li><li><code>-</code> - if this argument is missing, use the context value (&quot;focus&quot;).<ul><li>E.g. <code>$length</code> has signature <code>&lt;s-:n&gt;</code>; it can be called as <code>$length(OrderID)</code> (one argument) but equivalently as <code>OrderID.$length()</code>.</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="recursive-functions"></a>Recursive functions<a class="hash-link" href="#recursive-functions" title="Direct link to heading">#</a></h3><p>Functions that have been assigned to variables can invoke themselves using that variable reference.  This allows recursive functions to be defined.  Eg.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial:= function($x){ $x &lt;= 1 ? 1 : $x * $factorial($x-1) };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial(4)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">24</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note that it is actually possible to write a recursive function using purely anonymous functions (i.e. nothing gets assigned to variables).  This is done using the <a href="https://en.wikipedia.org/wiki/Fixed-point_combinator#Fixed_point_combinators_in_lambda_calculus" target="_blank" rel="noopener noreferrer">Y-combinator</a> which might be an interesting <a href="#advanced-example-the-y-combinator">diversion</a> for those interested in functional programming.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tail-call-optimization-tail-recursion"></a>Tail call optimization (Tail recursion)<a class="hash-link" href="#tail-call-optimization-tail-recursion" title="Direct link to heading">#</a></h3><p>A recursive function adds a new frame to the call stack each time it invokes itself.  This can eventually lead to stack exhaustion if the function recuses beyond a certain limit.  Consider the classic recursive implementation of the factorial function</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial := function($x) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $x &lt;= 1 ? 1 : $x * $factorial($x-1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial(170)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This function works by pushing the number onto the stack, then when the stack unwinds, multiplying it by the result of the factorial of the number minus one.  Written in this way, the JSONata evaluator has no choice but to use the call stack to store the intermediate results.  Given a large enough number, the call stack will overflow.</p><p>This is a recognised problem with functional programming and the solution is to rewrite the function slightly to avoid the <em>need</em> for the stack to store the itermediate result.  The following implementation of factorial achieves this</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial := function($x){(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $iter := function($x, $acc) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $x &lt;= 1 ? $acc : $iter($x - 1, $x * $acc)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $iter($x, 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $factorial(170)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Here, the multiplication is done <em>before</em> the function invokes itself and the intermediate result is carried in the second parameter <code>$acc</code> (accumulator).  The invocation of itself is the <em>last</em> thing that the function does.  This is known as a &#x27;tail call&#x27;, and when the JSONata parser spots this, it internally rewrites the recursion as a simple loop.  Thus it can run indefinitely without growing the call stack.  Functions written in this way are said to be <a href="https://en.wikipedia.org/wiki/Tail_call" target="_blank" rel="noopener noreferrer">tail recursive</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="higher-order-functions"></a>Higher order functions<a class="hash-link" href="#higher-order-functions" title="Direct link to heading">#</a></h3><p>A function, being a first-class data type, can be passed as a parameter to another function, or returned from a function.  Functions that process other functions are known as higher order functions.  Consider the following example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $twice := function($f) { function($x){ $f($f($x)) } };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $add3 := function($y){ $y + 3 };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $add6 := $twice($add3);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $add6(7)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>The function stored in variable <code>$twice</code> is a higher order function.  It takes a parameter <code>$f</code> which is a function, and returns a function which takes a parameter <code>$x</code> which, when invoked, applies the function <code>$f</code> twice to <code>$x</code>.</li><li><code>$add3</code> stores a function that adds 3 to its argument.  Neither <code>$twice</code> or <code>$add3</code> have been invoked yet.</li><li><code>$twice</code> is invoked by passing the function <code>add3</code> as its argument.  This returns a function that applies <code>$add3</code> twice to <em>its</em> argument.  This returned function is not invoked yet, but rather assigned to the variable <code>add6</code>.</li><li>Finally the function in <code>$add6</code> is invoked with the argument 7, resulting in 3 being added to it twice.  It returns 13.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functions-are-closures"></a>Functions are closures<a class="hash-link" href="#functions-are-closures" title="Direct link to heading">#</a></h3><p>When a lambda function is defined, the evaluation engine takes a snapshot of the environment and stores it with the function body definition.  The environment comprises the context item (i.e. the current value in the location path) together with the current in-scope variable bindings.  When the lambda function is later invoked, it is done so in that stored environment rather than the current environment at invocation time.  This property is known as <em>lexical scoping</em> and is a fundamental property of <em>closures</em>.</p><p>Consider the following example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $AccName := function() { $.&#x27;Account Name&#x27; };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Order[OrderID = &#x27;order104&#x27;].Product.{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;Account&#x27;: $AccName(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;SKU-&#x27; &amp; $string(ProductID): $.&#x27;Product Name&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>When the function is created, the context item (referred to by &#x27;$&#x27;) is the value of <code>Account</code>.  Later, when the function is invoked, the context item has moved down the structure to the value of each <code>Product</code> item.  However, the function body is invoked in the environment that was stored when it was defined, so its context item is the value of <code>Account</code>.  This is a somewhat contrived example, you wouldn&#x27;t really need a function to do this.  The expression produces the following result:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Account&quot;: &quot;Firefly&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SKU-858383&quot;: &quot;Bowler Hat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SKU-345664&quot;: &quot;Cloak&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="partial-function-application"></a>Partial function application<a class="hash-link" href="#partial-function-application" title="Direct link to heading">#</a></h3><p>Functions can <a href="https://en.wikipedia.org/wiki/Partial_application" target="_blank" rel="noopener noreferrer">partially applied</a> by invoking the function with one or more (but not all)
arguments replaced by a question mark <code>?</code> placeholder.  The result of this is another function whose arity (number of parameters) is reduced
by the number of arguments supplied to the original function.  This returned function can be treated like any other newly defined function,
e.g. bound to a variable, passed to a higher-order function, etc.</p><p><strong>Examples</strong></p><ul><li><p>Create a function to return the first five characters of a string by partially applying the <code>$substring</code> function</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$first5 := $substring(?, 0, 5);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$first5(&quot;Hello, World&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Hello&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Partially applied function can be further partially applied</p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$firstN := $substring(?, 0, ?);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$first5 := $firstN(?, 5);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$first5(&quot;Hello, World&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Hello&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="function-chaining"></a>Function chaining<a class="hash-link" href="#function-chaining" title="Direct link to heading">#</a></h3><p>Function chaining can be used in two ways:</p><ol><li><p>To avoid lots of nesting when multiple functions are applied to a value</p></li><li><p>As a higher-order construct for defining new functions by combining existing functions</p></li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="invocation-chaining"></a>Invocation chaining<a class="hash-link" href="#invocation-chaining" title="Direct link to heading">#</a></h4><p><code>value ~&gt; $funcA ~&gt; $funcB</code>\
is equivalent to\
<code>$funcB($funcA(value))</code></p><p><strong>Examples</strong></p><ul><li><code>Customer.Email ~&gt; $substringAfter(&quot;@&quot;) ~&gt; $substringBefore(&quot;.&quot;) ~&gt; $uppercase()</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="function-composition"></a>Function composition<a class="hash-link" href="#function-composition" title="Direct link to heading">#</a></h4><p><a href="https://en.wikipedia.org/wiki/Function_composition" target="_blank" rel="noopener noreferrer">Function composition</a> is the application of one function to another function
to produce a third function.</p><p><code>$funcC := $funcA ~&gt; $funcB</code>\
is equivalent to\
<code>$funcC := function($arg) { $funcB($funcA($arg)) }</code></p><p><strong>Examples</strong></p><ul><li>Create a new function by chaining two existing functions  <strong>Query</strong><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> $normalize := $uppercase ~&gt; $trim;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> $normalize(&quot;   Some   Words   &quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div>  <strong>Result</strong><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;SOME WORDS&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functions-as-first-class-values"></a>Functions as first class values<a class="hash-link" href="#functions-as-first-class-values" title="Direct link to heading">#</a></h3><p>Function composition can be combined with partial function application to produce a very compact syntax for defining new
functions.</p><p><strong>Examples</strong></p><ul><li>Create a new function by chaining two partially evaluated functions  <strong>Query</strong><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$first5Capitalized := $substring(?, 0, 5) ~&gt; $uppercase(?);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$first5Capitalized(Address.City)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div>  <strong>Result</strong><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;WINCH&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="advanced-example---the-y-combinator"></a>Advanced example - The Y-combinator<a class="hash-link" href="#advanced-example---the-y-combinator" title="Direct link to heading">#</a></h3><p>There is no need to read this section - it will do nothing for your sanity or ability to manipulate JSON data.</p><p>Earlier we learned how to write a recursive function to calculate the factorial of a number and hinted that this could be done without naming any functions.  We can take higher-order functions to the extreme and write the following:</p><p><code>Î»($f) { Î»($x) { $x($x) }( Î»($g) { $f( (Î»($a) {$g($g)($a)}))})}(Î»($f) { Î»($n) { $n &lt; 2 ? 1 : $n * $f($n - 1) } })(6)</code></p><p>which produces the result <code>720</code>.  The Greek lambda (Î») symbol can be used in place of the word <code>function</code> which, if you can find it on your keyboard, will save screen space and please the fans of <a href="https://en.wikipedia.org/wiki/Lambda_calculus" target="_blank" rel="noopener noreferrer">lambda calculus</a>.</p><p>The first part of this above expression is an implementation of the <a href="https://en.wikipedia.org/wiki/Fixed-point_combinator#Fixed_point_combinators_in_lambda_calculus" target="_blank" rel="noopener noreferrer">Y-combinator</a> in this language.  We could assign it to a variable and apply it to other recursive anonymous functions:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $Y := Î»($f) { Î»($x) { $x($x) }( Î»($g) { $f( (Î»($a) {$g($g)($a)}))})};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [1,2,3,4,5,6,7,8,9] . $Y(Î»($f) { Î»($n) { $n &lt;= 1 ? $n : $f($n-1) + $f($n-2) } }) ($)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>to produce the Fibonacci series <code>[ 1, 1, 2, 3, 5, 8, 13, 21, 34 ]</code>.</p><p>But we don&#x27;t need to do any of this.  Far more sensible to use named functions:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $fib := Î»($n) { $n &lt;= 1 ? $n : $fib($n-1) + $fib($n-2) };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [1,2,3,4,5,6,7,8,9] . $fib($)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-regular-expressions"></a>Using Regular Expressions<a class="hash-link" href="#using-regular-expressions" title="Direct link to heading">#</a></h1><p>The regular expression is a syntax for matching and extracting parts of a string.  JSONata provides first class support for regular expressions surrounded by the familiar slash delimeters found in many scripting languages.  </p><p><code>/regex/flags</code></p><p>where:</p><ul><li><p><code>regex</code> - the regular expression</p></li><li><p><code>flags</code> - optionally either or both of: </p><ul><li><code>i</code> - ignore case</li><li><code>m</code> - multiline match</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functions-which-use-regular-expressions"></a>Functions which use regular expressions<a class="hash-link" href="#functions-which-use-regular-expressions" title="Direct link to heading">#</a></h2></li></ul><p>A number of functions are available that take a regular expression as a parameter</p><ul><li><a href="#match">$match()</a></li><li><a href="#contains">$contains()</a></li><li><a href="#split">$split()</a></li><li><a href="#replace">$replace()</a></li></ul><p><strong>Examples</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="regular-expressions-in-query-predicates"></a>Regular expressions in query predicates<a class="hash-link" href="#regular-expressions-in-query-predicates" title="Direct link to heading">#</a></h2><p>Regexes are often used in query predicates (filter expressions) when selecting objects that contain a matching string property.  For this, a short cut notation can be used as follows:</p><p><code>path.to.object[stringProperty ~&gt; /regex/]</code></p><p>The <code>~&gt;</code> is the <a href="#chain">chain operator</a>, and its use here implies that the result of <code>/regex/</code> is a function.  We&#x27;ll see below that this is in fact the case.</p><p><strong>Examples</strong></p><p><code>Account.Order.Product[`Product Name` ~&gt; /hat/i ]</code></p><p>will match all products that have &#x27;hat&#x27; in their name.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="generic-matchers"></a>Generic matchers<a class="hash-link" href="#generic-matchers" title="Direct link to heading">#</a></h2><p>The JSONata type system is based on the JSON type system, with the addition of the function type.  In order to accommodate the regex as a standalone expression, the syntax <code>/regex/</code> evaluates to a function.  Think of the <code>/regex/</code> syntax as a higher-order function that results in a &#x27;matching function&#x27; when evaluated.  The <code>regex</code> between the slashes is the parameter to this HOF and the function that gets returned, when applied to <em>its</em> string parameter, will return a structure that contains details of parts of the string that have been matched.  If nothing is matched, then it returns the empty sequence (i.e. JavaScript <code>undefined</code>).</p><p><strong>Example</strong></p><p><code>$matcher := /[a-z]*an[a-z]*/i</code></p><p>Evaluation of the regex returns a function, and this has been bound to a variable <code>$matcher</code>.  Later, the <code>$matcher</code> function is invoked on a string:</p><p><code>$matcher(&#x27;A man, a plan, a canal, Panama!&#x27;)</code></p><p>This returns the following JSONata object (JSON, but also with a function property):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;match&quot;: &quot;man&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;start&quot;: 2,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;end&quot;: 4,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;groups&quot;: [],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;next&quot;: &quot;&lt;native function&gt;#0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This contains information of the first matching substring within this famous palindrome, specifically:</p><ul><li><code>match</code> - the substring within the original string that matches the regex</li><li><code>start</code> - the starting position (zero offset) of the matching substring within the original string</li><li><code>end</code> - the endinging position of the matching substring within the original string</li><li><code>groups</code> - if capturing groups are used in the regex, then this array contains a string for the text captured by each group</li><li><code>next()</code> - when invoked, will return details of the second occurrence of any matching substring (and so on).</li></ul><p>In this example, invoking <code>next()</code> will return:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;match&quot;: &quot;canal&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;start&quot;: 17,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;end&quot;: 22,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;groups&quot;: [],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;next&quot;: &quot;&lt;native function&gt;#0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>and so on, until it eventually returns the empty sequence.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="writing-a-custom-matcher"></a>Writing a custom matcher<a class="hash-link" href="#writing-a-custom-matcher" title="Direct link to heading">#</a></h2><p>We&#x27;ve learned that the regex syntax is just a function generator, and the signature and return structure of the generated &#x27;matcher&#x27; function is well defined.  The four regex-aware functions (<code>$match</code>, <code>$contain</code>, <code>$split</code>, <code>$replace</code>) simply invoke this function as part of their implementation.  Apart from that, they have no awareness that these matcher functions were generated by the regex syntax.</p><p>So it&#x27;s possible to write any user-defined matcher function, provided it conforms to this contract.  This can be done as a JSONata lambda function or (more likely) as an extension function.  It can then be passed to these four &#x27;regex-aware&#x27; functions and they will search using the custom matcher rather than a regex.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="datetime-processing"></a>Date/Time processing<a class="hash-link" href="#datetime-processing" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-evaluation-time---now"></a>The &#x27;evaluation timeâ€™ - $now()<a class="hash-link" href="#the-evaluation-time---now" title="Direct link to heading">#</a></h2><p>There are two functions that return the &#x27;current&#x27; date/time timestamp:</p><ol><li><a href="#now"><code>$now()</code></a> returns the timestamp in an ISO 8601 formatted string.</li><li><a href="#millis"><code>$millis()</code></a> returns the same timestamp as the number of milliseconds since midnight on 1st January 1970 UTC (the <a href="https://en.wikipedia.org/wiki/Unix_time" target="_blank" rel="noopener noreferrer">Unix epoch</a>).</li></ol><p>The timestamp is captured at the start of the expression evaluation, and that same timestamp value is returned for every occurrence of <code>$now()</code> and <code>$millis()</code> in the same expression for the duration of the evaluation.</p><p><strong>Example</strong></p><ul><li>The timestamp will be the same for all invocations within an expression  <strong>Query</strong><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;invoiceTime&quot;: $now(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;total&quot;: $sum(Account.Order.Product.(Price * Quantity)),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;closingTime&quot;: $now()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div>  <strong>Result</strong><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;invoiceTime&quot;: &quot;2018-12-10T13:49:51.141Z&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;total&quot;: 336.36,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;closingTime&quot;: &quot;2018-12-10T13:49:51.141Z&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="json-and-iso-8601"></a>JSON and ISO 8601<a class="hash-link" href="#json-and-iso-8601" title="Direct link to heading">#</a></h2><p>JSON does not have a built-in type for date/time values.  The general <a href="https://stackoverflow.com/a/15952652/7079134" target="_blank" rel="noopener noreferrer">consensus</a> is to store the date/time value as a string in <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener noreferrer">ISO 8601</a> format.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;myDateTime&quot;: &quot;2018-12-10T13:45:00.000Z&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>JSONata follows this convention and provides functions for formatting and parsing ISO 8601 formatted timestamps
(<a href="#tomillis"><code>toMillis()</code></a> and <a href="#frommillis"><code>fromMillis()</code></a>)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="support-for-other-datetime-formats"></a>Support for other date/time formats<a class="hash-link" href="#support-for-other-datetime-formats" title="Direct link to heading">#</a></h2><p>Since there is no standard for date/time format in JSON, it is entirely possible that the JSON data you are working with will have date/time values formatted in other ways.  JSONata supports the highly versatile picture string notation from the XPath/XQuery <a href="https://www.w3.org/TR/xpath-functions-31/#func-format-dateTime" target="_blank" rel="noopener noreferrer">fn:format-dateTime()</a> specification for both the formatting and parsing of a wide variety of date/time formats. </p><p>See <a href="#tomillis"><code>toMillis()</code></a> and <a href="#frommillis"><code>fromMillis()</code></a> for details.</p><p><strong>Examples</strong></p><ul><li><p>The date <code>12/10/2018</code> in US format and <code>10/12/2018</code> in European format both refer to the same day.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$toMillis(&#x27;10/12/2018&#x27;, &#x27;[D]/[M]/[Y]&#x27;) ~&gt; $fromMillis(&#x27;[M]/[D]/[Y]&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;12/10/2018&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>More verbose format.</p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$toMillis(&#x27;10/12/2018&#x27;, &#x27;[D]/[M]/[Y]&#x27;) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ~&gt; $fromMillis(&#x27;[FNn], [D1o] [MNn] [YI]&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Monday, 10th December MMXVIII&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="path-operators"></a>Path Operators<a class="hash-link" href="#path-operators" title="Direct link to heading">#</a></h1><p>The path operators underpin the declarative nature of the map/filter/reduce processing model in JSONata.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-map"></a><code>.</code> (Map)<a class="hash-link" href="#-map" title="Direct link to heading">#</a></h2><p>The dot operator is one of the fundamental building blocks in JSONata expressions.  It implements the &#x27;for each&#x27; or &#x27;map&#x27; function that is common in many functional languages.</p><p>The dot operator performs the following logic:</p><ul><li>The expression on the LHS is evaluated to produce an array of values.<ul><li>If it evaluates to a single value, that is treated as equivalent to an array containing that single value</li><li>If it evaluates to nothing (no match or empty array), then the result of the operator expression is nothing</li></ul></li><li>For each value in the LHS array in turn:<ul><li>The value is known as the <em>context</em> and is used as the basis for any relative path expression on the RHS.  It is also accessible in the RHS expression using the <code>$</code> symbol.</li><li>The RHS expression is evaluated to produce a value or array of values (or nothing).  These values are appended to a combined array of results for the operator as a whole.</li></ul></li><li>The combined result of the operator is returned.</li></ul><p>This operator is left associative meaning that the expression <code>a.b.c.d</code> is evaluated like <code>((a.b).c).d</code>; i.e. left to right</p><p><strong>Examples</strong></p><ul><li><code>Address.City</code> =&gt; <code>&quot;Winchester&quot;</code></li><li><code>Phone.number</code> =&gt; <code>[ &quot;0203 544 1234&quot;, &quot;01962 001234&quot;, &quot;01962 001235&quot;, &quot;077 7700 1234&quot; ]</code></li><li><code>Account.Order.Product.(Price * Quantity)</code> =&gt; <code>[ 68.9, 21.67, 137.8, 107.99 ]</code></li><li><code>Account.Order.OrderID.$uppercase()</code> =&gt; <code>[ &quot;ORDER103&quot;, &quot;ORDER104&quot;]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="---filter"></a><code>[</code> ... <code>]</code> (Filter)<a class="hash-link" href="#---filter" title="Direct link to heading">#</a></h2><p>The filter operator (a.k.a predicate) is used to select only the items in the input sequence that satisfy the predicate expression contained between the square brackets.</p><p>If the predicate expression is an integer, or an expression that evaluates to an integer, then the item at that position (zero offset) in the input sequence is the only item selected for the result sequence.
If the number is non-integer, then it is rounded <em>down</em> to the nearest integer.</p><p>If the predicate expression is an array of integers, or an expression that evaluates to an array of integers, then the items at those positions (zero offset) in the input sequence is the only item selected for the result sequence.</p><p>If the predicate expression evaluates to any other value, then it is cast to a Boolean as if using the <code>$boolean()</code> function.  If this evaluates to <code>true</code>, then the item is retained in the result sequence.  Otherwise it is rejected.</p><p>See <a href="#navigating-json-arrays">Navigating JSON Arrays</a> and <a href="#predicate">Predicates</a> for more details and examples.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="---order-by"></a><code>^(</code> ... <code>)</code> (Order-by)<a class="hash-link" href="#---order-by" title="Direct link to heading">#</a></h2><p>The order-by operator is used to sort an array of values into ascending or descending order according to one or more expressions defined within the parentheses.</p><p>By default, the array will be sorted into ascending order.  For example:</p><p><code>Account.Order.Product^(Price)</code></p><p>sorts all of the products into order of increasing price (<code>Price</code> is a numeric field in the <code>Product</code> object).</p><p>To sort in descending order, the sort expression must be preceded by the <code>&gt;</code> symbol. For example:</p><p><code>Account.Order.Product^(&gt;Price)</code></p><p>sorts all of the products into order of decreasing price.  The <code>&lt;</code> symbol can be used to explicitly indicate ascending order, although that is the default behaviour.</p><p>Secondary (and more) sort expressions can be specified by separating them with commas (<code>,</code>).  The secondary expression will be used to determine order if the primary expression ranks two values the same.  For example,</p><p><code>Account.Order.Product^(&gt;Price, &lt;Quantity)</code></p><p>orders the products primarily by decreasing price, but for products of the same price, by increasing quantity.</p><p>The sort expression(s) can be any valid JSONata expression that evaluates to a number or a string.  If it evaluates to a string then the array is sorted in order of unicode codepoint.</p><p><strong>Examples</strong></p><ul><li><code>Account.Order.Product^(Price * Quantity)</code> =&gt; Increasing order of price times quantity.</li><li><code>student[type=&#x27;fulltime&#x27;]^(DoB).name</code> =&gt; The names of all full time students sorted by date of birth (the DoB value is an ISO 8601 date format)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="---reduce"></a><code>{</code> ... <code>}</code> (Reduce)<a class="hash-link" href="#---reduce" title="Direct link to heading">#</a></h2><p>The reduce operator can be used as the last step in a path expression to group and aggregate its input sequence into a single object.
The key/value pairs between the curly braces determine the groupings (by evaluating the key expression) and the aggregated values for each group.
See <a href="#grouping">Grouping and Aggregation</a> for more details.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-wildcard"></a><code>*</code> (Wildcard)<a class="hash-link" href="#-wildcard" title="Direct link to heading">#</a></h2><p>This wildcard selects the values of all the properties of the context object.  It can be used in a path expression in place of a property name, but it cannot be combined with other characters like a glob pattern.  The order of these values in the result sequence is implementation dependent.
See <a href="#wildcards">Wildcards</a> for examples.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-descendants"></a><code>**</code> (Descendants)<a class="hash-link" href="#-descendants" title="Direct link to heading">#</a></h2><p>This wildcard recursively selects the values of all the properties of the context object, and the properties of any objects contained within these values as it descends the hierarchy.
See <a href="#navigate-arbitrary-depths">Navigate arbitrary depths</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-parent"></a><code>%</code> (Parent)<a class="hash-link" href="#-parent" title="Direct link to heading">#</a></h2><p>This will select the &#x27;parent&#x27; of the current context value.  Here, we define &#x27;parent&#x27; to be the enclosing object which has the property representing the context value.</p><p>This is the only operation which searches &#x27;backwards&#x27; in the input data structure. It is implemented by static analysis of the expression at <a href="https://docs.jsonata.org/embedding-extending#jsonatastr" target="_blank" rel="noopener noreferrer">compile time</a> and can only be used within expressions that navigate through that target parent value in the first place.
If, for any reason, the parent location cannot be determined, then a static error (S0217) is thrown.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product.{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;Product&#x27;: `Product Name`,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;Order&#x27;: %.OrderID,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;Account&#x27;: %.%.`Account Name`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This returns an array of objects for each product in each order in each account.  Information from the enclosing Order and Account objects can be accessed using the parent operator.
The repeated combination of <code>%.%.</code> is used to access the grandparent and higher ancestors.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-positional-variable-binding"></a><code>#</code> (Positional variable binding)<a class="hash-link" href="#-positional-variable-binding" title="Direct link to heading">#</a></h2><p>This can be used to determine at which position in the sequence the current context item is.  It can be used following any map, filter or order-by stage in the path.
The variable is available for use within subsequent stages of the path (e.g. within filter predicates) and goes out of scope at the end of the path expression.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">library.books#$i[&#x27;Kernighan&#x27; in authors].{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;title&#x27;: title,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;index&#x27;: $i</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This returns an array of objects for each book in the library where Kernighan is one of the authors.  Each object contains the book&#x27;s title and its position within the books array before it was filtered.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-context-variable-binding"></a><code>@</code> (Context variable binding)<a class="hash-link" href="#-context-variable-binding" title="Direct link to heading">#</a></h2><p>This is used to bind the current context item (<code>$</code>) to a named variable.  It can only be used directly following a map stage, not a filter or order-by stage.
The variable binding remains in scope for the remainder of the path expression.</p><p>Because the current context has now been explicitly bound to a named variable, this context will be carried forward to be the context of the next stage in the path.
For example, in this snippet of a path, <code>library.loans@$l.books</code>, the loans array is a property of the library object and each loan will, in turn, be bound to the variable <code>$l</code>.
The books array, which is also a property of the library object, will then be selected.</p><p>This operator can be used to perform data joins within a path because of its ability to do cross-referencing across objects.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">library.loans@$l.books@$b[$l.isbn=$b.isbn].{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;title&#x27;: $b.title,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;customer&#x27;: $l.customer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This performs an &#x27;inner join&#x27; between objects in the loans array and objects in the books array where the ISBNs match between the structures.</p><p>Block expressions can be used to widen the scope of the data cross-referencing as shown in this example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(library.loans)@$l.(catalog.books)@$b[$l.isbn=$b.isbn].{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;title&#x27;: $b.title,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;customer&#x27;: $l.customer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="numeric-operators"></a>Numeric Operators<a class="hash-link" href="#numeric-operators" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-addition"></a><code>+</code> (Addition)<a class="hash-link" href="#-addition" title="Direct link to heading">#</a></h2><p>The addition operator adds the operands to produce the numerical sum.  It is an error if either operand is not a number.</p><p><strong>Example</strong></p><p><code>5 + 2</code> =&gt; <code>7</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="--substractionnegation"></a><code>-</code> (Substraction/Negation)<a class="hash-link" href="#--substractionnegation" title="Direct link to heading">#</a></h2><p>The subtraction operator subtracts the RHS value from the LHS value to produce the numerical difference  It is an error if either operand is not a number.</p><p>It can also be used in its unary form to negate a number</p><p><strong>Examples</strong></p><ul><li><code>5 - 2</code> =&gt; <code>3</code></li><li><code>- 42</code> =&gt; <code>-42</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-multiplication"></a><code>*</code> (Multiplication)<a class="hash-link" href="#-multiplication" title="Direct link to heading">#</a></h2><p>The multiplication operator multiplies the operands to produce the numerical product.  It is an error if either operand is not a number.</p><p><strong>Example</strong></p><p><code>5 * 2</code> =&gt; <code>10</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-division"></a><code>/</code> (Division)<a class="hash-link" href="#-division" title="Direct link to heading">#</a></h2><p>The division operator divides the RHS into the LHS to produce the numerical quotient.  It is an error if either operand is not a number.</p><p><strong>Example</strong></p><p><code>5 / 2</code> =&gt; <code>2.5</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-modulo"></a><code>%</code> (Modulo)<a class="hash-link" href="#-modulo" title="Direct link to heading">#</a></h2><p>The modulo operator divides the RHS into the LHS using whole number division to produce a whole number quotient and a remainder.  This operator returns the remainder.  It is an error if either operand is not a number.</p><p><strong>Example</strong></p><p><code>5 % 2</code> =&gt; <code>1</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-range"></a><code>..</code> (Range)<a class="hash-link" href="#-range" title="Direct link to heading">#</a></h2><p>The sequence generation operator is used to create an array of monotonically increasing integer start with the number on the LHS and ending with the number on the RHS.  It is an error if either operand does not evaluate to an integer.  The sequence generator can only be used within an array constructor [].</p><p><strong>Examples</strong></p><ul><li><code>[1..5]</code> =&gt; <code>[1, 2, 3, 4, 5]</code></li><li><code>[1..3, 7..9]</code> =&gt; <code>[1, 2, 3, 7, 8, 9]</code></li><li><code>[1..$count(Items)].(&quot;Item &quot; &amp; $)</code> =&gt; <code>[&quot;Item 1&quot;,&quot;Item 2&quot;,&quot;Item 3&quot;]</code></li><li><code>[1..5].($*$)</code> =&gt; <code>[1, 4, 9, 16, 25]</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="comparison-operators"></a>Comparison Operators<a class="hash-link" href="#comparison-operators" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-equals"></a><code>=</code> (Equals)<a class="hash-link" href="#-equals" title="Direct link to heading">#</a></h2><p>The equality operator returns Boolean <code>true</code> if both operands are the same (type and value).  Arrays and objects are checked for deep equality.  Arrays must have the same values in the same order. Objects must have the same key/value pairs (order is not relevant).  Otherwise it returns <code>false</code>.</p><p><strong>Examples</strong></p><ul><li><code>1+1 = 2</code> =&gt; <code>true</code></li><li><code>&quot;Hello&quot; = &quot;World&quot;</code> =&gt; <code>false</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-not-equals"></a><code>!=</code> (Not equals)<a class="hash-link" href="#-not-equals" title="Direct link to heading">#</a></h2><p>The inequality operator returns Boolean <code>false</code> if both operands are the same (type and value, deep equality).  Otherwise it returns <code>true</code>.</p><p><strong>Examples</strong></p><ul><li><code>1+1 != 3</code> =&gt; <code>true</code></li><li><code>&quot;Hello&quot; != &quot;World&quot;</code> =&gt; <code>true</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-greater-than"></a><code>&gt;</code> (Greater than)<a class="hash-link" href="#-greater-than" title="Direct link to heading">#</a></h2><p>The &#x27;greater than&#x27; operator returns Boolean <code>true</code> if the LHS is numerically greater than the RHS.  Otherwise it returns <code>false</code>.</p><p><strong>Examples</strong></p><ul><li><code>22 / 7 &gt; 3</code> =&gt; <code>true</code></li><li><code>5 &gt; 5</code> =&gt; <code>false</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-less-than"></a><code>&lt;</code> (Less than)<a class="hash-link" href="#-less-than" title="Direct link to heading">#</a></h2><p>The &#x27;less than&#x27; operator returns Boolean <code>true</code> if the LHS is numerically less than the RHS.  Otherwise it returns <code>false</code>.</p><p><strong>Examples</strong></p><ul><li><code>22 / 7 &lt; 3</code> =&gt; <code>false</code></li><li><code>5 &lt; 5</code> =&gt; <code>false</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-greater-than-or-equals"></a><code>&gt;=</code> (Greater than or equals)<a class="hash-link" href="#-greater-than-or-equals" title="Direct link to heading">#</a></h2><p>The &#x27;greater than or equals&#x27; operator returns Boolean <code>true</code> if the LHS is numerically greater than or equal to the RHS.  Otherwise it returns <code>false</code>.</p><p><strong>Examples</strong></p><ul><li><code>22 / 7 &gt;= 3</code> =&gt; <code>true</code></li><li><code>5 &gt;= 5</code> =&gt; <code>true</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-less-than-or-equals"></a><code>&lt;=</code> (Less than or equals)<a class="hash-link" href="#-less-than-or-equals" title="Direct link to heading">#</a></h2><p>The &#x27;less than or equals&#x27; operator returns Boolean <code>true</code> if the LHS is numerically less than or equal to the RHS.  Otherwise it returns <code>false</code>.</p><p><strong>Examples</strong></p><ul><li><code>22 / 7 &lt;= 3</code> =&gt; <code>false</code></li><li><code>5 &lt;= 5</code> =&gt; <code>true</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="in-inclusion"></a><code>in</code> (Inclusion)<a class="hash-link" href="#in-inclusion" title="Direct link to heading">#</a></h2><p>The array (sequence) inclusion operator returns Boolean <code>true</code> if the value of the LHS is included in the array of values on the RHS.  Otherwise it returns <code>false</code>.  If the RHS is a single value, then it is treated as a singleton array.</p><p><strong>Examples</strong></p><ul><li><code>&quot;world&quot; in [&quot;hello&quot;, &quot;world&quot;]</code> =&gt; <code>true</code></li><li><code>&quot;hello&quot; in &quot;hello&quot;</code> =&gt; <code>true</code></li><li><code>library.books[&quot;Aho&quot; in authors].title</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boolean-operators"></a>Boolean Operators<a class="hash-link" href="#boolean-operators" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="and-boolean-and"></a><code>and</code> (Boolean AND)<a class="hash-link" href="#and-boolean-and" title="Direct link to heading">#</a></h2><p>The &#x27;and&#x27; operator returns Boolean <code>true</code> if both operands evaluate to <code>true</code>.  If either or both operands is not a Boolean type, then they are first cast to a Boolean using the rules of the <code>$boolean</code> function.</p><p><strong>Example</strong></p><p><code>library.books[&quot;Aho&quot; in authors and price &lt; 50].title</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="or-boolean-or"></a><code>or</code> (Boolean OR)<a class="hash-link" href="#or-boolean-or" title="Direct link to heading">#</a></h2><p>The &#x27;or&#x27; operator returns Boolean <code>true</code> if either operand evaluates to <code>true</code>.  If either or both operands is not a Boolean type, then they are first cast to a Boolean using the rules of the <code>$boolean</code> function.</p><p><strong>Example</strong></p><p><code>library.books[price &lt; 10 or section=&quot;diy&quot;].title</code></p><p><strong>Please note that Boolean &#x27;NOT&#x27; is a <a href="#not">function</a>, not an operator.</strong></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="other-operators"></a>Other Operators<a class="hash-link" href="#other-operators" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-concatenation"></a><code>&amp;</code> (Concatenation)<a class="hash-link" href="#-concatenation" title="Direct link to heading">#</a></h2><p>The string concatenation operator is used to join the string values of the operands into a single resultant string.  If either or both of the operands are not strings, then they are first cast to string using the rules of the <code>$string</code> function.</p><p><strong>Example</strong></p><p><code>&quot;Hello&quot; &amp; &quot;World&quot;</code> =&gt; <code>&quot;HelloWorld&quot;</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="--conditional"></a><code>? :</code> (Conditional)<a class="hash-link" href="#--conditional" title="Direct link to heading">#</a></h2><p>The conditional ternary operator is used to evaluate one of two alternative expressions based on the result of a predicate (test) condition.  The operator takes the form:</p><p><code>&lt;test_expr&gt; ? &lt;expr_T&gt; : &lt;expr_F&gt;</code></p><p>The <code>&lt;test_expr&gt;</code> expression is first evaluated.  If it evaluates to Boolean <code>true</code>, then the operator returns the result of evaluating the <code>&lt;expr_T&gt;</code> expression.  Otherwise it returns the result of evaluating the <code>&lt;expr_F&gt;</code> expression. If <code>&lt;test_expr&gt;</code> evaluates to a non-Boolean value, then the value is first cast to Boolean using the rules of the <code>$boolean</code> function.</p><p><strong>Example</strong></p><p><code>Price &lt; 50 ? &quot;Cheap&quot; : &quot;Expensive&quot;</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-variable-binding"></a><code>:=</code> (Variable binding)<a class="hash-link" href="#-variable-binding" title="Direct link to heading">#</a></h2><p>The variable binding operator is used to bind the value of the RHS to the variable name defined on the LHS.  The variable binding is scoped to the current block and any nested blocks.  It is an error if the LHS is not a <code>$</code> followed by a valid variable name.</p><p><strong>Examples</strong></p><ul><li><code>$five := 5</code></li><li><code>$square := function($n) { $n * $n }</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-chain"></a><code>~&gt;</code> (Chain)<a class="hash-link" href="#-chain" title="Direct link to heading">#</a></h2><p>The function chaining operator is used in the situations where multiple nested functions need to be applied to a value, while making it easy to read. The value on the LHS is evaluated, then passed into the function on the RHS as its first argument.  If the function has any other arguments, then these are passed to the function in parenthesis as usual.  It is an error if the RHS is not a function, or an expression that evaluates to a function.</p><p><strong>Examples</strong></p><p><code>$uppercase($substringBefore($substringAfter(Customer.Email, &quot;@&quot;), &quot;.&quot;))</code></p><p>and</p><p><code>$sum(Account.Order.Product.(Price * Quantity))</code></p><p>can be more clearly written:</p><p><code>Customer.Email ~&gt; $substringAfter(&quot;@&quot;) ~&gt; $substringBefore(&quot;.&quot;) ~&gt; $uppercase()</code></p><p>and</p><p><code>Account.Order.Product.(Price * Quantity) ~&gt; $sum()</code></p><p>This operator can also be used in a more abstract form to define new functions based on a combination of existing functions.  In this form, there is no value passed in on the LHS of the first function in the chain.</p><p>For example, the expression</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $uppertrim := $trim ~&gt; $uppercase;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $uppertrim(&quot;   Hello    World   &quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>=&gt; <code>&quot;HELLO WORLD&quot;</code></p><p>creates a new function <code>$uppertrim</code> that performs <code>$trim</code> followed by <code>$uppercase</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-------transform"></a><code>... ~&gt; | ... | ... |</code> (Transform)<a class="hash-link" href="#-------transform" title="Direct link to heading">#</a></h2><p>The object transform operator is used to modify a copy of an object structure using a pattern/action syntax to target specific modifications while keeping the rest of the structure unchanged.</p><p>The syntax has the following structure:</p><p><code>head ~&gt; | location | update [, delete] |</code></p><p>where</p><ul><li><code>head</code> evaluates to the object that is to be copied and transformed</li><li><code>location</code> evaluates to the part(s) within the copied object that are to be updated. The <code>location</code> expression is evaluated relative to the result of <code>head</code>. The result of evaluating <code>location</code> must be an object or array of objects.</li><li><code>update</code> evaluates to an object that is merged into the object matched by each <code>location</code>. <code>update</code> is evaluated relative to the result of <code>location</code> and if <code>location</code> matched multiple objects, then the update gets evaluated for each one of these. The result of (each) update is merged into the result of <code>location</code>.</li><li><code>delete</code> (optional) evaluates to a string or an array of strings. Each string is the name of the name/value pair in each object matched by <code>location</code> that is to be removed from the resultant object.</li></ul><p>The <code>~&gt;</code> operator is the operator for function chaining and passes the value on the left hand side to the function on the right hand side as its first argument. The expression on the right hand side must evaluate to a function, hence the <code>|...|...|</code> syntax generates a function with one argument.</p><p>Example:</p><p><code>| Account.Order.Product | {&#x27;Price&#x27;: Price * 1.2} |</code></p><p>defines a transform that will return a deep copy the object passed to it, but with the <code>Product</code> object modified such that its <code>Price</code> property has had its value increased by 20%. The first part of the expression is the path location that specifies all of the objects within the overall object to change, and the second part defines an object that will get merged into the object(s) matched by the first part. The merging semantics is the same as that of the <code>$merge()</code> function.</p><p>This transform definition syntax creates a JSONata function which you can either assign to a variable and use multiple times, or invoke inline.
Example:</p><p><code>payload ~&gt; |Account.Order.Product|{&#x27;Price&#x27;: Price * 1.2}|</code></p><p>or:</p><p><code>$increasePrice := |Account.Order.Product|{&#x27;Price&#x27;: Price * 1.2}|</code></p><p>This also has the benefit that multiple transforms can be chained together for more complex transformations.</p><p>In common with <code>$merge()</code>, multiple changes (inserts or updates) can be made to an object.
Example:</p><p><code>|Account.Order.Product|{&#x27;Price&#x27;: Price * 1.2, &#x27;Total&#x27;: Price * Quantity}|</code></p><p>Note that the Total will be calculated using the original price, not the modified one (JSONata is declarative not imperative).</p><p>Properties can also be removed from objects.  This is done using the optional <code>delete</code> clause which specifies the name(s) of the properties to delete.
Example:</p><p><code>$ ~&gt; |Account.Order.Product|{&#x27;Total&#x27;: Price * Quantity}, [&#x27;Price&#x27;, &#x27;Quantity&#x27;]|</code></p><p>This copies the input, but for each <code>Product</code> it inserts a Total and removes the <code>Price</code> and <code>Quantity</code> properties.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="string-functions"></a>String functions<a class="hash-link" href="#string-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="string"></a><code>$string()</code><a class="hash-link" href="#string" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$string(arg, prettify)</code></p><p>Casts the <code>arg</code> parameter to a string using the following casting rules</p><ul><li>Strings are unchanged</li><li>Functions are converted to an empty string</li><li>Numeric infinity and NaN throw an error because they cannot be represented as a JSON number</li><li>All other values are converted to a JSON string using the <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="noopener noreferrer">JSON.stringify</a> function</li></ul><p>If <code>arg</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>arg</code>.</p><p>If <code>prettify</code> is true, then &quot;prettified&quot; JSON is produced. i.e One line per field and lines will be indented based on the field depth.</p><p><strong>Examples</strong></p><ul><li><code>$string(5)</code> =&gt; <code>&quot;5&quot;</code></li><li><code>[1..5].$string()</code> =&gt; <code>[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="length"></a><code>$length()</code><a class="hash-link" href="#length" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$length(str)</code></p><p>Returns the number of characters in the string <code>str</code>.  If <code>str</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>str</code>.  An error is thrown if <code>str</code> is not a string.</p><p><strong>Examples</strong></p><ul><li><code>$length(&quot;Hello World&quot;)</code> =&gt; <code>11</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="substring"></a><code>$substring()</code><a class="hash-link" href="#substring" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$substring(str, start[, length])</code></p><p>Returns a string containing the characters in the first parameter <code>str</code> starting at position <code>start</code> (zero-offset).  If <code>str</code> is not specified (i.e. this function is invoked with only the numeric argument(s)), then the context value is used as the value of <code>str</code>.  An error is thrown if <code>str</code> is not a string.</p><p>If <code>length</code> is specified, then the substring will contain maximum <code>length</code> characters.</p><p>If <code>start</code> is negative then it indicates the number of characters from the end of <code>str</code>.  See <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/substr" target="_blank" rel="noopener noreferrer">substr</a> for full definition.</p><p><strong>Examples</strong></p><ul><li><code>$substring(&quot;Hello World&quot;, 3)</code> =&gt; <code>&quot;lo World&quot;</code></li><li><code>$substring(&quot;Hello World&quot;, 3, 5)</code> =&gt; <code>&quot;lo Wo&quot;</code></li><li><code>$substring(&quot;Hello World&quot;, -4)</code> =&gt; <code>&quot;orld&quot;</code></li><li><code>$substring(&quot;Hello World&quot;, -4, 2)</code> =&gt; <code>&quot;or&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="substringbefore"></a><code>$substringBefore()</code><a class="hash-link" href="#substringbefore" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$substringBefore(str, chars)</code></p><p>Returns the substring before the first occurrence of the character sequence <code>chars</code> in <code>str</code>.  If <code>str</code> is not specified (i.e. this function is invoked with only one argument), then the context value is used as the value of <code>str</code>.  If <code>str</code> does not contain <code>chars</code>, then it returns <code>str</code>.   An error is thrown if <code>str</code> and <code>chars</code> are not strings.</p><p><strong>Examples</strong></p><ul><li><code>$substringBefore(&quot;Hello World&quot;, &quot; &quot;)</code> =&gt; <code>&quot;Hello&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="substringafter"></a><code>$substringAfter()</code><a class="hash-link" href="#substringafter" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$substringAfter(str, chars)</code></p><p>Returns the substring after the first occurrence of the character sequence <code>chars</code> in <code>str</code>.  If <code>str</code> is not specified (i.e. this function is invoked with only one argument), then the context value is used as the value of <code>str</code>.  If <code>str</code> does not contain <code>chars</code>, then it returns <code>str</code>.   An error is thrown if <code>str</code> and <code>chars</code> are not strings.</p><p><strong>Examples</strong></p><ul><li><code>$substringAfter(&quot;Hello World&quot;, &quot; &quot;)</code> =&gt; <code>&quot;World&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="uppercase"></a><code>$uppercase()</code><a class="hash-link" href="#uppercase" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$uppercase(str)</code></p><p>Returns a string with all the characters of <code>str</code> converted to uppercase.  If <code>str</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>str</code>.  An error is thrown if <code>str</code> is not a string.</p><p><strong>Examples</strong></p><ul><li><code>$uppercase(&quot;Hello World&quot;)</code> =&gt; <code>&quot;HELLO WORLD&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lowercase"></a><code>$lowercase()</code><a class="hash-link" href="#lowercase" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$lowercase(str)</code></p><p>Returns a string with all the characters of <code>str</code> converted to lowercase.  If <code>str</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>str</code>.  An error is thrown if <code>str</code> is not a string.</p><p><strong>Examples</strong></p><ul><li><code>$lowercase(&quot;Hello World&quot;)</code> =&gt; <code>&quot;hello world&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="trim"></a><code>$trim()</code><a class="hash-link" href="#trim" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$trim(str)</code></p><p>Normalizes and trims all whitespace characters in <code>str</code> by applying the following steps:</p><ul><li>All tabs, carriage returns, and line feeds are replaced with spaces.</li><li>Contiguous sequences of spaces are reduced to a single space.</li><li>Trailing and leading spaces are removed.</li></ul><p>If <code>str</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>str</code>.  An error is thrown if <code>str</code> is not a string.</p><p><strong>Examples</strong></p><ul><li><code>$trim(&quot;   Hello    \n World  &quot;)</code> =&gt; <code>&quot;Hello World&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pad"></a><code>$pad()</code><a class="hash-link" href="#pad" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$pad(str, width [, char])</code></p><p>Returns a copy of the string <code>str</code> with extra padding, if necessary, so that its total number of characters is at least the absolute value of the <code>width</code> parameter.  If <code>width</code> is a positive number, then the string is padded to the right; if negative, it is padded to the left.  The optional <code>char</code> argument specifies the padding character(s) to use.  If not specified, it defaults to the space character.</p><p><strong>Examples</strong></p><ul><li><code>$pad(&quot;foo&quot;, 5)</code> =&gt; <code>&quot;foo  &quot;</code></li><li><code>$pad(&quot;foo&quot;, -5)</code> =&gt; <code>&quot;  foo&quot;</code></li><li><code>$pad(&quot;foo&quot;, -5, &quot;#&quot;)</code> =&gt; <code>&quot;##foo&quot;</code></li><li><code>$formatBase(35, 2) ~&gt; $pad(-8, &#x27;0&#x27;)</code> =&gt; <code>&quot;00100011&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="contains"></a><code>$contains()</code><a class="hash-link" href="#contains" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$contains(str, pattern)</code></p><p>Returns <code>true</code> if <code>str</code> is matched by <code>pattern</code>, otherwise it returns <code>false</code>. If <code>str</code> is not specified (i.e. this function is invoked with one argument), then the context value is used as the value of <code>str</code>.</p><p>The <code>pattern</code> parameter can either be a string or a regular expression (regex).  If it is a string, the function returns <code>true</code> if the characters within <code>pattern</code> are contained contiguously within <code>str</code>.  If it is a regex, the function will return <code>true</code> if the regex matches the contents of <code>str</code>.</p><p><strong>Examples</strong></p><ul><li><code>$contains(&quot;abracadabra&quot;, &quot;bra&quot;)</code> =&gt; <code>true</code></li><li><code>$contains(&quot;abracadabra&quot;, /a.*a/)</code> =&gt; <code>true</code></li><li><code>$contains(&quot;abracadabra&quot;, /ar.*a/)</code> =&gt; <code>false</code></li><li><code>$contains(&quot;Hello World&quot;, /wo/)</code> =&gt; <code>false</code></li><li><code>$contains(&quot;Hello World&quot;, /wo/i)</code> =&gt; <code>true</code></li><li><code>Phone[$contains(number, /^077/)]</code> =&gt; <code>{ &quot;type&quot;: &quot;mobile&quot;, &quot;number&quot;: &quot;077 7700 1234&quot; }</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="split"></a><code>$split()</code><a class="hash-link" href="#split" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$split(str, separator [, limit])</code></p><p>Splits the <code>str</code> parameter into an array of substrings.  If <code>str</code> is not specified, then the context value is used as the value of <code>str</code>.  It is an error if <code>str</code> is not a string.</p><p>The <code>separator</code> parameter can either be a string or a regular expression (regex).  If it is a string, it specifies the characters within <code>str</code> about which it should be split.  If it is the empty string, <code>str</code> will be split into an array of single characters.  If it is a regex, it splits the string around any sequence of characters that match the regex.</p><p>The optional <code>limit</code> parameter is a number that specifies the maximum number of substrings to  include in the resultant array.  Any additional substrings are discarded.  If <code>limit</code> is not  specified, then <code>str</code> is fully split with no limit to the size of the resultant array.  It is an error if <code>limit</code> is not a non-negative number.</p><p><strong>Examples</strong></p><ul><li><code>$split(&quot;so many words&quot;, &quot; &quot;)</code> =&gt; <code>[ &quot;so&quot;, &quot;many&quot;, &quot;words&quot; ]</code></li><li><code>$split(&quot;so many words&quot;, &quot; &quot;, 2)</code> =&gt; <code>[ &quot;so&quot;, &quot;many&quot; ]</code></li><li><code>$split(&quot;too much, punctuation. hard; to read&quot;, /[ ,.;]+/)</code> =&gt; <code>[&quot;too&quot;, &quot;much&quot;, &quot;punctuation&quot;, &quot;hard&quot;, &quot;to&quot;, &quot;read&quot;]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="join"></a><code>$join()</code><a class="hash-link" href="#join" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$join(array[, separator])</code></p><p>Joins an array of component strings into a single concatenated string with each component string separated by the optional <code>separator</code> parameter.</p><p>It is an error if the input array contains an item which isn&#x27;t a string.</p><p>If <code>separator</code> is not specified, then it is assumed to be the empty string, i.e. no separator between the component strings.  It is an error if <code>separator</code> is not a string.</p><p><strong>Examples</strong></p><ul><li><code>$join([&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;])</code> =&gt; <code>&quot;abc&quot;</code></li><li><code>$split(&quot;too much, punctuation. hard; to read&quot;, /[ ,.;]+/, 3) ~&gt; $join(&#x27;, &#x27;)</code> =&gt; <code>&quot;too, much, punctuation&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="match"></a><code>$match()</code><a class="hash-link" href="#match" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$match(str, pattern [, limit])</code></p><p>Applies the <code>str</code> string to the <code>pattern</code> regular expression and returns an array of objects, with each object containing information about each occurrence of a match withing <code>str</code>.</p><p>The object contains the following fields:</p><ul><li><code>match</code> - the substring that was matched by the regex.</li><li><code>index</code> - the offset (starting at zero) within <code>str</code> of this match.</li><li><code>groups</code> - if the regex contains capturing groups (parentheses), this contains an array of strings representing each captured group.</li></ul><p>If <code>str</code> is not specified, then the context value is used as the value of <code>str</code>.  It is an error if <code>str</code> is not a string.</p><p><strong>Examples</strong></p><p><code>$match(&quot;ababbabbcc&quot;,/a(b+)/)</code> =&gt;</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;match&quot;: &quot;ab&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;index&quot;: 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;groups&quot;: [&quot;b&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;match&quot;: &quot;abb&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;index&quot;: 2,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;groups&quot;: [&quot;bb&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;match&quot;: &quot;abb&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;index&quot;: 5,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;groups&quot;: [&quot;bb&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="replace"></a><code>$replace()</code><a class="hash-link" href="#replace" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$replace(str, pattern, replacement [, limit])</code></p><p>Finds occurrences of <code>pattern</code> within <code>str</code> and replaces them with <code>replacement</code>.</p><p>If <code>str</code> is not specified, then the context value is used as the value of <code>str</code>.  It is an error if <code>str</code> is not a string.</p><p>The <code>pattern</code> parameter can either be a string or a regular expression (regex).  If it is a string, it specifies the substring(s) within <code>str</code> which should be replaced.  If it is a regex, its is used to find .</p><p>The <code>replacement</code> parameter can either be a string or a function.  If it is a string, it specifies the sequence of characters that replace the substring(s) that are matched by <code>pattern</code>.  If <code>pattern</code> is a regex, then the <code>replacement</code> string can refer to the characters that were matched by the regex as well as any of the captured groups using a <code>$</code> followed by a number <code>N</code>:</p><ul><li>If <code>N = 0</code>, then it is replaced by substring matched by the regex as a whole.</li><li>If <code>N &gt; 0</code>, then it is replaced by the substring captured by the Nth parenthesised group in the regex.</li><li>If <code>N</code> is greater than the number of captured groups, then it is replaced by the empty string.</li><li>A literal <code>$</code> character must be written as <code>$$</code> in the <code>replacement</code> string</li></ul><p>If the <code>replacement</code> parameter is a function, then it is invoked for each match occurrence of the <code>pattern</code> regex.  The <code>replacement</code> function must take a single parameter which will be the object structure of a regex match as described in the <code>$match</code> function; and must return a string.</p><p>The optional <code>limit</code> parameter,  is a number that specifies the maximum number of replacements to make before stopping.  The remainder of the input beyond this limit will be copied to the output unchanged.</p><p><strong>Examples</strong></p><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$replace(&quot;John Smith and John Jones&quot;, &quot;John&quot;, &quot;Mr&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Mr Smith and Mr Jones&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$replace(&quot;John Smith and John Jones&quot;, &quot;John&quot;, &quot;Mr&quot;, 1)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Mr Smith and John Jones&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$replace(&quot;abracadabra&quot;, /a.*?a/, &quot;*&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;*c*bra&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$replace(&quot;John Smith&quot;, /(\w+)\s(\w+)/, &quot;$2, $1&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Smith, John&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$replace(&quot;265USD&quot;, /([0-9]+)USD/, &quot;$$$1&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;$265&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$convert := function($m) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ($number($m.groups[0]) - 32) * 5/9 &amp; &quot;C&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$replace(&quot;temperature = 68F today&quot;, /(\d+)F/, $convert)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>  <strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;temperature = 20C today&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="eval"></a><code>$eval()</code><a class="hash-link" href="#eval" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$eval(expr [, context])</code></p><p>Parses and evaluates the string <code>expr</code> which contains literal JSON or a JSONata expression using the current context as the context for evaluation.</p><p><strong>Examples</strong></p><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$eval(&quot;[1,2,3]&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1, 2, 3]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Query</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$eval(&#x27;[1,$string(2),3]&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Result</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1,&quot;2&quot;,3]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Optionally override the context by specifying the second parameter</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="base64encode"></a><code>$base64encode()</code><a class="hash-link" href="#base64encode" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$base64encode()</code></p><p>Converts an ASCII string to a base 64 representation. Each each character in the string is treated as a byte of binary data. This requires that all characters in the string are in the 0x00 to 0xFF range, which includes all characters in URI encoded strings. Unicode characters outside of that range are not supported.</p><p><strong>Examples</strong></p><ul><li><code>$base64encode(&quot;myuser:mypass&quot;)</code> =&gt; <code>&quot;bXl1c2VyOm15cGFzcw==&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="base64decode"></a><code>$base64decode()</code><a class="hash-link" href="#base64decode" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$base64decode()</code></p><p>Converts base 64 encoded bytes to a string, using a UTF-8 Unicode codepage.</p><p><strong>Examples</strong></p><ul><li><code>$base64decode(&quot;bXl1c2VyOm15cGFzcw==&quot;)</code> =&gt; <code>&quot;myuser:mypass&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encodeurlcomponent"></a><code>$encodeUrlComponent()</code><a class="hash-link" href="#encodeurlcomponent" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$encodeUrlComponent(str)</code></p><p>Encodes a Uniform Resource Locator (URL) component by replacing each instance of certain characters by one, two, three, or four escape sequences representing the UTF-8 encoding of the character.</p><p><strong>Examples</strong></p><ul><li><code>$encodeUrlComponent(&quot;?x=test&quot;)</code> =&gt; <code>&quot;%3Fx%3Dtest&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encodeurl"></a><code>$encodeUrl()</code><a class="hash-link" href="#encodeurl" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$encodeUrl(str)</code></p><p>Encodes a Uniform Resource Locator (URL) by replacing each instance of certain characters by one, two, three, or four escape sequences representing the UTF-8 encoding of the character.</p><p><strong>Examples</strong></p><ul><li><code>$encodeUrl(&quot;https://mozilla.org/?x=ÑˆÐµÐ»Ð»Ñ‹&quot;)</code> =&gt; <code>&quot;https://mozilla.org/?x=%D1%88%D0%B5%D0%BB%D0%BB%D1%8B&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="decodeurlcomponent"></a><code>$decodeUrlComponent()</code><a class="hash-link" href="#decodeurlcomponent" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$decodeUrlComponent(str)</code></p><p>Decodes a Uniform Resource Locator (URL) component previously created by encodeUrlComponent.</p><p><strong>Examples</strong></p><ul><li><code>$decodeUrlComponent(&quot;%3Fx%3Dtest&quot;)</code> =&gt; <code>&quot;?x=test&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="decodeurl"></a><code>$decodeUrl()</code><a class="hash-link" href="#decodeurl" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$decodeUrl(str)</code></p><p>Decodes a Uniform Resource Locator (URL) previously created by encodeUrl.</p><p><strong>Examples</strong></p><ul><li><code>$decodeUrl(&quot;https://mozilla.org/?x=%D1%88%D0%B5%D0%BB%D0%BB%D1%8B&quot;)</code> =&gt; <code>&quot;https://mozilla.org/?x=ÑˆÐµÐ»Ð»Ñ‹&quot;</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="numeric-functions"></a>Numeric functions<a class="hash-link" href="#numeric-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="number"></a><code>$number()</code><a class="hash-link" href="#number" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$number(arg)</code></p><p>Casts the <code>arg</code> parameter to a number using the following casting rules</p><ul><li>Numbers are unchanged</li><li>Strings that contain a sequence of characters that represent a legal JSON number are converted to that number</li><li>Boolean <code>true</code> casts to <code>1</code>, Boolean <code>false</code> casts to <code>0</code></li><li>All other values cause an error to be thrown.</li></ul><p>If <code>arg</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>arg</code>. </p><p><strong>Examples</strong>  </p><ul><li><code>$number(&quot;5&quot;)</code> =&gt; <code>5</code>  </li><li><code>[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;].$number()</code> =&gt; <code>[1, 2, 3, 4, 5]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="abs"></a><code>$abs()</code><a class="hash-link" href="#abs" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$abs(number)</code></p><p>Returns the absolute value of the <code>number</code> parameter, i.e. if the number is negative, it returns the positive value.</p><p>If <code>number</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>number</code>. </p><p><strong>Examples</strong>  </p><ul><li><code>$abs(5)</code> =&gt; <code>5</code>  </li><li><code>$abs(-5)</code> =&gt; <code>-5</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="floor"></a><code>$floor()</code><a class="hash-link" href="#floor" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$floor(number)</code></p><p>Returns the value of <code>number</code> rounded down to the nearest integer that is smaller or equal to <code>number</code>. </p><p>If <code>number</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>number</code>. </p><p><strong>Examples</strong>  </p><ul><li><code>$floor(5)</code> =&gt; <code>5</code>  </li><li><code>$floor(5.3)</code> =&gt; <code>5</code>  </li><li><code>$floor(5.8)</code> =&gt; <code>5</code>  </li><li><code>$floor(-5.3)</code> =&gt; <code>-6</code>  </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ceil"></a><code>$ceil()</code><a class="hash-link" href="#ceil" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$ceil(number)</code></p><p>Returns the value of <code>number</code> rounded up to the nearest integer that is greater than or equal to <code>number</code>. </p><p>If <code>number</code> is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of <code>number</code>. </p><p><strong>Examples</strong>  </p><ul><li><code>$ceil(5)</code> =&gt; <code>5</code>  </li><li><code>$ceil(5.3)</code> =&gt; <code>6</code>  </li><li><code>$ceil(5.8)</code> =&gt; <code>6</code>  </li><li><code>$ceil(-5.3)</code> =&gt; <code>-5</code>  </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="round"></a><code>$round()</code><a class="hash-link" href="#round" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$round(number [, precision])</code></p><p>Returns the value of the <code>number</code> parameter rounded to the number of decimal places specified by the optional <code>precision</code> parameter.  </p><p>The <code>precision</code> parameter (which must be an integer) species the number of decimal places to be present in the rounded number.   If <code>precision</code> is not specified then it defaults to the value <code>0</code> and the number is rounded to the nearest integer.  If <code>precision</code> is negative, then its value specifies which column to round to on the left side of the decimal place</p><p>This function uses the <a href="https://en.wikipedia.org/wiki/Rounding#Round_half_to_even" target="_blank" rel="noopener noreferrer">Round half to even</a> strategy to decide which way to round numbers that fall exactly between two candidates at the specified precision.  This strategy is commonly used in financial calculations and is the default rounding mode in IEEE 754.</p><p><strong>Examples</strong>  </p><ul><li><code>$round(123.456)</code> =&gt; <code>123</code>  </li><li><code>$round(123.456, 2)</code> =&gt; <code>123.46</code>  </li><li><code>$round(123.456, -1)</code> =&gt; <code>120</code>  </li><li><code>$round(123.456, -2)</code> =&gt; <code>100</code>  </li><li><code>$round(11.5)</code> =&gt; <code>12</code>  </li><li><code>$round(12.5)</code> =&gt; <code>12</code>  </li><li><code>$round(125, -1)</code> =&gt; <code>120</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="power"></a><code>$power()</code><a class="hash-link" href="#power" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$power(base, exponent)</code></p><p>Returns the value of <code>base</code> raised to the power of <code>exponent</code> (<code>base<sup>exponent</sup></code>).</p><p>If <code>base</code> is not specified (i.e. this function is invoked with one argument), then the context value is used as the value of <code>base</code>. </p><p>An error is thrown if the values of <code>base</code> and <code>exponent</code> lead to a value that cannot be represented as a JSON number (e.g. Infinity, complex numbers).</p><p><strong>Examples</strong>  </p><ul><li><code>$power(2, 8)</code> =&gt; <code>256</code>  </li><li><code>$power(2, 0.5)</code> =&gt; <code>1.414213562373</code>  </li><li><code>$power(2, -2)</code> =&gt; <code>0.25</code>  </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sqrt"></a><code>$sqrt()</code><a class="hash-link" href="#sqrt" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$sqrt(number)</code></p><p>Returns the square root of the value of the <code>number</code> parameter.</p><p>If <code>number</code> is not specified (i.e. this function is invoked with one argument), then the context value is used as the value of <code>number</code>. </p><p>An error is thrown if the value of <code>number</code> is negative.</p><p><strong>Examples</strong>  </p><ul><li><code>$sqrt(4)</code> =&gt; <code>2</code></li><li><code>$sqrt(2)</code> =&gt; <code>1.414213562373</code>  </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="random"></a><code>$random()</code><a class="hash-link" href="#random" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$random()</code></p><p>Returns a pseudo random number greater than or equal to zero and less than one (<code>0 â‰¤ n &lt; 1</code>) </p><p><strong>Examples</strong>  </p><ul><li><code>$random()</code> =&gt; <code>0.7973541067127</code>  </li><li><code>$random()</code> =&gt; <code>0.4029142127028</code>  </li><li><code>$random()</code> =&gt; <code>0.6558078550072</code>  </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="formatnumber"></a><code>$formatNumber()</code><a class="hash-link" href="#formatnumber" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$formatNumber(number, picture [, options])</code></p><p>Casts the <code>number</code> to a string and formats it to a decimal representation as specified by the <code>picture</code> string.</p><p>The behaviour of this function is consistent with the XPath/XQuery function <a href="https://www.w3.org/TR/xpath-functions-31/#func-format-number" target="_blank" rel="noopener noreferrer">fn:format-number</a> as defined in the XPath F&amp;O 3.1 specification.  The picture string parameter defines how the number is formatted and has the <a href="https://www.w3.org/TR/xpath-functions-31/#syntax-of-picture-string" target="_blank" rel="noopener noreferrer">same syntax</a> as fn:format-number.</p><p>The optional third argument <code>options</code> is used to override the default locale specific formatting characters such as the decimal separator.  If supplied, this argument must be an object containing name/value pairs specified in the <a href="https://www.w3.org/TR/xpath-functions-31/#defining-decimal-format" target="_blank" rel="noopener noreferrer">decimal format</a> section of the XPath F&amp;O 3.1 specification.</p><p><strong>Examples</strong></p><ul><li><code>$formatNumber(12345.6, &#x27;#,###.00&#x27;)</code> =&gt; <code>&quot;12,345.60&quot;</code>   </li><li><code>$formatNumber(1234.5678, &quot;00.000e0&quot;)</code> =&gt; <code>&quot;12.346e2&quot;</code>   </li><li><code>$formatNumber(34.555, &quot;#0.00;(#0.00)&quot;)</code> =&gt; <code>&quot;34.56&quot;</code>   </li><li><code>$formatNumber(-34.555, &quot;#0.00;(#0.00)&quot;)</code> =&gt; <code>&quot;(34.56)&quot;</code>   </li><li><code>$formatNumber(0.14, &quot;01%&quot;)</code> =&gt; <code>&quot;14%&quot;</code>   </li><li><code>$formatNumber(0.14, &quot;###pm&quot;, {&quot;per-mille&quot;: &quot;pm&quot;})</code> =&gt; <code>&quot;140pm&quot;</code>   </li><li><code>$formatNumber(1234.5678, &quot;â‘ â‘ .â‘ â‘ â‘ eâ‘ &quot;, {&quot;zero-digit&quot;: &quot;\u245f&quot;})</code> =&gt; <code>&quot;â‘ â‘¡.â‘¢â‘£â‘¥eâ‘¡&quot;</code>   </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="formatbase"></a><code>$formatBase()</code><a class="hash-link" href="#formatbase" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$formatBase(number [, radix])</code></p><p>Casts the <code>number</code> to a string and formats it to an integer represented in the number base specified by the <code>radix</code> argument.  If <code>radix</code> is not specified, then it defaults to base 10.  <code>radix</code> can be between 2 and 36, otherwise an error is thrown.</p><p><strong>Examples</strong></p><ul><li><code>$formatBase(100, 2)</code> =&gt; <code>&quot;1100100&quot;</code></li><li><code>$formatBase(2555, 16)</code> =&gt; <code>&quot;9fb&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="formatinteger"></a><code>$formatInteger()</code><a class="hash-link" href="#formatinteger" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$formatInteger(number, picture)</code></p><p>Casts the <code>number</code> to a string and formats it to an integer representation as specified by the <code>picture</code> string.</p><p>The behaviour of this function is consistent with the two-argument version of the XPath/XQuery function <a href="https://www.w3.org/TR/xpath-functions-31/#func-format-integer" target="_blank" rel="noopener noreferrer">fn:format-integer</a> as defined in the XPath F&amp;O 3.1 specification.  The picture string parameter defines how the number is formatted and has the same syntax as fn:format-integer.</p><p><strong>Examples</strong></p><ul><li><code>$formatInteger(2789, &#x27;w&#x27;)</code> =&gt; <code>&quot;two thousand, seven hundred and eighty-nine&quot;</code></li><li><code>$formatInteger(1999, &#x27;I&#x27;)</code> =&gt; <code>&quot;MCMXCIX&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="parseinteger"></a><code>$parseInteger()</code><a class="hash-link" href="#parseinteger" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$parseInteger(string, picture)</code></p><p>Parses the contents of the <code>string</code> parameter to an integer (as a JSON number) using the format specified by the <code>picture</code> string.
The picture string parameter has the same format as <code>$formatInteger</code>. Although the XPath specification does not have an equivalent
function for parsing integers, this capability has been added to JSONata.</p><p><strong>Examples</strong></p><ul><li><code>$parseInteger(&quot;twelve thousand, four hundred and seventy-six&quot;, &#x27;w&#x27;)</code> =&gt; <code>12476</code></li><li><code>$parseInteger(&#x27;12,345,678&#x27;, &#x27;#,##0&#x27;)</code> =&gt; <code>12345678</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="numeric-aggregation-functions"></a>Numeric aggregation functions<a class="hash-link" href="#numeric-aggregation-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sum"></a><code>$sum()</code><a class="hash-link" href="#sum" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$sum(array)</code></p><p>Returns the arithmetic sum of an array of numbers.  It is an error if the input array contains an item which isn&#x27;t a number.</p><p><strong>Example</strong></p><ul><li><code>$sum([5,1,3,7,4])</code> =&gt; <code>20</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="max"></a><code>$max()</code><a class="hash-link" href="#max" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$max(array)</code></p><p>Returns the maximum number in an array of numbers.  It is an error if the input array contains an item which isn&#x27;t a number.</p><p><strong>Example</strong></p><ul><li><code>$max([5,1,3,7,4])</code> =&gt; <code>7</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="min"></a><code>$min()</code><a class="hash-link" href="#min" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$min(array)</code></p><p>Returns the minimum number in an array of numbers.  It is an error if the input array contains an item which isn&#x27;t a number.</p><p><strong>Example</strong></p><ul><li><code>$min([5,1,3,7,4])</code> =&gt; <code>1</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="average"></a><code>$average()</code><a class="hash-link" href="#average" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$average(array)</code></p><p>Returns the mean value of an array of numbers.  It is an error if the input array contains an item which isn&#x27;t a number.</p><p><strong>Example</strong></p><ul><li><code>$average([5,1,3,7,4])</code> =&gt; <code>4</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boolean-functions"></a>Boolean functions<a class="hash-link" href="#boolean-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boolean"></a><code>$boolean()</code><a class="hash-link" href="#boolean" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$boolean(arg)</code></p><p>Casts the argument to a Boolean using the following rules:</p><table><thead><tr><th>Argument type</th><th>Result</th></tr></thead><tbody><tr><td>Boolean</td><td>unchanged</td></tr><tr><td>string: empty</td><td><code>false</code></td></tr><tr><td>string: non-empty</td><td><code>true</code></td></tr><tr><td>number: 0</td><td><code>false</code></td></tr><tr><td>number: non-zero</td><td><code>true</code></td></tr><tr><td>null</td><td><code>false</code></td></tr><tr><td>array: empty</td><td><code>false</code></td></tr><tr><td>array: contains a member that casts to <code>true</code></td><td><code>true</code></td></tr><tr><td>array: all members cast to <code>false</code></td><td><code>false</code></td></tr><tr><td>object: empty</td><td><code>false</code></td></tr><tr><td>object: non-empty</td><td><code>true</code></td></tr><tr><td>function</td><td><code>false</code></td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="not"></a><code>$not()</code><a class="hash-link" href="#not" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$not(arg)</code></p><p>Returns Boolean NOT on the argument.  <code>arg</code> is first cast to a boolean</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="exists"></a><code>$exists()</code><a class="hash-link" href="#exists" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$exists(arg)</code></p><p>Returns Boolean <code>true</code> if the arg expression evaluates to a value, or <code>false</code> if the expression does not match anything (e.g. a path to a non-existent field reference).</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="array-functions"></a>Array Functions<a class="hash-link" href="#array-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="count"></a><code>$count()</code><a class="hash-link" href="#count" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$count(array)</code></p><p>Returns the number of items in the <code>array</code> parameter.  If the <code>array</code> parameter is not an array, but rather a value of another JSON type, then the parameter is treated as a singleton array containing that value, and this function returns <code>1</code>.</p><p>If <code>array</code> is not specified, then the context value is used as the value of <code>array</code>.</p><p><strong>Examples</strong></p><ul><li><code>$count([1,2,3,1])</code> =&gt; <code>4</code></li><li><code>$count(&quot;hello&quot;)</code> =&gt; 1</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="append"></a><code>$append()</code><a class="hash-link" href="#append" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$append(array1, array2)</code></p><p>Returns an array containing the values in <code>array1</code> followed by the values in <code>array2</code>.  If either parameter is not an array, then it is treated as a singleton array containing that value.</p><p><strong>Examples</strong></p><ul><li><code>$append([1,2,3], [4,5,6])</code> =&gt; <code>[1,2,3,4,5,6]</code></li><li><code>$append([1,2,3], 4)</code> =&gt; <code>[1,2,3,4]</code></li><li><code>$append(&quot;Hello&quot;, &quot;World&quot;)</code> =&gt; <code>[&quot;Hello&quot;, &quot;World&quot;]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sort"></a><code>$sort()</code><a class="hash-link" href="#sort" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$sort(array [, function])</code></p><p>Returns an array containing all the values in the <code>array</code> parameter, but sorted into order.  If no <code>function</code> parameter is supplied, then the <code>array</code> parameter must contain only numbers or only strings, and they will be sorted in order of increasing number, or increasing unicode codepoint respectively.</p><p>If a comparator <code>function</code> is supplied, then is must be a function that takes two parameters:</p><p><code>function(left, right)</code></p><p>This function gets invoked by the sorting algorithm to compare two values <code>left</code> and <code>right</code>.  If the value of <code>left</code> should be placed after the value of <code>right</code> in the desired sort order, then the function must return Boolean <code>true</code> to indicate a swap.  Otherwise it must return <code>false</code>.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$sort(Account.Order.Product, function($l, $r) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $l.Description.Weight &gt; $r.Description.Weight</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This sorts the products in order of increasing weight.</p><p>The sorting algorithm is <em>stable</em> which means that values within the original array which are the same according to the comparator function will remain in the original order in the sorted array.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reverse"></a><code>$reverse()</code><a class="hash-link" href="#reverse" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$reverse(array)</code></p><p>Returns an array containing all the values from the <code>array</code> parameter, but in reverse order.</p><p><strong>Examples</strong></p><ul><li><code>$reverse([&quot;Hello&quot;, &quot;World&quot;])</code> =&gt; <code>[&quot;World&quot;, &quot;Hello&quot;]</code></li><li><code>[1..5] ~&gt; $reverse()</code> =&gt; <code>[5, 4, 3, 2, 1]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="shuffle"></a><code>$shuffle()</code><a class="hash-link" href="#shuffle" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$shuffle(array)</code></p><p>Returns an array containing all the values from the <code>array</code> parameter, but shuffled into random order.</p><p><strong>Examples</strong></p><ul><li><code>$shuffle([1..9])</code> =&gt; <code>[6, 8, 2, 3, 9, 5, 1, 4, 7]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="distinct"></a><code>$distinct()</code><a class="hash-link" href="#distinct" title="Direct link to heading">#</a></h2><p><strong>Signature</strong> <code>$distinct(array)</code></p><p>Returns an array containing all the values from the <code>array</code> parameter, but with any duplicates removed.  Values are tested for deep equality as if by using the <a href="#equals">equality operator</a>.</p><p><strong>Examples</strong></p><ul><li><code>$distinct([1,2,3,3,4,3,5])</code> =&gt; <code>[1, 2, 3, 4, 5]</code></li><li><code>$distinct(Account.Order.Product.Description.Colour)</code> =&gt; <code>[ &quot;Purple&quot;, &quot;Orange&quot;, &quot;Black&quot; ]</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="zip"></a><code>$zip()</code><a class="hash-link" href="#zip" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$zip(array1, ...)</code></p><p>Returns a convolved (zipped) array containing grouped arrays of values from the <code>array1</code> ... <code>arrayN</code> arguments from index 0, 1, 2, etc.</p><p>This function accepts a variable number of arguments.  The length of the returned array is equal to the length of the shortest array in the arguments.</p><p><strong>Examples</strong></p><ul><li><code>$zip([1,2,3], [4,5,6])</code> =&gt; <code>[[1,4] ,[2,5], [3,6]]</code></li><li><code>$zip([1,2,3],[4,5],[7,8,9])</code> =&gt; <code>[[1,4,7], [2,5,8]]</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="object-functions"></a>Object functions<a class="hash-link" href="#object-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="keys"></a><code>$keys()</code><a class="hash-link" href="#keys" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$keys(object)</code></p><p>Returns an array containing the keys in the object.  If the argument is an array of objects, then the array returned contains a de-duplicated list of all the keys in all of the objects.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lookup"></a><code>$lookup()</code><a class="hash-link" href="#lookup" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$lookup(object, key)</code></p><p>Returns the value associated with <code>key</code> in <code>object</code>. If the first argument is an array of objects, then all of the objects in the array are searched, and the values associated with all occurrences of <code>key</code> are returned.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spread"></a><code>$spread()</code><a class="hash-link" href="#spread" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$spread(object)</code></p><p>Splits an <code>object</code> containing key/value pairs into an array of objects, each of which has a single key/value pair from the input <code>object</code>.  If the parameter is an array of objects, then the resultant array contains an object for every key/value pair in every object in the supplied array.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="merge"></a><code>$merge()</code><a class="hash-link" href="#merge" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$merge(array&lt;object&gt;)</code></p><p>Merges an array of objects into a single object containing all the key/value pairs from each of the objects in the input array.  If any of the input objects contain the same key, then the returned object will contain the value of the last one in the array.  It is an error if the input array contains an item that is not an object.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sift"></a><code>$sift()</code><a class="hash-link" href="#sift" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$sift(object, function)</code></p><p>See definition under &#x27;Higher-order functions&#x27;</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="each"></a><code>$each()</code><a class="hash-link" href="#each" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$each(object, function)</code></p><p>Returns an array containing the values return by the <code>function</code> when applied to each key/value pair in the <code>object</code>.</p><p>The <code>function</code> parameter will get invoked with two arguments:</p><p><code>function(value, name)</code></p><p>where the <code>value</code> parameter is the value of each name/value pair in the object and <code>name</code> is its name.  The <code>name</code> parameter is optional.</p><p><strong>Examples</strong></p><p><code>$each(Address, function($v, $k) {$k &amp; &quot;: &quot; &amp; $v})</code></p><p>=&gt;</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Street: Hursley Park&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;City: Winchester&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Postcode: SO21 2JN&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="error"></a><code>$error()</code><a class="hash-link" href="#error" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong><code>$error(message)</code></p><p>Deliberately throws an error with an optional <code>message</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="assert"></a><code>$assert()</code><a class="hash-link" href="#assert" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong><code>$assert(condition, message)</code></p><p>If condition is true, the function returns undefined. If the condition is false, an exception is thrown with the message as the message of the exception.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="type"></a><code>$type()</code><a class="hash-link" href="#type" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong><code>$type(value)</code></p><p>Evaluates the type of <code>value</code> and returns one of the following strings:</p><ul><li><code>&quot;null&quot;</code></li><li><code>&quot;number&quot;</code></li><li><code>&quot;string&quot;</code></li><li><code>&quot;boolean&quot;</code></li><li><code>&quot;array&quot;</code></li><li><code>&quot;object&quot;</code></li><li><code>&quot;function&quot;</code>
Returns (non-string) <code>undefined</code> when <code>value</code> is <code>undefined</code>.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="datetime-functions"></a>Date/Time functions<a class="hash-link" href="#datetime-functions" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="now"></a><code>$now()</code><a class="hash-link" href="#now" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$now([picture [, timezone]])</code></p><p>Generates a UTC timestamp in ISO 8601 compatible format and returns it as a string.  All invocations of <code>$now()</code> within an evaluation of an expression will all return the same timestamp value.</p><p>If the optional <code>picture</code> and <code>timezone</code> parameters are supplied, then the current timestamp is formatted as described by the <a href="#frommillis"><code>$fromMillis()</code></a> function.</p><p><strong>Examples</strong></p><ul><li><code>$now()</code> =&gt; <code>&quot;2017-05-15T15:12:59.152Z&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="millis"></a><code>$millis()</code><a class="hash-link" href="#millis" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$millis()</code></p><p>Returns the number of milliseconds since the Unix <em>Epoch</em> (1 January, 1970 UTC) as a number.  All invocations of <code>$millis()</code> within an evaluation of an expression will all return the same value.</p><p><strong>Examples</strong>  </p><ul><li><code>$millis()</code> =&gt; <code>1502700297574</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="frommillis"></a><code>$fromMillis()</code><a class="hash-link" href="#frommillis" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$fromMillis(number [, picture [, timezone]])</code></p><p>Convert the <code>number</code> representing milliseconds since the Unix <em>Epoch</em> (1 January, 1970 UTC) to a formatted string representation of the timestamp  as specified by the <code>picture</code> string.</p><p>If the optional <code>picture</code> parameter is omitted, then the timestamp is formatted in the <a href="https://www.iso.org/iso-8601-date-and-time-format.html" target="_blank" rel="noopener noreferrer">ISO 8601</a> format.</p><p>If the optional <code>picture</code> string is supplied, then the timestamp is formatted occording to the representation specified in that string.
The behaviour of this function is consistent with the two-argument version of the XPath/XQuery function <a href="https://www.w3.org/TR/xpath-functions-31/#func-format-dateTime" target="_blank" rel="noopener noreferrer">fn:format-dateTime</a> as defined in the XPath F&amp;O 3.1 specification.  The picture string parameter defines how the timestamp is formatted and has the <a href="https://www.w3.org/TR/xpath-functions-31/#date-picture-string" target="_blank" rel="noopener noreferrer">same syntax</a> as fn:format-dateTime.</p><p>If the optional <code>timezone</code> string is supplied, then the formatted timestamp will be in that timezone.  The <code>timezone</code> string should be in the
format &quot;Â±HHMM&quot;, where Â± is either the plus or minus sign and HHMM is the offset in hours and minutes from UTC.  Positive offset for timezones
east of UTC, negative offset for timezones west of UTC. </p><p><strong>Examples</strong></p><ul><li><code>$fromMillis(1510067557121)</code> =&gt; <code>&quot;2017-11-07T15:12:37.121Z&quot;</code></li><li><code>$fromMillis(1510067557121, &#x27;[M01]/[D01]/[Y0001] [h#1]:[m01][P]&#x27;)</code> =&gt; <code>&quot;11/07/2017 3:12pm&quot;</code></li><li><code>$fromMillis(1510067557121, &#x27;[H01]:[m01]:[s01] [z]&#x27;, &#x27;-0500&#x27;)</code> =&gt; <code>&quot;10:12:37 GMT-05:00&quot;</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tomillis"></a><code>$toMillis()</code><a class="hash-link" href="#tomillis" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$toMillis(timestamp [, picture])</code></p><p>Convert a <code>timestamp</code> string to the number of milliseconds since the Unix <em>Epoch</em> (1 January, 1970 UTC) as a number. </p><p>If the optional <code>picture</code> string is not specified, then the format of the timestamp is assumed to be <a href="https://www.iso.org/iso-8601-date-and-time-format.html" target="_blank" rel="noopener noreferrer">ISO 8601</a>. An error is thrown if the string is not in the correct format.</p><p>If the <code>picture</code> string is specified, then the format is assumed to be described by this picture string using the <a href="https://www.w3.org/TR/xpath-functions-31/#date-picture-string" target="_blank" rel="noopener noreferrer">same syntax</a> as the XPath/XQuery function <a href="https://www.w3.org/TR/xpath-functions-31/#func-format-dateTime" target="_blank" rel="noopener noreferrer">fn:format-dateTime</a>, defined in the XPath F&amp;O 3.1 specification.  </p><p><strong>Examples</strong></p><ul><li><code>$toMillis(&quot;2017-11-07T15:07:54.972Z&quot;)</code> =&gt; <code>1510067274972</code></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="higher-order-functions-1"></a>Higher order functions<a class="hash-link" href="#higher-order-functions-1" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="map"></a><code>$map()</code><a class="hash-link" href="#map" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$map(array, function)</code></p><p>Returns an array containing the results of applying the <code>function</code> parameter to each value in the <code>array</code> parameter.</p><p>The function that is supplied as the second parameter must have the following signature:</p><p><code>function(value [, index [, array]])</code></p><p>Each value in the input array is passed in as the first parameter in the supplied function.  The index (position) of that value in the input array is passed in as the second parameter, if specified.  The whole input array is passed in as the third parameter, if specified.</p><p><strong>Examples</strong></p><ul><li><code>$map([1..5], $string)</code> =&gt; <code>[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;]</code></li></ul><p>With user-defined (lambda) function:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$map(Email.address, function($v, $i, $a) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;Item &#x27; &amp; ($i+1) &amp; &#x27; of &#x27; &amp; $count($a) &amp; &#x27;: &#x27; &amp; $v</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>evaluates to:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Item 1 of 4: fred.smith@my-work.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Item 2 of 4: fsmith@my-work.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Item 3 of 4: freddy@my-social.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Item 4 of 4: frederic.smith@very-serious.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="filter"></a><code>$filter()</code><a class="hash-link" href="#filter" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$filter(array, function)</code></p><p>Returns an array containing only the values in the <code>array</code> parameter that satisfy the <code>function</code> predicate (i.e. <code>function</code> returns Boolean <code>true</code> when passed the value).</p><p>The function that is supplied as the second parameter must have the following signature:</p><p><code>function(value [, index [, array]])</code></p><p>Each value in the input array is passed in as the first parameter in the supplied function.  The index (position) of that value in the input array is passed in as the second parameter, if specified.  The whole input array is passed in as the third parameter, if specified.</p><p><strong>Example</strong>
The following expression returns all the products whose price is higher than average:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$filter(Account.Order.Product, function($v, $i, $a) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $v.Price &gt; $average($a.Price)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="single"></a><code>$single()</code><a class="hash-link" href="#single" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$single(array, function)</code></p><p>Returns the one and only one value in the <code>array</code> parameter that satisfy the <code>function</code> predicate (i.e. <code>function</code> returns Boolean <code>true</code> when passed the value).  Throws an exception if the number of matching values is not exactly one.</p><p>The function that is supplied as the second parameter must have the following signature:</p><p><code>function(value [, index [, array]])</code></p><p>Each value in the input array is passed in as the first parameter in the supplied function.  The index (position) of that value in the input array is passed in as the second parameter, if specified.  The whole input array is passed in as the third parameter, if specified.</p><p><strong>Example</strong>
The following expression the product in the order whose SKU is <code>&quot;0406654608&quot;</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$single(Account.Order.Product, function($v, $i, $a) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $v.SKU = &quot;0406654608&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reduce"></a><code>$reduce()</code><a class="hash-link" href="#reduce" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$reduce(array, function [, init])</code></p><p>Returns an aggregated value derived from applying the <code>function</code> parameter successively to each value in <code>array</code> in combination with the result of the previous application of the function.</p><p>The <code>function</code> must accept at least two arguments, and behaves like an infix operator between each value within the <code>array</code>.  The signature of this supplied function must be of the form:</p><p><code>myfunc($accumulator, $value[, $index[, $array]])</code></p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $product := function($i, $j){$i * $j};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  $reduce([1..5], $product)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This multiplies all the values together in the array <code>[1..5]</code> to return <code>120</code>.</p><p>If the optional <code>init</code> parameter is supplied, then that value is used as the initial value in the aggregation (fold) process.  If not supplied, the initial value is the first value in the <code>array</code> parameter.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sift-1"></a><code>$sift()</code><a class="hash-link" href="#sift-1" title="Direct link to heading">#</a></h2><p><strong>Signature:</strong> <code>$sift(object, function)</code></p><p>Returns an object that contains only the key/value pairs from the <code>object</code> parameter that satisfy the predicate <code>function</code> passed in as the second parameter.</p><p>If <code>object</code> is not specified, then the context value is used as the value of <code>object</code>.  It is an error if <code>object</code> is not an object.</p><p>The function that is supplied as the second parameter must have the following signature:</p><p><code>function(value [, key [, object]])</code></p><p>Each value in the input object is passed in as the first parameter in the supplied function.  The key (property name) of that value in the input object is passed in as the second parameter, if specified.  The whole input object is passed in as the third parameter, if specified.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Account.Order.Product.$sift(function($v, $k) {$k ~&gt; /^Product/})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This sifts each of the <code>Product</code> objects such that they only contain the fields whose keys start with the string &quot;Product&quot; (using a regex). This example returns:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Product Name&quot;: &quot;Bowler Hat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ProductID&quot;: 858383</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Product Name&quot;: &quot;Trilby hat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ProductID&quot;: 858236</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Product Name&quot;: &quot;Bowler Hat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ProductID&quot;: 858383</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ProductID&quot;: 345664,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Product Name&quot;: &quot;Cloak&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/BIDMCDigitalPsychiatry/LAMP-platform/edit/master/docs/jsonata.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-22T21:32:46.000Z" class="lastUpdatedDate_1WI_">4/22/2021</time> by <strong>Aditya Vaidyam</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#navigating-json-objects" class="table-of-contents__link">Navigating JSON Objects</a></li><li><a href="#navigating-json-arrays" class="table-of-contents__link">Navigating JSON Arrays</a></li><li><a href="#result-sequences" class="table-of-contents__link">Result sequences</a></li><li><a href="#sequence-flattening" class="table-of-contents__link">Sequence flattening</a></li><li><a href="#empty-sequences-and-singleton-sequences" class="table-of-contents__link">Empty sequences and singleton sequences</a><ul><li><a href="#top-level-arrays-nested-arrays-and-array-flattening" class="table-of-contents__link">Top level arrays, nested arrays and array flattening</a></li></ul></li><li><a href="#predicates" class="table-of-contents__link">Predicates</a></li><li><a href="#singleton-array-and-value-equivalence" class="table-of-contents__link">Singleton array and value equivalence</a></li><li><a href="#wildcards" class="table-of-contents__link">Wildcards</a></li><li><a href="#navigate-arbitrary-depths" class="table-of-contents__link">Navigate arbitrary depths</a></li><li><a href="#string-expressions" class="table-of-contents__link">String expressions</a></li><li><a href="#numeric-expressions" class="table-of-contents__link">Numeric expressions</a></li><li><a href="#comparison-expressions" class="table-of-contents__link">Comparison expressions</a></li><li><a href="#boolean-expressions" class="table-of-contents__link">Boolean expressions</a></li><li><a href="#array-constructors" class="table-of-contents__link">Array constructors</a></li><li><a href="#object-constructors" class="table-of-contents__link">Object constructors</a></li><li><a href="#json-literals" class="table-of-contents__link">JSON literals</a></li><li><a href="#parenthesized-expressions-and-blocks" class="table-of-contents__link">Parenthesized expressions and blocks</a></li><li><a href="#sorting" class="table-of-contents__link">Sorting</a></li><li><a href="#grouping" class="table-of-contents__link">Grouping</a></li><li><a href="#aggregation" class="table-of-contents__link">Aggregation</a></li><li><a href="#the-jsonata-type-system" class="table-of-contents__link">The JSONata type system</a></li><li><a href="#sequences" class="table-of-contents__link">Sequences</a></li><li><a href="#jsonata-path-processing" class="table-of-contents__link">JSONata path processing</a></li><li><a href="#comments" class="table-of-contents__link">Comments</a></li><li><a href="#conditional-logic" class="table-of-contents__link">Conditional logic</a></li><li><a href="#variables" class="table-of-contents__link">Variables</a><ul><li><a href="#built-in-variables" class="table-of-contents__link">Built-in variables</a></li><li><a href="#variable-binding" class="table-of-contents__link">Variable binding</a></li></ul></li><li><a href="#functions" class="table-of-contents__link">Functions</a><ul><li><a href="#invoking-a-function" class="table-of-contents__link">Invoking a function</a></li><li><a href="#defining-a-function" class="table-of-contents__link">Defining a function</a></li><li><a href="#function-signatures" class="table-of-contents__link">Function signatures</a></li><li><a href="#recursive-functions" class="table-of-contents__link">Recursive functions</a></li><li><a href="#tail-call-optimization-tail-recursion" class="table-of-contents__link">Tail call optimization (Tail recursion)</a></li><li><a href="#higher-order-functions" class="table-of-contents__link">Higher order functions</a></li><li><a href="#functions-are-closures" class="table-of-contents__link">Functions are closures</a></li><li><a href="#partial-function-application" class="table-of-contents__link">Partial function application</a></li><li><a href="#function-chaining" class="table-of-contents__link">Function chaining</a></li><li><a href="#functions-as-first-class-values" class="table-of-contents__link">Functions as first class values</a></li><li><a href="#advanced-example---the-y-combinator" class="table-of-contents__link">Advanced example - The Y-combinator</a></li></ul></li><li><a href="#regular-expressions-in-query-predicates" class="table-of-contents__link">Regular expressions in query predicates</a></li><li><a href="#generic-matchers" class="table-of-contents__link">Generic matchers</a></li><li><a href="#writing-a-custom-matcher" class="table-of-contents__link">Writing a custom matcher</a></li><li><a href="#the-evaluation-time---now" class="table-of-contents__link">The &#39;evaluation timeâ€™ - $now()</a></li><li><a href="#json-and-iso-8601" class="table-of-contents__link">JSON and ISO 8601</a></li><li><a href="#support-for-other-datetime-formats" class="table-of-contents__link">Support for other date/time formats</a></li><li><a href="#-map" class="table-of-contents__link"><code>.</code> (Map)</a></li><li><a href="#---filter" class="table-of-contents__link"><code>[</code> ... <code>]</code> (Filter)</a></li><li><a href="#---order-by" class="table-of-contents__link"><code>^(</code> ... <code>)</code> (Order-by)</a></li><li><a href="#---reduce" class="table-of-contents__link"><code>{</code> ... <code>}</code> (Reduce)</a></li><li><a href="#-wildcard" class="table-of-contents__link"><code>*</code> (Wildcard)</a></li><li><a href="#-descendants" class="table-of-contents__link"><code>**</code> (Descendants)</a></li><li><a href="#-parent" class="table-of-contents__link"><code>%</code> (Parent)</a></li><li><a href="#-positional-variable-binding" class="table-of-contents__link"><code>#</code> (Positional variable binding)</a></li><li><a href="#-context-variable-binding" class="table-of-contents__link"><code>@</code> (Context variable binding)</a></li><li><a href="#-addition" class="table-of-contents__link"><code>+</code> (Addition)</a></li><li><a href="#--substractionnegation" class="table-of-contents__link"><code>-</code> (Substraction/Negation)</a></li><li><a href="#-multiplication" class="table-of-contents__link"><code>*</code> (Multiplication)</a></li><li><a href="#-division" class="table-of-contents__link"><code>/</code> (Division)</a></li><li><a href="#-modulo" class="table-of-contents__link"><code>%</code> (Modulo)</a></li><li><a href="#-range" class="table-of-contents__link"><code>..</code> (Range)</a></li><li><a href="#-equals" class="table-of-contents__link"><code>=</code> (Equals)</a></li><li><a href="#-not-equals" class="table-of-contents__link"><code>!=</code> (Not equals)</a></li><li><a href="#-greater-than" class="table-of-contents__link"><code>&gt;</code> (Greater than)</a></li><li><a href="#-less-than" class="table-of-contents__link"><code>&lt;</code> (Less than)</a></li><li><a href="#-greater-than-or-equals" class="table-of-contents__link"><code>&gt;=</code> (Greater than or equals)</a></li><li><a href="#-less-than-or-equals" class="table-of-contents__link"><code>&lt;=</code> (Less than or equals)</a></li><li><a href="#in-inclusion" class="table-of-contents__link"><code>in</code> (Inclusion)</a></li><li><a href="#and-boolean-and" class="table-of-contents__link"><code>and</code> (Boolean AND)</a></li><li><a href="#or-boolean-or" class="table-of-contents__link"><code>or</code> (Boolean OR)</a></li><li><a href="#-concatenation" class="table-of-contents__link"><code>&amp;</code> (Concatenation)</a></li><li><a href="#--conditional" class="table-of-contents__link"><code>? :</code> (Conditional)</a></li><li><a href="#-variable-binding" class="table-of-contents__link"><code>:=</code> (Variable binding)</a></li><li><a href="#-chain" class="table-of-contents__link"><code>~&gt;</code> (Chain)</a></li><li><a href="#-------transform" class="table-of-contents__link"><code>... ~&gt; | ... | ... |</code> (Transform)</a></li><li><a href="#string" class="table-of-contents__link"><code>$string()</code></a></li><li><a href="#length" class="table-of-contents__link"><code>$length()</code></a></li><li><a href="#substring" class="table-of-contents__link"><code>$substring()</code></a></li><li><a href="#substringbefore" class="table-of-contents__link"><code>$substringBefore()</code></a></li><li><a href="#substringafter" class="table-of-contents__link"><code>$substringAfter()</code></a></li><li><a href="#uppercase" class="table-of-contents__link"><code>$uppercase()</code></a></li><li><a href="#lowercase" class="table-of-contents__link"><code>$lowercase()</code></a></li><li><a href="#trim" class="table-of-contents__link"><code>$trim()</code></a></li><li><a href="#pad" class="table-of-contents__link"><code>$pad()</code></a></li><li><a href="#contains" class="table-of-contents__link"><code>$contains()</code></a></li><li><a href="#split" class="table-of-contents__link"><code>$split()</code></a></li><li><a href="#join" class="table-of-contents__link"><code>$join()</code></a></li><li><a href="#match" class="table-of-contents__link"><code>$match()</code></a></li><li><a href="#replace" class="table-of-contents__link"><code>$replace()</code></a></li><li><a href="#eval" class="table-of-contents__link"><code>$eval()</code></a></li><li><a href="#base64encode" class="table-of-contents__link"><code>$base64encode()</code></a></li><li><a href="#base64decode" class="table-of-contents__link"><code>$base64decode()</code></a></li><li><a href="#encodeurlcomponent" class="table-of-contents__link"><code>$encodeUrlComponent()</code></a></li><li><a href="#encodeurl" class="table-of-contents__link"><code>$encodeUrl()</code></a></li><li><a href="#decodeurlcomponent" class="table-of-contents__link"><code>$decodeUrlComponent()</code></a></li><li><a href="#decodeurl" class="table-of-contents__link"><code>$decodeUrl()</code></a></li><li><a href="#number" class="table-of-contents__link"><code>$number()</code></a></li><li><a href="#abs" class="table-of-contents__link"><code>$abs()</code></a></li><li><a href="#floor" class="table-of-contents__link"><code>$floor()</code></a></li><li><a href="#ceil" class="table-of-contents__link"><code>$ceil()</code></a></li><li><a href="#round" class="table-of-contents__link"><code>$round()</code></a></li><li><a href="#power" class="table-of-contents__link"><code>$power()</code></a></li><li><a href="#sqrt" class="table-of-contents__link"><code>$sqrt()</code></a></li><li><a href="#random" class="table-of-contents__link"><code>$random()</code></a></li><li><a href="#formatnumber" class="table-of-contents__link"><code>$formatNumber()</code></a></li><li><a href="#formatbase" class="table-of-contents__link"><code>$formatBase()</code></a></li><li><a href="#formatinteger" class="table-of-contents__link"><code>$formatInteger()</code></a></li><li><a href="#parseinteger" class="table-of-contents__link"><code>$parseInteger()</code></a></li><li><a href="#sum" class="table-of-contents__link"><code>$sum()</code></a></li><li><a href="#max" class="table-of-contents__link"><code>$max()</code></a></li><li><a href="#min" class="table-of-contents__link"><code>$min()</code></a></li><li><a href="#average" class="table-of-contents__link"><code>$average()</code></a></li><li><a href="#boolean" class="table-of-contents__link"><code>$boolean()</code></a></li><li><a href="#not" class="table-of-contents__link"><code>$not()</code></a></li><li><a href="#exists" class="table-of-contents__link"><code>$exists()</code></a></li><li><a href="#count" class="table-of-contents__link"><code>$count()</code></a></li><li><a href="#append" class="table-of-contents__link"><code>$append()</code></a></li><li><a href="#sort" class="table-of-contents__link"><code>$sort()</code></a></li><li><a href="#reverse" class="table-of-contents__link"><code>$reverse()</code></a></li><li><a href="#shuffle" class="table-of-contents__link"><code>$shuffle()</code></a></li><li><a href="#distinct" class="table-of-contents__link"><code>$distinct()</code></a></li><li><a href="#zip" class="table-of-contents__link"><code>$zip()</code></a></li><li><a href="#keys" class="table-of-contents__link"><code>$keys()</code></a></li><li><a href="#lookup" class="table-of-contents__link"><code>$lookup()</code></a></li><li><a href="#spread" class="table-of-contents__link"><code>$spread()</code></a></li><li><a href="#merge" class="table-of-contents__link"><code>$merge()</code></a></li><li><a href="#sift" class="table-of-contents__link"><code>$sift()</code></a></li><li><a href="#each" class="table-of-contents__link"><code>$each()</code></a></li><li><a href="#error" class="table-of-contents__link"><code>$error()</code></a></li><li><a href="#assert" class="table-of-contents__link"><code>$assert()</code></a></li><li><a href="#type" class="table-of-contents__link"><code>$type()</code></a></li><li><a href="#now" class="table-of-contents__link"><code>$now()</code></a></li><li><a href="#millis" class="table-of-contents__link"><code>$millis()</code></a></li><li><a href="#frommillis" class="table-of-contents__link"><code>$fromMillis()</code></a></li><li><a href="#tomillis" class="table-of-contents__link"><code>$toMillis()</code></a></li><li><a href="#map" class="table-of-contents__link"><code>$map()</code></a></li><li><a href="#filter" class="table-of-contents__link"><code>$filter()</code></a></li><li><a href="#single" class="table-of-contents__link"><code>$single()</code></a></li><li><a href="#reduce" class="table-of-contents__link"><code>$reduce()</code></a></li><li><a href="#sift-1" class="table-of-contents__link"><code>$sift()</code></a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2021 LAMP Consortium & Division of Digital Psychiatry @ BIDMC</div></div></div></footer></div>
<script src="/assets/js/styles.b006f77b.js"></script>
<script src="/assets/js/runtime~main.186aa2a6.js"></script>
<script src="/assets/js/main.6f9a5eda.js"></script>
<script src="/assets/js/1.f159de8f.js"></script>
<script src="/assets/js/2.bd8092b6.js"></script>
<script src="/assets/js/3.38c107f0.js"></script>
<script src="/assets/js/1be78505.6a8119be.js"></script>
<script src="/assets/js/277.6d1993e4.js"></script>
<script src="/assets/js/ac3cc3f5.fec89e66.js"></script>
<script src="/assets/js/935f2afb.197e5422.js"></script>
<script src="/assets/js/17896441.ce6f172a.js"></script>
<script src="/assets/js/1ef91c47.93bf4537.js"></script>
</body>
</html>