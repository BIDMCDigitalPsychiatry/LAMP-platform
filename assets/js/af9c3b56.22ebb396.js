(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{291:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return o})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return s}));var a=n(3),i=n(8),r=(n(0),n(388)),b=["components"],l={},o={unversionedId:"data_science/jsonata",id:"data_science/jsonata",isDocsHomePage:!1,title:"Using Document Transformations",description:"The LAMP Platform supports Document Transformations using the JSONata query language developed by IBM. The following documentation is extracted from the JSONata documentation website.",source:"@site/docs/09-data_science/08-jsonata.md",sourceDirName:"09-data_science",slug:"/data_science/jsonata",permalink:"/data_science/jsonata",editUrl:"https://github.com/BIDMCDigitalPsychiatry/LAMP-platform/edit/master/docs/09-data_science/08-jsonata.md",version:"current",lastUpdatedBy:"Suraj Patel",lastUpdatedAt:1634822728,formattedLastUpdatedAt:"10/21/2021",sidebarPosition:8,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Using Cortex",permalink:"/data_science/cortex_example"},next:{title:"Using the LAMP Data Portal",permalink:"/data_science/data_portal"}},c=[{value:"Introduction",id:"introduction",children:[]},{value:"Navigating JSON Objects",id:"navigating-json-objects",children:[]},{value:"Navigating JSON Arrays",id:"navigating-json-arrays",children:[]},{value:"Result sequences",id:"result-sequences",children:[]},{value:"Sequence flattening",id:"sequence-flattening",children:[]},{value:"Empty sequences and singleton sequences",id:"empty-sequences-and-singleton-sequences",children:[{value:"Top level arrays, nested arrays and array flattening",id:"top-level-arrays-nested-arrays-and-array-flattening",children:[]}]},{value:"Predicates",id:"predicates",children:[]},{value:"Singleton array and value equivalence",id:"singleton-array-and-value-equivalence",children:[]},{value:"Wildcards",id:"wildcards",children:[]},{value:"Navigate arbitrary depths",id:"navigate-arbitrary-depths",children:[]},{value:"String expressions",id:"string-expressions",children:[]},{value:"Numeric expressions",id:"numeric-expressions",children:[]},{value:"Comparison expressions",id:"comparison-expressions",children:[]},{value:"Boolean expressions",id:"boolean-expressions",children:[]},{value:"Array constructors",id:"array-constructors",children:[]},{value:"Object constructors",id:"object-constructors",children:[]},{value:"JSON literals",id:"json-literals",children:[]},{value:"Parenthesized expressions and blocks",id:"parenthesized-expressions-and-blocks",children:[]},{value:"Sorting",id:"sorting",children:[]},{value:"Grouping",id:"grouping",children:[]},{value:"Aggregation",id:"aggregation",children:[]},{value:"The JSONata type system",id:"the-jsonata-type-system",children:[]},{value:"Sequences",id:"sequences",children:[]},{value:"JSONata path processing",id:"jsonata-path-processing",children:[]},{value:"Comments",id:"comments",children:[]},{value:"Conditional logic",id:"conditional-logic",children:[]},{value:"Variables",id:"variables",children:[{value:"Built-in variables",id:"built-in-variables",children:[]},{value:"Variable binding",id:"variable-binding",children:[]}]},{value:"Functions",id:"functions",children:[{value:"Invoking a function",id:"invoking-a-function",children:[]},{value:"Defining a function",id:"defining-a-function",children:[]},{value:"Function signatures",id:"function-signatures",children:[]},{value:"Recursive functions",id:"recursive-functions",children:[]},{value:"Tail call optimization (Tail recursion)",id:"tail-call-optimization-tail-recursion",children:[]},{value:"Higher order functions",id:"higher-order-functions",children:[]},{value:"Functions are closures",id:"functions-are-closures",children:[]},{value:"Partial function application",id:"partial-function-application",children:[]},{value:"Function chaining",id:"function-chaining",children:[]},{value:"Functions as first class values",id:"functions-as-first-class-values",children:[]},{value:"Advanced example - The Y-combinator",id:"advanced-example---the-y-combinator",children:[]}]},{value:"Regular expressions in query predicates",id:"regular-expressions-in-query-predicates",children:[]},{value:"Generic matchers",id:"generic-matchers",children:[]},{value:"Writing a custom matcher",id:"writing-a-custom-matcher",children:[]},{value:"The &#39;evaluation time\u2019 - $now()",id:"the-evaluation-time---now",children:[]},{value:"JSON and ISO 8601",id:"json-and-iso-8601",children:[]},{value:"Support for other date/time formats",id:"support-for-other-datetime-formats",children:[]},{value:"<code>.</code> (Map)",id:"-map",children:[]},{value:"<code>[</code> ... <code>]</code> (Filter)",id:"---filter",children:[]},{value:"<code>^(</code> ... <code>)</code> (Order-by)",id:"---order-by",children:[]},{value:"<code>{</code> ... <code>}</code> (Reduce)",id:"---reduce",children:[]},{value:"<code>*</code> (Wildcard)",id:"-wildcard",children:[]},{value:"<code>**</code> (Descendants)",id:"-descendants",children:[]},{value:"<code>%</code> (Parent)",id:"-parent",children:[]},{value:"<code>#</code> (Positional variable binding)",id:"-positional-variable-binding",children:[]},{value:"<code>@</code> (Context variable binding)",id:"-context-variable-binding",children:[]},{value:"<code>+</code> (Addition)",id:"-addition",children:[]},{value:"<code>-</code> (Substraction/Negation)",id:"--substractionnegation",children:[]},{value:"<code>*</code> (Multiplication)",id:"-multiplication",children:[]},{value:"<code>/</code> (Division)",id:"-division",children:[]},{value:"<code>%</code> (Modulo)",id:"-modulo",children:[]},{value:"<code>..</code> (Range)",id:"-range",children:[]},{value:"<code>=</code> (Equals)",id:"-equals",children:[]},{value:"<code>!=</code> (Not equals)",id:"-not-equals",children:[]},{value:"<code>&gt;</code> (Greater than)",id:"-greater-than",children:[]},{value:"<code>&lt;</code> (Less than)",id:"-less-than",children:[]},{value:"<code>&gt;=</code> (Greater than or equals)",id:"-greater-than-or-equals",children:[]},{value:"<code>&lt;=</code> (Less than or equals)",id:"-less-than-or-equals",children:[]},{value:"<code>in</code> (Inclusion)",id:"in-inclusion",children:[]},{value:"<code>and</code> (Boolean AND)",id:"and-boolean-and",children:[]},{value:"<code>or</code> (Boolean OR)",id:"or-boolean-or",children:[]},{value:"<code>&amp;</code> (Concatenation)",id:"-concatenation",children:[]},{value:"<code>? :</code> (Conditional)",id:"--conditional",children:[]},{value:"<code>:=</code> (Variable binding)",id:"-variable-binding",children:[]},{value:"<code>~&gt;</code> (Chain)",id:"-chain",children:[]},{value:"<code>... ~&gt; | ... | ... |</code> (Transform)",id:"-------transform",children:[]},{value:"<code>$string()</code>",id:"string",children:[]},{value:"<code>$length()</code>",id:"length",children:[]},{value:"<code>$substring()</code>",id:"substring",children:[]},{value:"<code>$substringBefore()</code>",id:"substringbefore",children:[]},{value:"<code>$substringAfter()</code>",id:"substringafter",children:[]},{value:"<code>$uppercase()</code>",id:"uppercase",children:[]},{value:"<code>$lowercase()</code>",id:"lowercase",children:[]},{value:"<code>$trim()</code>",id:"trim",children:[]},{value:"<code>$pad()</code>",id:"pad",children:[]},{value:"<code>$contains()</code>",id:"contains",children:[]},{value:"<code>$split()</code>",id:"split",children:[]},{value:"<code>$join()</code>",id:"join",children:[]},{value:"<code>$match()</code>",id:"match",children:[]},{value:"<code>$replace()</code>",id:"replace",children:[]},{value:"<code>$eval()</code>",id:"eval",children:[]},{value:"<code>$base64encode()</code>",id:"base64encode",children:[]},{value:"<code>$base64decode()</code>",id:"base64decode",children:[]},{value:"<code>$encodeUrlComponent()</code>",id:"encodeurlcomponent",children:[]},{value:"<code>$encodeUrl()</code>",id:"encodeurl",children:[]},{value:"<code>$decodeUrlComponent()</code>",id:"decodeurlcomponent",children:[]},{value:"<code>$decodeUrl()</code>",id:"decodeurl",children:[]},{value:"<code>$number()</code>",id:"number",children:[]},{value:"<code>$abs()</code>",id:"abs",children:[]},{value:"<code>$floor()</code>",id:"floor",children:[]},{value:"<code>$ceil()</code>",id:"ceil",children:[]},{value:"<code>$round()</code>",id:"round",children:[]},{value:"<code>$power()</code>",id:"power",children:[]},{value:"<code>$sqrt()</code>",id:"sqrt",children:[]},{value:"<code>$random()</code>",id:"random",children:[]},{value:"<code>$formatNumber()</code>",id:"formatnumber",children:[]},{value:"<code>$formatBase()</code>",id:"formatbase",children:[]},{value:"<code>$formatInteger()</code>",id:"formatinteger",children:[]},{value:"<code>$parseInteger()</code>",id:"parseinteger",children:[]},{value:"<code>$sum()</code>",id:"sum",children:[]},{value:"<code>$max()</code>",id:"max",children:[]},{value:"<code>$min()</code>",id:"min",children:[]},{value:"<code>$average()</code>",id:"average",children:[]},{value:"<code>$boolean()</code>",id:"boolean",children:[]},{value:"<code>$not()</code>",id:"not",children:[]},{value:"<code>$exists()</code>",id:"exists",children:[]},{value:"<code>$count()</code>",id:"count",children:[]},{value:"<code>$append()</code>",id:"append",children:[]},{value:"<code>$sort()</code>",id:"sort",children:[]},{value:"<code>$reverse()</code>",id:"reverse",children:[]},{value:"<code>$shuffle()</code>",id:"shuffle",children:[]},{value:"<code>$distinct()</code>",id:"distinct",children:[]},{value:"<code>$zip()</code>",id:"zip",children:[]},{value:"<code>$keys()</code>",id:"keys",children:[]},{value:"<code>$lookup()</code>",id:"lookup",children:[]},{value:"<code>$spread()</code>",id:"spread",children:[]},{value:"<code>$merge()</code>",id:"merge",children:[]},{value:"<code>$sift()</code>",id:"sift",children:[]},{value:"<code>$each()</code>",id:"each",children:[]},{value:"<code>$error()</code>",id:"error",children:[]},{value:"<code>$assert()</code>",id:"assert",children:[]},{value:"<code>$type()</code>",id:"type",children:[]},{value:"<code>$now()</code>",id:"now",children:[]},{value:"<code>$millis()</code>",id:"millis",children:[]},{value:"<code>$fromMillis()</code>",id:"frommillis",children:[]},{value:"<code>$toMillis()</code>",id:"tomillis",children:[]},{value:"<code>$map()</code>",id:"map",children:[]},{value:"<code>$filter()</code>",id:"filter",children:[]},{value:"<code>$single()</code>",id:"single",children:[]},{value:"<code>$reduce()</code>",id:"reduce",children:[]},{value:"<code>$sift()</code>",id:"sift-1",children:[]}],p={toc:c};function s(e){var t=e.components,n=Object(i.a)(e,b);return Object(r.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"overview"},"Overview"),Object(r.b)("p",null,"The LAMP Platform supports Document Transformations using the JSONata query language developed by IBM. ",Object(r.b)("a",{parentName:"p",href:"https://docs.jsonata.org/"},"The following documentation is extracted from the JSONata documentation website.")),Object(r.b)("p",null,"The following methods corresponding to API calls have been added to the JSONata engine:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"$LAMP.ActivityEvent.list(participant_id: string, origin: string | null, from: number | null, to: number | null, limit: number | null) => ActivityEvent[]\n$LAMP.ActivityEvent.create(participant_id: string, activity_events: ActivityEvent | ActivityEvent[]) => void\n$LAMP.Activity.list(study_id: string, ignore_binary: boolean = true, sibling: boolean = false) => Activity[]\n$LAMP.Activity.create(activity_id: string, activity: Activity) => void\n$LAMP.Activity.get(activity_id: string) => Activity\n$LAMP.Activity.set(activity_id: string, activity: Activity | null) => void\n$LAMP.ActivitySpec.list() => ActivitySpec[]\n$LAMP.ActivitySpec.create(activity_spec: ActivitySpec) => void\n$LAMP.ActivitySpec.get(activity_spec_id: string) => ActivitySpec\n$LAMP.ActivitySpec.set(activity_spec_id: string, activity_spec: ActivitySpec | null) => void\n$LAMP.Credential.list(type_id: string | null) => Credential[]\n$LAMP.Credential.create(type_id: string | null, credential: Credential) => void\n$LAMP.Credential.get(type_id: string | null, access_key: string) => Credential\n$LAMP.Credential.set(type_id: string | null, access_key: string, credential: Credential | null) => void\n$LAMP.Participant.list(study_id: string, sibling: boolean = false) => Participant[]\n$LAMP.Participant.create(study_id: string, participant: Participant) => void\n$LAMP.Participant.get(participant_id: string) => Participant\n$LAMP.Participant.set(participant_id: string, participant: Participant) => void\n$LAMP.Researcher.list() => Researcher[]\n$LAMP.Researcher.create(researcher: Researcher) => void\n$LAMP.Researcher.get(researcher_id: string) => Researcher\n$LAMP.Researcher.set(researcher_id: string, researcher: Researcher | null) => void\n$LAMP.SensorEvent.list(participant_id: string, origin: string | null, from: number | null, to: number | null, limit: number | null) => SensorEvent[]\n$LAMP.SensorEvent.create(participant_id: string, sensor_events: SensorEvent | SensorEvent[]) => void\n$LAMP.Sensor.list(study_id: string, ignore_binary: boolean = true, sibling: boolean = false) => Sensor[]\n$LAMP.Sensor.create(study_id: string, sensor: Sensor) => void\n$LAMP.Sensor.get(sensor_id: string) => Sensor\n$LAMP.Sensor.set(sensor_id: string, sensor: Sensor | null) => void\n$LAMP.SensorSpec.list() => SensorSpec[]\n$LAMP.SensorSpec.create(sensor_spec: SensorSpec) => void\n$LAMP.SensorSpec.get(sensor_spec_id: string) => SensorSpec\n$LAMP.SensorSpec.set(sensor_spec_id: string, sensor_spec: SensorSpec | null) => void\n$LAMP.Study.list(researcher_id: string) => Study[]\n$LAMP.Study.create(researcher_id: string, study: Study) => void\n$LAMP.Study.get(study_id: string) => Study\n$LAMP.Study.set(study_id: string, study: Study | null) => void\n$LAMP.Type.parent(type_id: string) => string\n$LAMP.Tag.list(type_id: string) => string[]\n$LAMP.Tag.get(type_id: string, attachment_key: string) => any\n$LAMP.Tag.set(type_id: string, attachment_key: string, target: string, attachment_value: string) => void\n")),Object(r.b)("h2",{id:"introduction"},"Introduction"),Object(r.b)("p",null,"JSONata is a lightweight query and transformation language for JSON data. Inspired by the 'location path' semantics of XPath 3.1, it allows sophisticated queries to be expressed in a compact and intuitive notation.  A rich complement of built in operators and functions is provided for manipulating and combining extracted data, and the results of queries can be formatted into any JSON output structure using familiar JSON object and array syntax. Coupled with the facility to create user defined functions, advanced expressions can be built to tackle any JSON query and transformation task. ",Object(r.b)("a",{parentName:"p",href:"http://try.jsonata.org/"},"Try it out here.")),Object(r.b)("h1",{id:"simple-queries"},"Simple Queries"),Object(r.b)("p",null,"To support the extraction of values from a JSON structure, a location path syntax is defined. In common with XPath, this will select all possible values in the document that match the specified location path.  The two structural constructs of JSON are objects and arrays."),Object(r.b)("h2",{id:"navigating-json-objects"},"Navigating JSON Objects"),Object(r.b)("p",null,"A JSON object is an associative array (a.k.a map or hash). The location path syntax to navigate into an arbitrarily deeply nested structure of JSON objects comprises the field names separated by dot '.' delimiters. The expression returns the JSON value referenced after navigating to the last step in the location path.  If during the navigation of the location path, a field is not found, then the expression returns nothing (represented by Javascript ",Object(r.b)("em",{parentName:"p"},"undefined"),").  No errors are thrown as a result of non-existing data in the input document."),Object(r.b)("p",null,"The following sample JSON document is used by examples throughout this guide, unless otherwise indicated:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "FirstName": "Fred",\n  "Surname": "Smith",\n  "Age": 28,\n  "Address": {\n    "Street": "Hursley Park",\n    "City": "Winchester",\n    "Postcode": "SO21 2JN"\n  },\n  "Phone": [\n    {\n      "type": "home",\n      "number": "0203 544 1234"\n    },\n    {\n      "type": "office",\n      "number": "01962 001234"\n    },\n    {\n      "type": "office",\n      "number": "01962 001235"\n    },\n    {\n      "type": "mobile",\n      "number": "077 7700 1234"\n    }\n  ],\n  "Email": [\n    {\n      "type": "work",\n      "address": ["fred.smith@my-work.com", "fsmith@my-work.com"]\n    },\n    {\n      "type": "home",\n      "address": ["freddy@my-social.com", "frederic.smith@very-serious.com"]\n    }\n  ],\n  "Other": {\n    "Over 18 ?": true,\n    "Misc": null,\n    "Alternative.Address": {\n      "Street": "Brick Lane",\n      "City": "London",\n      "Postcode": "E1 6RF"\n    }\n  }\n}\n')),Object(r.b)("h4",{id:"examples"},"Examples"),Object(r.b)("p",null,"Here are some example expressions and their results when applied to the above JSON document:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},'Returns a JSON string ("double quoted")'),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Surname\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Smith"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Returns a JSON number"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Age\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"28\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Field references are separated by '.'"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Address.City\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Winchester"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Matched the path and returns the null value"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Other.Misc\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"null\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Path not found.  Returns nothing (i.e. Javascript ",Object(r.b)("em",{parentName:"p"},"undefined"),")\n",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Other.Nothing\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"  \n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Field references containing whitespace or reserved tokens can be enclosed in backticks"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Other.`Over 18 ?`\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"true\n")))),Object(r.b)("h2",{id:"navigating-json-arrays"},"Navigating JSON Arrays"),Object(r.b)("p",null,"JSON arrays are used when an ordered collection of values is required.  Each value in the array is associated with an index (position) rather than a name, so in order to address individual values in an array, extra syntax is required to specify the index.  This is done using square brackets after the field name of the array.  If the square brackets contains a number, or an expression that evaluates to a number, then the number represents the index of the value to select.  Indexes are zero offset, i.e. the first value in an array ",Object(r.b)("inlineCode",{parentName:"p"},"arr")," is ",Object(r.b)("inlineCode",{parentName:"p"},"arr[0]"),".  If the number is not an integer, then it is rounded ",Object(r.b)("em",{parentName:"p"},"down")," to an integer.  If the expression in square brackets is non-numeric, or is an expression that doesn't evaluate to a number, then it is treated as a ",Object(r.b)("a",{parentName:"p",href:"#predicates"},"predicate"),"."),Object(r.b)("p",null,"Negative indexes count from the end of the array, for example, ",Object(r.b)("inlineCode",{parentName:"p"},"arr[-1]")," will select the last value, ",Object(r.b)("inlineCode",{parentName:"p"},"arr[-2]")," the second to last, etc. If an index is specified that exceeds the size of the array, then nothing is selected."),Object(r.b)("p",null,"If no index is specified for an array (i.e. no square brackets after the field reference), then the whole array is selected. If the array contains objects, and the location path selects fields within these objects, then each object within the array will be queried for selection."),Object(r.b)("h4",{id:"examples-1"},"Examples"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Returns the first item (an object)"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[0]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{ "type": "home", "number": "0203 544 1234" }\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Returns the second item"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[1]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{ "type": "office", "number": "01962 001234" }\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Returns the last item"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[-1]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{ "type": "mobile", "number": "077 7700 1234" }\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Negative indexed count from the end"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[-2]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{ "type": "office", "number": "01962 001235" }\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Doesn't exist - returns nothing\n",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[8]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"  \n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Selects the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," field in the first item"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[0].number\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"0203 544 1234"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"No index is given to ",Object(r.b)("inlineCode",{parentName:"p"},"Phone")," so it selects all of them (the whole array), then it selects all the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," fields for each of them"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone.number\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[ "0203 544 1234", "01962 001234", "01962 001235", "077 7700 1234" ]\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Might expect it to just return the first number, but it returns the first number of each of the items selected by ",Object(r.b)("inlineCode",{parentName:"p"},"Phone")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone.number[0]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[ "0203 544 1234", "01962 001234", "01962 001235", "077 7700 1234" ]\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Applies the index to the array returned by ",Object(r.b)("inlineCode",{parentName:"p"},"Phone.number"),". One use of ",Object(r.b)("a",{parentName:"p",href:"#parenthesized-expressions-and-blocks"},"parentheses"),"."),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"(Phone.number)[0]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"0203 544 1234"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Returns a range of items by creating an array of indexes"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[[0..1]]\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[\n{ "type": "home", "number": "0203 544 1234" },\n{ "type": "office", "number": "01962 001234" }\n]\n')))),Object(r.b)("h2",{id:"result-sequences"},"Result sequences"),Object(r.b)("h2",{id:"sequence-flattening"},"Sequence flattening"),Object(r.b)("h2",{id:"empty-sequences-and-singleton-sequences"},"Empty sequences and singleton sequences"),Object(r.b)("h3",{id:"top-level-arrays-nested-arrays-and-array-flattening"},"Top level arrays, nested arrays and array flattening"),Object(r.b)("p",null,"Consider the JSON document:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'[\n  { "ref": [ 1,2 ] },\n  { "ref": [ 3,4 ] }\n]\n')),Object(r.b)("p",null,"At the top level, we have an array rather than an object.  If we want to select the first object in this top level array, we don't have a field name to append the ",Object(r.b)("inlineCode",{parentName:"p"},"[0]")," to.  We can't use ",Object(r.b)("inlineCode",{parentName:"p"},"[0]")," on its own because that clashes with the ",Object(r.b)("a",{parentName:"p",href:"#array-constructors"},"array constructor")," syntax.  However, we can use the ",Object(r.b)("em",{parentName:"p"},"context")," reference ",Object(r.b)("inlineCode",{parentName:"p"},"$")," to refer to the start of the document as follows:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"$")," at the start of an expression refers to the entire input document"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$[0]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{ "ref": [ 1,2 ] }\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},".ref")," here returns the entire internal array"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$[0].ref\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"[ 1,2 ]\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"returns element on first position of the internal array"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$[0].ref[0]\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"1\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Despite the structure of the nested array, the resultant selection is flattened into a single flat array.  The original nested structure of the input arrays is lost. See ",Object(r.b)("a",{parentName:"p",href:"#array-constructors"},"Array constructors")," for how to maintain the original structure in the results."),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$.ref\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"[ 1, 2, 3, 4 ]\n")))),Object(r.b)("h1",{id:"query-refinement-using-predicate-expressions"},"Query refinement using predicate expressions"),Object(r.b)("h2",{id:"predicates"},"Predicates"),Object(r.b)("p",null,"At any step in a location path, the selected items can be filtered using a predicate - ",Object(r.b)("inlineCode",{parentName:"p"},"[expr]")," where ",Object(r.b)("inlineCode",{parentName:"p"},"expr")," evaluates to a Boolean value.  Each item in the selection is tested against the expression, if it evaluates to ",Object(r.b)("inlineCode",{parentName:"p"},"true"),", then the item is kept; if ",Object(r.b)("inlineCode",{parentName:"p"},"false"),", it is removed from the selection. The expression is evaluated relative to the current (context) item being tested, so if the predicate expression performs navigation, then it is relative to this context item."),Object(r.b)("h4",{id:"examples-2"},"Examples:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Select the ",Object(r.b)("inlineCode",{parentName:"p"},"Phone")," items that have a ",Object(r.b)("inlineCode",{parentName:"p"},"type")," field that equals ",Object(r.b)("inlineCode",{parentName:"p"},'"mobile"'),"."),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[type='mobile']\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{ "type": "mobile",  "number": "077 7700 1234" }\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Select the mobile phone number"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[type='mobile'].number\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"077 7700 1234"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Select the office phone numbers - there are two of them!"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone[type='office'].number\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[ "01962 001234",  "01962 001235" ]\n')))),Object(r.b)("h2",{id:"singleton-array-and-value-equivalence"},"Singleton array and value equivalence"),Object(r.b)("p",null,"Within a JSONata expression or subexpression, any value (which is not itself an array) and an array containing just that value are deemed to be equivalent.  This allows the language to be composable such that location paths that extract a single value from and object and location paths that extract multiple values from arrays can both be used as inputs to other expressions without needing to use different syntax for the two forms."),Object(r.b)("p",null,"Consider the following examples:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Address.City")," returns the single value ",Object(r.b)("inlineCode",{parentName:"li"},'"Winchester"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[0].number")," matches a single value, and returns that value ",Object(r.b)("inlineCode",{parentName:"li"},'"0203 544 1234"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[type='home'].number")," likewise matches the single value ",Object(r.b)("inlineCode",{parentName:"li"},'"0203 544 1234"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[type='office'].number")," matches two values, so returns an array ",Object(r.b)("inlineCode",{parentName:"li"},'[ "01962 001234",  "01962 001235" ]'))),Object(r.b)("p",null,"When processing the return value of a JSONata expression, it might be desirable to have the results in a consistent format regardless of how many values were matched.  In the first two expressions above, it is clear that each expression is addressing a single value in the structure and it makes sense to return just that value.  In the last two expressions, however, it is not immediately obvious how many values will be matched, and it is not helpful if the host language has to process the results in different ways depending on what gets returned."),Object(r.b)("p",null,"If this is a concern, then the expression can be modified to make it return an array even if only a single value is matched. This is done by adding empty square brackets ",Object(r.b)("inlineCode",{parentName:"p"},"[]")," to a step within the location path.  The examples above can be re-written to always return an array as follows:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Address[].City")," returns ",Object(r.b)("inlineCode",{parentName:"li"},'[ "Winchester"] ')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[0][].number")," returns ",Object(r.b)("inlineCode",{parentName:"li"},'[ "0203 544 1234" ]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[][type='home'].number")," returns ",Object(r.b)("inlineCode",{parentName:"li"},'[ "0203 544 1234" ]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[type='office'].number[]")," returns ",Object(r.b)("inlineCode",{parentName:"li"},'[ "01962 001234",  "01962 001235" ]'))),Object(r.b)("p",null,"Note that the ",Object(r.b)("inlineCode",{parentName:"p"},"[]")," can be placed either side of the predicates and on any step in the path expression"),Object(r.b)("h2",{id:"wildcards"},"Wildcards"),Object(r.b)("p",null,"Use of ",Object(r.b)("inlineCode",{parentName:"p"},"*")," instead of field name to select all fields in an object"),Object(r.b)("h4",{id:"examples-3"},"Examples"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Select the values of all the fields of ",Object(r.b)("inlineCode",{parentName:"p"},"Address")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Address.*\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[ "Hursley Park", "Winchester", "SO21 2JN" ]\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Select the ",Object(r.b)("inlineCode",{parentName:"p"},"Postcode")," value of any child object"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"*.Postcode\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"SO21 2JN"\n')))),Object(r.b)("h2",{id:"navigate-arbitrary-depths"},"Navigate arbitrary depths"),Object(r.b)("p",null,"Descendant wildcard ",Object(r.b)("inlineCode",{parentName:"p"},"**")," instead of ",Object(r.b)("inlineCode",{parentName:"p"},"*")," will traverse all descendants (multi-level wildcard)."),Object(r.b)("h4",{id:"examples-4"},"Examples"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Select all ",Object(r.b)("inlineCode",{parentName:"p"},"Postcode")," values, regardless of how deeply nested they are in the structure"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"**.Postcode\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[ "SO21 2JN", "E1 6RF" ]\n')))),Object(r.b)("h1",{id:"manipulating-data-with-functions-and-expressions"},"Manipulating data with functions and expressions"),Object(r.b)("h2",{id:"string-expressions"},"String expressions"),Object(r.b)("p",null,"Path expressions that point to a string value will return that value."),Object(r.b)("p",null,"String literals can also be created by enclosing the\nsequence of characters in quotes. Either double quotes ",Object(r.b)("inlineCode",{parentName:"p"},'"')," or single quotes ",Object(r.b)("inlineCode",{parentName:"p"},"'")," can be used, provided the same quote type is\nused for the start and end of the string literal.  Single quote characters may be included within a double quoted string and\n",Object(r.b)("em",{parentName:"p"},"vice versa")," withought escaping.  Characters within the string literal may be escaped using the same format\nas ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7159#section-7"},"JSON strings"),"."),Object(r.b)("p",null,"Strings can be combined using the concatenation operator ",Object(r.b)("inlineCode",{parentName:"p"},"&"),". This is an infix operator and will join the two strings\nreturned by the expressions either side of it.  This is the only operator that will attempt to typecast its operands to\nthe expected (string) type."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Concatenate ",Object(r.b)("inlineCode",{parentName:"p"},"FirstName")," followed by space followed by ",Object(r.b)("inlineCode",{parentName:"p"},"Surname")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"FirstName & ' ' & Surname\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Fred Smith"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Concatenates the ",Object(r.b)("inlineCode",{parentName:"p"},"Street")," and ",Object(r.b)("inlineCode",{parentName:"p"},"City")," from the ",Object(r.b)("inlineCode",{parentName:"p"},"Address")," object with a comma separator. Note the use of ",Object(r.b)("a",{parentName:"p",href:"#parenthesized-expressions-and-blocks"},"parentheses")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Address.(Street & ', ' & City)\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Hursley Park, Winchester"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Casts the operands to strings, if necessary"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"5&0&true\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"50true"\n')))),Object(r.b)("h2",{id:"numeric-expressions"},"Numeric expressions"),Object(r.b)("p",null,"Path expressions that point to a number value will return that value.  "),Object(r.b)("p",null,"Numeric literals can also be created using the same syntax as ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7159#section-6"},"JSON numbers"),"."),Object(r.b)("p",null,"Numbers can be combined using the usual mathematical operators to produce a resulting number.  Supported operators:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"+")," addition"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"-")," subtraction"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"*")," multiplication"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"/")," division"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"%")," remainder (modulo)")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,"Consider the following JSON document:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'{\n  "Numbers": [1, 2.4, 3.5, 10, 20.9, 30]\n}\n')),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Expression"),Object(r.b)("th",{parentName:"tr",align:null},"Output"),Object(r.b)("th",{parentName:"tr",align:null},"Comments"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[0] + Numbers[1]")),Object(r.b)("td",{parentName:"tr",align:null},"3.4"),Object(r.b)("td",{parentName:"tr",align:null},"Adding 2 prices")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[0] - Numbers[4]")),Object(r.b)("td",{parentName:"tr",align:null},"-19.9"),Object(r.b)("td",{parentName:"tr",align:null},"Subtraction")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[0] * Numbers[5]")),Object(r.b)("td",{parentName:"tr",align:null},"30"),Object(r.b)("td",{parentName:"tr",align:null},"Multiplying price by quantity")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[0] / Numbers[4]")),Object(r.b)("td",{parentName:"tr",align:null},"0.04784688995215"),Object(r.b)("td",{parentName:"tr",align:null},"Division")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[2] % Numbers[5]")),Object(r.b)("td",{parentName:"tr",align:null},"3.5"),Object(r.b)("td",{parentName:"tr",align:null},"Modulo operator")))),Object(r.b)("h2",{id:"comparison-expressions"},"Comparison expressions"),Object(r.b)("p",null,"Often used in predicates, for comparison of two values.  Returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," or ",Object(r.b)("inlineCode",{parentName:"p"},"false"),". Supported operators:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"=")," equals"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"!=")," not equals"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"<")," less than"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"<=")," less than or equal"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},">")," greater than"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},">=")," greater than or equal"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"in")," value is contained in an array")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Expression"),Object(r.b)("th",{parentName:"tr",align:null},"Output"),Object(r.b)("th",{parentName:"tr",align:null},"Comments"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[0] = Numbers[5]")),Object(r.b)("td",{parentName:"tr",align:null},"false"),Object(r.b)("td",{parentName:"tr",align:null},"Equality")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[0] != Numbers[4]")),Object(r.b)("td",{parentName:"tr",align:null},"true"),Object(r.b)("td",{parentName:"tr",align:null},"Inequality")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[1] < Numbers[5]")),Object(r.b)("td",{parentName:"tr",align:null},"true"),Object(r.b)("td",{parentName:"tr",align:null},"Less than")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[1] <= Numbers[5]")),Object(r.b)("td",{parentName:"tr",align:null},"true"),Object(r.b)("td",{parentName:"tr",align:null},"Less than or equal")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[2] > Numbers[4]")),Object(r.b)("td",{parentName:"tr",align:null},"false"),Object(r.b)("td",{parentName:"tr",align:null},"Greater than")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"Numbers[2] >= Numbers[4]")),Object(r.b)("td",{parentName:"tr",align:null},"false"),Object(r.b)("td",{parentName:"tr",align:null},"Greater than or equal")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},'"01962 001234" in Phone.number')),Object(r.b)("td",{parentName:"tr",align:null},"true"),Object(r.b)("td",{parentName:"tr",align:null},"Value is contained in")))),Object(r.b)("h2",{id:"boolean-expressions"},"Boolean expressions"),Object(r.b)("p",null,"Used to combine Boolean results, often to support more sophisticated predicate expressions. Supported operators:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"and")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"or"))),Object(r.b)("p",null,"Note that ",Object(r.b)("inlineCode",{parentName:"p"},"not")," is supported as a function, not an operator."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Expression"),Object(r.b)("th",{parentName:"tr",align:null},"Output"),Object(r.b)("th",{parentName:"tr",align:null},"Comments"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"(Numbers[2] != 0) and (Numbers[5] != Numbers[1])")),Object(r.b)("td",{parentName:"tr",align:null},"true"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"and")," operator")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"(Numbers[2] != 0) or (Numbers[5] = Numbers[1])")),Object(r.b)("td",{parentName:"tr",align:null},"true"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"or")," operator")))),Object(r.b)("h1",{id:"building-result-structures"},"Building result structures"),Object(r.b)("p",null,"So far, we have discovered how to extract values from a JSON document, and how to manipulate the data using numeric, string and other operators.  It is useful to be able to specify how this processed data is presented in the output."),Object(r.b)("h2",{id:"array-constructors"},"Array constructors"),Object(r.b)("p",null,"As previously observed, when a location path matches multiple values in the input document, these values are returned as an array.  The values might be objects or arrays, and as such will have their own structure, but the ",Object(r.b)("em",{parentName:"p"},"matched values")," themselves are at the top level in the resultant array."),Object(r.b)("p",null,"It is possible to build extra structure into the resultant array by specifying the construction of arrays (or ",Object(r.b)("a",{parentName:"p",href:"#object-constructors"},"objects"),") within the location path expression.  At any point in a location path where a field reference is expected, a pair of square brackets ",Object(r.b)("inlineCode",{parentName:"p"},"[]")," can be inserted to specify that the results of the expression within those brackets should be contained within a new array in the output.  Commas are used to separate multiple expressions within the array constructor."),Object(r.b)("p",null,"Array constructors can also be used within location paths for making multiple selections without the broad brush use of wildcards."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"The four email addresses are returned in a flat array."),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Email.address\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[\n"fred.smith@my-work.com",\n"fsmith@my-work.com",\n"freddy@my-social.com",\n"frederic.smith@very-serious.com"\n]\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Each email object generates an array of addresses."),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Email.[address]\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[\n[ "fred.smith@my-work.com",  "fsmith@my-work.com" ],\n[ "freddy@my-social.com", "frederic.smith@very-serious.com" ]\n]\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Selects the ",Object(r.b)("inlineCode",{parentName:"p"},"City")," value of both ",Object(r.b)("inlineCode",{parentName:"p"},"Address")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Alternative.Address")," objects."),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"[Address, Other.`Alternative.Address`].City\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[ "Winchester", "London" ]\n')))),Object(r.b)("h2",{id:"object-constructors"},"Object constructors"),Object(r.b)("p",null,"In a similar manner to the way arrays can be constructed, JSON objects can also be constructed in the output.  At any point in a location path where a field reference is expected, a pair of braces ",Object(r.b)("inlineCode",{parentName:"p"},"{}")," containing key/value pairs separated by commas, with each key and value separated by a colon: ",Object(r.b)("inlineCode",{parentName:"p"},"{key1: value2, key2:value2}"),".  The keys and values can either be literals or can be expressions. The key must either be a string or an expression that evaluates to a string."),Object(r.b)("p",null,"When an object constructor follows an expression that selects multiple values, the object constructor will create a single object that contains a key/value pair for each of those context values.  If an array of objects is required (one for each context value), then the object constructor should immediately follow the dot '.' operator."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Produces an array of objects (one for each phone)."),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone.{type: number}\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'[\n{ "home": "0203 544 1234" }, \n{ "office": "01962 001234" }, \n{ "office": "01962 001235" }, \n{ "mobile": "077 7700 1234"  } \n]\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Combines the key/value pairs into a single object.  See ",Object(r.b)("a",{parentName:"p",href:"#sorting-grouping"},"Grouping using object key expression")," for more details."),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone{type: number}\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"home": "0203 544 1234",\n"office": [\n  "01962 001234",\n  "01962 001235"\n],\n"mobile": "077 7700 1234"\n}\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Combines the key/value pairs into a single object.  In this case, for consistency, all numbers are grouped into arrays. See ",Object(r.b)("a",{parentName:"p",href:"#singleton-array-and-value-equivalence"},"Singleton array and value equivalence")," for more details."),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Phone{type: number[]}\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"home": [\n  "0203 544 1234"\n],\n"office": [\n  "01962 001234",\n  "01962 001235"\n],\n"mobile": [\n  "077 7700 1234"\n]\n}\n')))),Object(r.b)("h2",{id:"json-literals"},"JSON literals"),Object(r.b)("p",null,"The array and object constructors use the standard JSON syntax for JSON arrays and JSON objects.  In addition to this values of the other JSON data types can be entered into an expression using their native JSON syntax:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"strings - ",Object(r.b)("inlineCode",{parentName:"li"},'"hello world"')),Object(r.b)("li",{parentName:"ul"},"numbers - ",Object(r.b)("inlineCode",{parentName:"li"},"34.5")),Object(r.b)("li",{parentName:"ul"},"Booleans - ",Object(r.b)("inlineCode",{parentName:"li"},"true")," or ",Object(r.b)("inlineCode",{parentName:"li"},"false")),Object(r.b)("li",{parentName:"ul"},"nulls - ",Object(r.b)("inlineCode",{parentName:"li"},"null")),Object(r.b)("li",{parentName:"ul"},"objects - ",Object(r.b)("inlineCode",{parentName:"li"},'{"key1": "value1", "key2": "value2"}')),Object(r.b)("li",{parentName:"ul"},"arrays - ",Object(r.b)("inlineCode",{parentName:"li"},'["value1", "value2"]'))),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"JSONata is a superset of JSON.")," This means that any valid JSON document is also a valid JSONata expression.  This property allows you to use a JSON document as a template for the desired output, and then replace parts of it with expressions to insert data into the output from the input document."),Object(r.b)("h1",{id:"query-composition"},"Query composition"),Object(r.b)("p",null,"In JSONata, everything is an ",Object(r.b)("em",{parentName:"p"},"expression"),". An expression comprises ",Object(r.b)("em",{parentName:"p"},"values"),", ",Object(r.b)("em",{parentName:"p"},"functions")," and ",Object(r.b)("em",{parentName:"p"},"operators")," which, when ",Object(r.b)("em",{parentName:"p"},"evaluated"),", produces a resulting value.  Functions and operators are applied to values which themselves can be the results of evaluating sub-expressions. In that way, the language is fully ",Object(r.b)("em",{parentName:"p"},"composable")," to any level of complexity."),Object(r.b)("h2",{id:"parenthesized-expressions-and-blocks"},"Parenthesized expressions and blocks"),Object(r.b)("p",null,"Used to override the operator precedence rules.  E.g."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"(5 + 3) * 4"))),Object(r.b)("p",null,"Used to compute complex expressions on a context value"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Product.(Price * Quantity)")," - both Price and Quantity are properties of the Product object")),Object(r.b)("p",null,"Used to support 'code blocks' - multiple expressions, separated by semicolons"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"(expr1; expr2; expr3)"))),Object(r.b)("p",null,"Each expression in the block is evaluated ",Object(r.b)("em",{parentName:"p"},"in sequential order"),"; the result of the last expression is returned from the block."),Object(r.b)("h1",{id:"sorting-grouping-and-aggregation"},"Sorting, Grouping and Aggregation"),Object(r.b)("h2",{id:"sorting"},"Sorting"),Object(r.b)("p",null,"Arrays contain an ordered collection of values.  If you need to re-order the values, then the array must be sorted.  In JSONata, there are two ways of sorting an array:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Using the ",Object(r.b)("a",{parentName:"p",href:"#sort"},Object(r.b)("inlineCode",{parentName:"a"},"$sort()"))," function.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Using the ",Object(r.b)("a",{parentName:"p",href:"#order-by-"},"order-by")," operator."))),Object(r.b)("p",null,"The ",Object(r.b)("a",{parentName:"p",href:"#order-by-"},"order-by")," operator is a convenient syntax that can used directly in a path expression to sort the result sequences in ascending or descending order.  The ",Object(r.b)("a",{parentName:"p",href:"#sort"},Object(r.b)("inlineCode",{parentName:"a"},"$sort()"))," function requires more syntax to be written, but is more flexible and supports custom comparator functions."),Object(r.b)("h2",{id:"grouping"},"Grouping"),Object(r.b)("p",null,"The JSONata ",Object(r.b)("a",{parentName:"p",href:"#object-constructors"},"object constructor")," syntax allows you to specify an expression for the key in any key/value pair (the value can obviously be an expression too). The key expression must evaluate to a string since this is a restriction on JSON objects.  The key and value expressions are evaluated for each item in the input context (see ",Object(r.b)("a",{parentName:"p",href:"#the-jsonata-processing-model"},"processing model"),"). The result of each key/value expression pair is inserted into the resulting JSON object."),Object(r.b)("p",null,"If the evaluation of any key expression results in a key that is already in the result object, then the result of its associated value expression will be grouped with the value(s) already associated with that key. Note that the value expressions are not evaluated until all of the grouping has been performed.  This allows for aggregation expressions to be evaluated over the collection of items for each group."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Group all of the product sales by name, with the price of each item in each group"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Account.Order.Product{`Product Name`: Price}\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"Bowler Hat": [ 34.45, 34.45 ],\n"Trilby hat": 21.67,\n"Cloak": 107.99\n}\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Group all of the product sales by name, with the price and the quantity of each item in each group"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'Account.Order.Product {\n`Product Name`: {"Price": Price, "Qty": Quantity}\n}\n')),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"Bowler Hat": {\n  "Price": [ 34.45, 34.45 ],\n  "Qty": [ 2, 4 ]\n},\n"Trilby hat": { "Price": 21.67, "Qty": 1 },\n"Cloak": { "Price": 107.99, "Qty": 1 }\n}\n')))),Object(r.b)("p",null,"Note in the above example, the value expression grouped all of the prices together and all of the quantities together into separate arrays.  This is because the context value is the sequence of all grouped Products and the ",Object(r.b)("inlineCode",{parentName:"p"},"Price")," expression will select all prices from all products.  If you want to collect the price and quantity into individual objects, then you need to evaluate the object constructor ",Object(r.b)("em",{parentName:"p"},"for each")," product in the context sequence.  The following example shows this."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Explicit use of ",Object(r.b)("inlineCode",{parentName:"p"},"$.{ ... }")," to create an object for each item in the group."),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'Account.Order.Product {\n`Product Name`: $.{"Price": Price, "Qty": Quantity}\n}\n')),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"Bowler Hat": [\n  { "Price": 34.45, "Qty": 2 },\n  { "Price": 34.45, "Qty": 4 }\n],\n"Trilby hat": { "Price": 21.67, "Qty": 1 },\n"Cloak": { "Price": 107.99, "Qty": 1 }\n}\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Multiply the Price by the Quantity for each product in each group"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Account.Order.Product{`Product Name`: $.(Price*Quantity)}\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"Bowler Hat": [ 68.9, 137.8 ],\n"Trilby hat": 21.67,\n"Cloak": 107.99\n}\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"The total aggregated value in each group"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"Account.Order.Product{`Product Name`: $sum($.(Price*Quantity))}\n")),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"Bowler Hat": 206.7,\n"Trilby hat": 21.67,\n"Cloak": 107.99\n}\n')))),Object(r.b)("h2",{id:"aggregation"},"Aggregation"),Object(r.b)("p",null,"Often queries are just required to return aggregated results from a set of matching values.  A number of aggregation functions are available which return a single aggregated value when applied to an array of values."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Total price of each product in each order"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$sum(Account.Order.Product.Price)\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"198.56\n"))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"More likely want to add up the total of the price times quantity for each order"),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$sum(Account.Order.Product.(Price*Quantity))\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"336.36\n")))),Object(r.b)("p",null,"Other ",Object(r.b)("a",{parentName:"p",href:"#aggregation-functions"},"numeric aggregation functions")," are available (i.e. average, min, max) and an ",Object(r.b)("a",{parentName:"p",href:"#join"},"aggregator for strings"),".  It is also possible to write complex custom aggregators using the ",Object(r.b)("a",{parentName:"p",href:"#reduce"},Object(r.b)("inlineCode",{parentName:"a"},"$reduce()"))," higher-order function."),Object(r.b)("h1",{id:"the-jsonata-processing-model"},"The JSONata processing model"),Object(r.b)("h2",{id:"the-jsonata-type-system"},"The JSONata type system"),Object(r.b)("p",null,"JSONata is a superset of JSON and the JSONata type system is a superset of the JSON data types.  In common with all functional programming languages, the function is also a first-class data type.  The following data types are supported by JSONata:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"string"),Object(r.b)("li",{parentName:"ul"},"number"),Object(r.b)("li",{parentName:"ul"},"Boolean"),Object(r.b)("li",{parentName:"ul"},"null"),Object(r.b)("li",{parentName:"ul"},"object"),Object(r.b)("li",{parentName:"ul"},"array"),Object(r.b)("li",{parentName:"ul"},"function")),Object(r.b)("p",null,"All but the last one are in common with JSON."),Object(r.b)("h2",{id:"sequences"},"Sequences"),Object(r.b)("p",null,"JSONata has been designed foremost as a query language, whereby a path expression can select zero, one or more than one values from the JSON document.  These values, each of which can be of any of the types listed above, are returned as a ",Object(r.b)("em",{parentName:"p"},"result sequence"),".  During the evaluation of expressions, which involves the results of subexpressions being combined or becoming the context inputs to other subexpressions, the sequences are subject to the process of ",Object(r.b)("em",{parentName:"p"},"sequence flattening"),"."),Object(r.b)("p",null,"The sequence flattening rules are as follows:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"An ",Object(r.b)("strong",{parentName:"p"},"empty sequence")," is a sequence with no values and is considered to be 'nothing' or 'no match'.  It won't appear in the output of any expression. If it is associated with an object property (key/value) pair in a result object, then that object will not have that property.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"A ",Object(r.b)("strong",{parentName:"p"},"singleton sequence")," is a sequence containing a single value.  It is considered equivalent to that value itself, and the output from any expression, or sub-expression will be that value without any surrounding structure.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"A sequence containing more than one value is represented in the output as a JSON array.  This is still internally flagged as a sequence and subject to the next rule.  Note that if an expression matches an array from the input JSON, or a JSON array is explicitly constructed in the query using the ",Object(r.b)("a",{parentName:"p",href:"#array-constructors"},"array constructor"),", then this remains an array of values rather than a sequence of values and will not be subject to the sequence flattening rules.  However, if this array becomes the context of a subsequent expression, then the result of that ",Object(r.b)("em",{parentName:"p"},"will")," be a sequence.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"If a sequence contains one or more (sub-)sequences, then the values from the sub-sequence are pulled up to the level of the outer sequence.  A result sequence will never contain child sequences (they are flattened)."))),Object(r.b)("h2",{id:"jsonata-path-processing"},"JSONata path processing"),Object(r.b)("p",null,"The JSONata path expression is a ",Object(r.b)("em",{parentName:"p"},"declarative functional")," language."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Functional")," because it is based on the map/filter/reduce programming paradigm as supported by popular functional programming languages through the use of higher-order functions."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Declarative")," because these higher-order functions are exposed through a lightweight syntax which lets the user focus on the intention of the query (declaration) rather than the programming constructs that control their evaluation."),Object(r.b)("p",null,"A path expression is a sequence of one or more of the following functional stages:"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Stage"),Object(r.b)("th",{parentName:"tr",align:null},"Syntax"),Object(r.b)("th",{parentName:"tr",align:null},"Action"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("strong",{parentName:"td"},"Map")),Object(r.b)("td",{parentName:"tr",align:null},"seq",Object(r.b)("inlineCode",{parentName:"td"},"."),"expr"),Object(r.b)("td",{parentName:"tr",align:null},"Evaluates the RHS expression in the context of each item in the input sequence.  Flattens results into result sequence.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("strong",{parentName:"td"},"Filter")),Object(r.b)("td",{parentName:"tr",align:null},"seq",Object(r.b)("inlineCode",{parentName:"td"},"["),"expr",Object(r.b)("inlineCode",{parentName:"td"},"]")),Object(r.b)("td",{parentName:"tr",align:null},"Filter results from previous stage by applying predicate expression between brackets to each item.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("strong",{parentName:"td"},"Sort")),Object(r.b)("td",{parentName:"tr",align:null},"seq",Object(r.b)("inlineCode",{parentName:"td"},"^("),"expr",Object(r.b)("inlineCode",{parentName:"td"},")")),Object(r.b)("td",{parentName:"tr",align:null},"Sorts (re-orders) the input sequence according to the criteria in parentheses.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("strong",{parentName:"td"},"Index")),Object(r.b)("td",{parentName:"tr",align:null},"seq",Object(r.b)("inlineCode",{parentName:"td"},"#"),"$var"),Object(r.b)("td",{parentName:"tr",align:null},"Binds a named variable to the current context position (zero offset) in the sequence.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("strong",{parentName:"td"},"Join")),Object(r.b)("td",{parentName:"tr",align:null},"seq",Object(r.b)("inlineCode",{parentName:"td"},"@"),"$var"),Object(r.b)("td",{parentName:"tr",align:null},"Binds a named variable to the current current context item in the sequence.  Can only be used directly following a map stage.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("strong",{parentName:"td"},"Reduce")),Object(r.b)("td",{parentName:"tr",align:null},"seq",Object(r.b)("inlineCode",{parentName:"td"},"{")," expr",Object(r.b)("inlineCode",{parentName:"td"},":"),"expr",Object(r.b)("inlineCode",{parentName:"td"},",")," expr",Object(r.b)("inlineCode",{parentName:"td"},":"),"expr ...",Object(r.b)("inlineCode",{parentName:"td"},"}")),Object(r.b)("td",{parentName:"tr",align:null},"Group and aggregate the input sequence to a single result object as defined by the name/value expressions.  Can only appear as the final stage in a path expression.")))),Object(r.b)("p",null,"In the above table:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"In the 'Syntax' column, 'seq' refers to the input sequence for the current stage, which is the result sequence from the previous stage."),Object(r.b)("li",{parentName:"ul"},"The 'Action' column gives a brief outline of the stage's behavior; fuller details are in the ",Object(r.b)("a",{parentName:"li",href:"#path-operators"},"Path Operators")," reference page."),Object(r.b)("li",{parentName:"ul"},"The relative precedence of each operator affects the scope of its influence on the input sequence. Specifically,",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"The Filter operator binds tighter than the Map operator.  This means, for example, that ",Object(r.b)("inlineCode",{parentName:"li"},"books.authors[0]")," will select the all of the first authors from ",Object(r.b)("em",{parentName:"li"},"each")," book rather than the first author from all of the books."),Object(r.b)("li",{parentName:"ul"},"The Sort (order-by) operator has the lowest precedence, meaning that the full path to the left of it will be evaluated, and its result sequence will be sorted."),Object(r.b)("li",{parentName:"ul"},"This operator precedence can be overridden by using parentheses.  For example, ",Object(r.b)("inlineCode",{parentName:"li"},"(books.authors)[0]")," will select the the first author from all of the books (single value).  Note, however, that parentheses also define a scope frame for variables, so any variables that have been bound within the parentheses block including those bound by the ",Object(r.b)("inlineCode",{parentName:"li"},"@")," and ",Object(r.b)("inlineCode",{parentName:"li"},"#")," operators will go out of scope at the end of the parens block."))),Object(r.b)("li",{parentName:"ul"},"The variables bound by the ",Object(r.b)("inlineCode",{parentName:"li"},"@")," and ",Object(r.b)("inlineCode",{parentName:"li"},"#")," operators go out of scope at the end of the path expression.",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"The Reduce stage, if used, will terminate the current path expression.  Although a Map operator can immediately follow this, it will be interpreted as the start of a new path expression, meaning that any previously bound context or index variables will be out of scope.")))),Object(r.b)("h1",{id:"functional-programming-constructs"},"Functional programming constructs"),Object(r.b)("p",null,"So far, we have introduced all the parts of the language that allow us to extract data from an input JSON document, combine the data using string and numeric operators, and format the structure of the output JSON document.  What follows are the parts that turn this into a Turing complete, functional programming language."),Object(r.b)("h2",{id:"comments"},"Comments"),Object(r.b)("p",null,"JSONata expressions can be interleaved with comments using 'C' style comment delimeters.  For example,"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/* Long-winded expressions might need some explanation */\n(\n  $pi := 3.1415926535897932384626;\n  /* JSONata is not known for its graphics support! */\n  $plot := function($x) {(\n    $floor := $string ~> $substringBefore(?, '.') ~> $number;\n    $index := $floor(($x + 1) * 20 + 0.5);\n    $join([0..$index].('.')) & 'O' & $join([$index..40].('.'))\n  )};\n\n  /* Factorial is the product of the integers 1..n */\n  $product := function($a, $b) { $a * $b };\n  $factorial := function($n) { $n = 0 ? 1 : $reduce([1..$n], $product) };\n\n  $sin := function($x){ /* define sine in terms of cosine */\n    $cos($x - $pi/2)\n  };\n  $cos := function($x){ /* Derive cosine by expanding Maclaurin series */\n    $x > $pi ? $cos($x - 2 * $pi) : $x < -$pi ? $cos($x + 2 * $pi) :\n      $sum([0..12].($power(-1, $) * $power($x, 2*$) / $factorial(2*$)))\n  };\n\n  [0..24].$sin($*$pi/12).$plot($)\n)\n")),Object(r.b)("p",null,"Produces ",Object(r.b)("a",{parentName:"p",href:"http://try.jsonata.org/ryYn78Q0m"},"this"),", if you're interested!"),Object(r.b)("h2",{id:"conditional-logic"},"Conditional logic"),Object(r.b)("p",null,'If/then/else constructs can be written using the ternary operator "? :".'),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"predicate ? expr1 : expr2")),Object(r.b)("p",null,"The expression ",Object(r.b)("inlineCode",{parentName:"p"},"predicate")," is evaluated.  If its effective boolean value (see definition) is ",Object(r.b)("inlineCode",{parentName:"p"},"true")," then ",Object(r.b)("inlineCode",{parentName:"p"},"expr1")," is evaluated and returned, otherwise ",Object(r.b)("inlineCode",{parentName:"p"},"expr2")," is evaluated and returned."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,"TBD"),Object(r.b)("h2",{id:"variables"},"Variables"),Object(r.b)("p",null,"Any name that starts with a dollar '$' is a variable.  A variable is a named reference to a value.  The value can be one of any type in the language's ",Object(r.b)("a",{parentName:"p",href:"#the-jsonata-type-system"},"type system"),"."),Object(r.b)("h3",{id:"built-in-variables"},"Built-in variables"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$")," The variable with no name refers to the context value at any point in the input JSON hierarchy. Examples"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$$")," The root of the input JSON.  Only needed if you need to break out of the current context to temporarily navigate down a different path.  E.g. for cross-referencing or joining data. Examples"),Object(r.b)("li",{parentName:"ul"},"Native (built-in) functions.  See function library.")),Object(r.b)("h3",{id:"variable-binding"},"Variable binding"),Object(r.b)("p",null,"Values (of any type in the type system) can be bound to variables"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'$var_name := "value"')),Object(r.b)("p",null,"The stored value can be later referenced using the expression ",Object(r.b)("inlineCode",{parentName:"p"},"$var_name"),"."),Object(r.b)("p",null,"The scope of a variable is limited to the 'block' in which it was bound.  E.g."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"Invoice.(\n  $p := Product.Price;\n  $q := Product.Quantity;\n  $p * $q\n)\n")),Object(r.b)("p",null,"Returns Price multiplied by Quantity for the Product in the Invoice."),Object(r.b)("h2",{id:"functions"},"Functions"),Object(r.b)("p",null,"The function is a first-class type, and can be stored in a variable just like any other data type.  A library of built-in functions is provided (link) and assigned to variables in the global scope.  For example, ",Object(r.b)("inlineCode",{parentName:"p"},"$uppercase")," contains a function which, when invoked with a string argument, ",Object(r.b)("inlineCode",{parentName:"p"},"str"),", will return a string with all the characters in ",Object(r.b)("inlineCode",{parentName:"p"},"str")," changed to uppercase."),Object(r.b)("h3",{id:"invoking-a-function"},"Invoking a function"),Object(r.b)("p",null,"A function is invoked by following its reference (or definition) by parentheses containing a comma delimited sequence of arguments."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$uppercase("Hello")'),' returns the string "HELLO".'),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substring("hello world", 0, 5)'),' returns the string "hello"'),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$sum([1,2,3])")," returns the number 6")),Object(r.b)("h3",{id:"defining-a-function"},"Defining a function"),Object(r.b)("p",null,"Anonymous (lambda) functions can be defined using the following syntax:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function($l, $w, $h){ $l * $w * $h }")),Object(r.b)("p",null,"and can be invoked using"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function($l, $w, $h){ $l * $w * $h }(10, 10, 5)")," which returns 500"),Object(r.b)("p",null,"The function can also be assigned to a variable for future use (within the block)"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $volume := function($l, $w, $h){ $l * $w * $h };\n  $volume(10, 10, 5);\n)\n")),Object(r.b)("h3",{id:"function-signatures"},"Function signatures"),Object(r.b)("p",null,"Functions can be defined with an optional signature which specifies the parameter types of the function.  If supplied,\nthe evaluation engine will validate the arguments passed to the function before it is invoked.  A dynamic error is\nthown if the argument list does not match the signature."),Object(r.b)("p",null,"A function signature is a string of the form ",Object(r.b)("inlineCode",{parentName:"p"},"<params:return>"),". ",Object(r.b)("inlineCode",{parentName:"p"},"params")," is a sequence of type symbols, each one representing an input argument's type. ",Object(r.b)("inlineCode",{parentName:"p"},"return")," is a single type symbol representing the return value type."),Object(r.b)("p",null,"Type symbols work as follows:"),Object(r.b)("p",null,"Simple types:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"b")," - Boolean"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"n")," - number"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"s")," - string"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"l")," - ",Object(r.b)("inlineCode",{parentName:"li"},"null"))),Object(r.b)("p",null,"Complex types:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"a")," - array"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"o")," - object"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"f")," - function")),Object(r.b)("p",null,"Union types:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"(sao)")," - string, array or object"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"(o)")," - same as ",Object(r.b)("inlineCode",{parentName:"li"},"o")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"u")," - equivalent to ",Object(r.b)("inlineCode",{parentName:"li"},"(bnsl)")," i.e. Boolean, number, string or ",Object(r.b)("inlineCode",{parentName:"li"},"null")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"j")," - any JSON type. Equivalent to ",Object(r.b)("inlineCode",{parentName:"li"},"(bnsloa)")," i.e. Boolean, number, string, ",Object(r.b)("inlineCode",{parentName:"li"},"null"),", object or array, but not function"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"x")," - any type. Equivalent to ",Object(r.b)("inlineCode",{parentName:"li"},"(bnsloaf)"))),Object(r.b)("p",null,"Parametrised types:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"a<s>")," - array of strings"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"a<x>")," - array of values of any type")),Object(r.b)("p",null,"Some examples of signatures of built-in JSONata functions:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$count")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<a:n>"),"; it accepts an array and returns a number."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$append")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<aa:a>"),"; it accepts two arrays and returns an array."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$sum")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<a<n>:n>"),"; it accepts an array of numbers and returns a number."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$reduce")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<fa<j>:j>"),"; it accepts a reducer function ",Object(r.b)("inlineCode",{parentName:"li"},"f")," and an ",Object(r.b)("inlineCode",{parentName:"li"},"a<j>")," (array of JSON objects) and returns a JSON object.")),Object(r.b)("p",null,"Each type symbol may also have ",Object(r.b)("em",{parentName:"p"},"options")," applied."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"+")," - one or more arguments of this type",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"E.g. ",Object(r.b)("inlineCode",{parentName:"li"},"$zip")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<a+>"),"; it accepts one array, or two arrays, or three arrays, or..."))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"?")," - optional argument",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"E.g. ",Object(r.b)("inlineCode",{parentName:"li"},"$join")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<a<s>s?:s>"),"; it accepts an array of strings and an optional joiner string which defaults to the empty string. It returns a string."))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"-"),' - if this argument is missing, use the context value ("focus").',Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"E.g. ",Object(r.b)("inlineCode",{parentName:"li"},"$length")," has signature ",Object(r.b)("inlineCode",{parentName:"li"},"<s-:n>"),"; it can be called as ",Object(r.b)("inlineCode",{parentName:"li"},"$length(OrderID)")," (one argument) but equivalently as ",Object(r.b)("inlineCode",{parentName:"li"},"OrderID.$length()"),".")))),Object(r.b)("h3",{id:"recursive-functions"},"Recursive functions"),Object(r.b)("p",null,"Functions that have been assigned to variables can invoke themselves using that variable reference.  This allows recursive functions to be defined.  Eg."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $factorial:= function($x){ $x <= 1 ? 1 : $x * $factorial($x-1) };\n  $factorial(4)\n)\n")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"24\n")),Object(r.b)("p",null,"Note that it is actually possible to write a recursive function using purely anonymous functions (i.e. nothing gets assigned to variables).  This is done using the ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Fixed-point_combinator#Fixed_point_combinators_in_lambda_calculus"},"Y-combinator")," which might be an interesting ",Object(r.b)("a",{parentName:"p",href:"#advanced-example-the-y-combinator"},"diversion")," for those interested in functional programming."),Object(r.b)("h3",{id:"tail-call-optimization-tail-recursion"},"Tail call optimization (Tail recursion)"),Object(r.b)("p",null,"A recursive function adds a new frame to the call stack each time it invokes itself.  This can eventually lead to stack exhaustion if the function recuses beyond a certain limit.  Consider the classic recursive implementation of the factorial function"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $factorial := function($x) {\n    $x <= 1 ? 1 : $x * $factorial($x-1)\n  };\n  $factorial(170)\n)\n")),Object(r.b)("p",null,"This function works by pushing the number onto the stack, then when the stack unwinds, multiplying it by the result of the factorial of the number minus one.  Written in this way, the JSONata evaluator has no choice but to use the call stack to store the intermediate results.  Given a large enough number, the call stack will overflow."),Object(r.b)("p",null,"This is a recognised problem with functional programming and the solution is to rewrite the function slightly to avoid the ",Object(r.b)("em",{parentName:"p"},"need")," for the stack to store the itermediate result.  The following implementation of factorial achieves this"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $factorial := function($x){(\n    $iter := function($x, $acc) {\n      $x <= 1 ? $acc : $iter($x - 1, $x * $acc)\n    };\n    $iter($x, 1)\n  )};\n  $factorial(170)\n)\n")),Object(r.b)("p",null,"Here, the multiplication is done ",Object(r.b)("em",{parentName:"p"},"before")," the function invokes itself and the intermediate result is carried in the second parameter ",Object(r.b)("inlineCode",{parentName:"p"},"$acc")," (accumulator).  The invocation of itself is the ",Object(r.b)("em",{parentName:"p"},"last")," thing that the function does.  This is known as a 'tail call', and when the JSONata parser spots this, it internally rewrites the recursion as a simple loop.  Thus it can run indefinitely without growing the call stack.  Functions written in this way are said to be ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Tail_call"},"tail recursive"),"."),Object(r.b)("h3",{id:"higher-order-functions"},"Higher order functions"),Object(r.b)("p",null,"A function, being a first-class data type, can be passed as a parameter to another function, or returned from a function.  Functions that process other functions are known as higher order functions.  Consider the following example:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $twice := function($f) { function($x){ $f($f($x)) } };\n  $add3 := function($y){ $y + 3 };\n  $add6 := $twice($add3);\n  $add6(7)\n)\n")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The function stored in variable ",Object(r.b)("inlineCode",{parentName:"li"},"$twice")," is a higher order function.  It takes a parameter ",Object(r.b)("inlineCode",{parentName:"li"},"$f")," which is a function, and returns a function which takes a parameter ",Object(r.b)("inlineCode",{parentName:"li"},"$x")," which, when invoked, applies the function ",Object(r.b)("inlineCode",{parentName:"li"},"$f")," twice to ",Object(r.b)("inlineCode",{parentName:"li"},"$x"),"."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$add3")," stores a function that adds 3 to its argument.  Neither ",Object(r.b)("inlineCode",{parentName:"li"},"$twice")," or ",Object(r.b)("inlineCode",{parentName:"li"},"$add3")," have been invoked yet."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$twice")," is invoked by passing the function ",Object(r.b)("inlineCode",{parentName:"li"},"add3")," as its argument.  This returns a function that applies ",Object(r.b)("inlineCode",{parentName:"li"},"$add3")," twice to ",Object(r.b)("em",{parentName:"li"},"its")," argument.  This returned function is not invoked yet, but rather assigned to the variable ",Object(r.b)("inlineCode",{parentName:"li"},"add6"),"."),Object(r.b)("li",{parentName:"ul"},"Finally the function in ",Object(r.b)("inlineCode",{parentName:"li"},"$add6")," is invoked with the argument 7, resulting in 3 being added to it twice.  It returns 13.")),Object(r.b)("h3",{id:"functions-are-closures"},"Functions are closures"),Object(r.b)("p",null,"When a lambda function is defined, the evaluation engine takes a snapshot of the environment and stores it with the function body definition.  The environment comprises the context item (i.e. the current value in the location path) together with the current in-scope variable bindings.  When the lambda function is later invoked, it is done so in that stored environment rather than the current environment at invocation time.  This property is known as ",Object(r.b)("em",{parentName:"p"},"lexical scoping")," and is a fundamental property of ",Object(r.b)("em",{parentName:"p"},"closures"),"."),Object(r.b)("p",null,"Consider the following example:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"Account.(\n  $AccName := function() { $.'Account Name' };\n\n  Order[OrderID = 'order104'].Product.{\n    'Account': $AccName(),\n    'SKU-' & $string(ProductID): $.'Product Name'\n  }\n)\n")),Object(r.b)("p",null,"When the function is created, the context item (referred to by '$') is the value of ",Object(r.b)("inlineCode",{parentName:"p"},"Account"),".  Later, when the function is invoked, the context item has moved down the structure to the value of each ",Object(r.b)("inlineCode",{parentName:"p"},"Product")," item.  However, the function body is invoked in the environment that was stored when it was defined, so its context item is the value of ",Object(r.b)("inlineCode",{parentName:"p"},"Account"),".  This is a somewhat contrived example, you wouldn't really need a function to do this.  The expression produces the following result:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'{\n  "Account": "Firefly",\n  "SKU-858383": "Bowler Hat",\n  "SKU-345664": "Cloak"\n}\n')),Object(r.b)("h3",{id:"partial-function-application"},"Partial function application"),Object(r.b)("p",null,"Functions can ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Partial_application"},"partially applied")," by invoking the function with one or more (but not all)\narguments replaced by a question mark ",Object(r.b)("inlineCode",{parentName:"p"},"?")," placeholder.  The result of this is another function whose arity (number of parameters) is reduced\nby the number of arguments supplied to the original function.  This returned function can be treated like any other newly defined function,\ne.g. bound to a variable, passed to a higher-order function, etc."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Create a function to return the first five characters of a string by partially applying the ",Object(r.b)("inlineCode",{parentName:"p"},"$substring")," function"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'(\n$first5 := $substring(?, 0, 5);\n$first5("Hello, World")\n)\n')),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Hello"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Partially applied function can be further partially applied"),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'(\n$firstN := $substring(?, 0, ?);\n$first5 := $firstN(?, 5);\n$first5("Hello, World")\n)\n')),Object(r.b)("p",{parentName:"li"},"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Hello"\n')))),Object(r.b)("h3",{id:"function-chaining"},"Function chaining"),Object(r.b)("p",null,"Function chaining can be used in two ways:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"To avoid lots of nesting when multiple functions are applied to a value")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"As a higher-order construct for defining new functions by combining existing functions"))),Object(r.b)("h4",{id:"invocation-chaining"},"Invocation chaining"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"value ~> $funcA ~> $funcB"),"\\\nis equivalent to\\\n",Object(r.b)("inlineCode",{parentName:"p"},"$funcB($funcA(value))")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'Customer.Email ~> $substringAfter("@") ~> $substringBefore(".") ~> $uppercase()'))),Object(r.b)("h4",{id:"function-composition"},"Function composition"),Object(r.b)("p",null,Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Function_composition"},"Function composition")," is the application of one function to another function\nto produce a third function."),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$funcC := $funcA ~> $funcB"),"\\\nis equivalent to\\\n",Object(r.b)("inlineCode",{parentName:"p"},"$funcC := function($arg) { $funcB($funcA($arg)) }")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Create a new function by chaining two existing functions","  ",Object(r.b)("strong",{parentName:"li"},"Query"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'(\n $normalize := $uppercase ~> $trim;\n $normalize("   Some   Words   ")\n)\n')),"  ",Object(r.b)("strong",{parentName:"li"},"Result"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"SOME WORDS"\n')))),Object(r.b)("h3",{id:"functions-as-first-class-values"},"Functions as first class values"),Object(r.b)("p",null,"Function composition can be combined with partial function application to produce a very compact syntax for defining new\nfunctions."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Create a new function by chaining two partially evaluated functions","  ",Object(r.b)("strong",{parentName:"li"},"Query"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"(\n$first5Capitalized := $substring(?, 0, 5) ~> $uppercase(?);\n$first5Capitalized(Address.City)\n)\n")),"  ",Object(r.b)("strong",{parentName:"li"},"Result"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"WINCH"\n')))),Object(r.b)("h3",{id:"advanced-example---the-y-combinator"},"Advanced example - The Y-combinator"),Object(r.b)("p",null,"There is no need to read this section - it will do nothing for your sanity or ability to manipulate JSON data."),Object(r.b)("p",null,"Earlier we learned how to write a recursive function to calculate the factorial of a number and hinted that this could be done without naming any functions.  We can take higher-order functions to the extreme and write the following:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"\u03bb($f) { \u03bb($x) { $x($x) }( \u03bb($g) { $f( (\u03bb($a) {$g($g)($a)}))})}(\u03bb($f) { \u03bb($n) { $n < 2 ? 1 : $n * $f($n - 1) } })(6)")),Object(r.b)("p",null,"which produces the result ",Object(r.b)("inlineCode",{parentName:"p"},"720"),".  The Greek lambda (\u03bb) symbol can be used in place of the word ",Object(r.b)("inlineCode",{parentName:"p"},"function")," which, if you can find it on your keyboard, will save screen space and please the fans of ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Lambda_calculus"},"lambda calculus"),"."),Object(r.b)("p",null,"The first part of this above expression is an implementation of the ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Fixed-point_combinator#Fixed_point_combinators_in_lambda_calculus"},"Y-combinator")," in this language.  We could assign it to a variable and apply it to other recursive anonymous functions:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $Y := \u03bb($f) { \u03bb($x) { $x($x) }( \u03bb($g) { $f( (\u03bb($a) {$g($g)($a)}))})};\n  [1,2,3,4,5,6,7,8,9] . $Y(\u03bb($f) { \u03bb($n) { $n <= 1 ? $n : $f($n-1) + $f($n-2) } }) ($)\n)\n")),Object(r.b)("p",null,"to produce the Fibonacci series ",Object(r.b)("inlineCode",{parentName:"p"},"[ 1, 1, 2, 3, 5, 8, 13, 21, 34 ]"),"."),Object(r.b)("p",null,"But we don't need to do any of this.  Far more sensible to use named functions:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $fib := \u03bb($n) { $n <= 1 ? $n : $fib($n-1) + $fib($n-2) };\n  [1,2,3,4,5,6,7,8,9] . $fib($)\n)\n")),Object(r.b)("h1",{id:"using-regular-expressions"},"Using Regular Expressions"),Object(r.b)("p",null,"The regular expression is a syntax for matching and extracting parts of a string.  JSONata provides first class support for regular expressions surrounded by the familiar slash delimeters found in many scripting languages.  "),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"/regex/flags")),Object(r.b)("p",null,"where:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"regex")," - the regular expression")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"flags")," - optionally either or both of: "),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"i")," - ignore case"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"m")," - multiline match")),Object(r.b)("h2",{parentName:"li",id:"functions-which-use-regular-expressions"},"Functions which use regular expressions"))),Object(r.b)("p",null,"A number of functions are available that take a regular expression as a parameter"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"#match"},"$match()")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"#contains"},"$contains()")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"#split"},"$split()")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"#replace"},"$replace()"))),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("h2",{id:"regular-expressions-in-query-predicates"},"Regular expressions in query predicates"),Object(r.b)("p",null,"Regexes are often used in query predicates (filter expressions) when selecting objects that contain a matching string property.  For this, a short cut notation can be used as follows:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"path.to.object[stringProperty ~> /regex/]")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"~>")," is the ",Object(r.b)("a",{parentName:"p",href:"#chain"},"chain operator"),", and its use here implies that the result of ",Object(r.b)("inlineCode",{parentName:"p"},"/regex/")," is a function.  We'll see below that this is in fact the case."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"Account.Order.Product[`Product Name` ~> /hat/i ]")),Object(r.b)("p",null,"will match all products that have 'hat' in their name."),Object(r.b)("h2",{id:"generic-matchers"},"Generic matchers"),Object(r.b)("p",null,"The JSONata type system is based on the JSON type system, with the addition of the function type.  In order to accommodate the regex as a standalone expression, the syntax ",Object(r.b)("inlineCode",{parentName:"p"},"/regex/")," evaluates to a function.  Think of the ",Object(r.b)("inlineCode",{parentName:"p"},"/regex/")," syntax as a higher-order function that results in a 'matching function' when evaluated.  The ",Object(r.b)("inlineCode",{parentName:"p"},"regex")," between the slashes is the parameter to this HOF and the function that gets returned, when applied to ",Object(r.b)("em",{parentName:"p"},"its")," string parameter, will return a structure that contains details of parts of the string that have been matched.  If nothing is matched, then it returns the empty sequence (i.e. JavaScript ",Object(r.b)("inlineCode",{parentName:"p"},"undefined"),")."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$matcher := /[a-z]*an[a-z]*/i")),Object(r.b)("p",null,"Evaluation of the regex returns a function, and this has been bound to a variable ",Object(r.b)("inlineCode",{parentName:"p"},"$matcher"),".  Later, the ",Object(r.b)("inlineCode",{parentName:"p"},"$matcher")," function is invoked on a string:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$matcher('A man, a plan, a canal, Panama!')")),Object(r.b)("p",null,"This returns the following JSONata object (JSON, but also with a function property):"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'{\n  "match": "man",\n  "start": 2,\n  "end": 4,\n  "groups": [],\n  "next": "<native function>#0"\n}\n')),Object(r.b)("p",null,"This contains information of the first matching substring within this famous palindrome, specifically:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"match")," - the substring within the original string that matches the regex"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"start")," - the starting position (zero offset) of the matching substring within the original string"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"end")," - the endinging position of the matching substring within the original string"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"groups")," - if capturing groups are used in the regex, then this array contains a string for the text captured by each group"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"next()")," - when invoked, will return details of the second occurrence of any matching substring (and so on).")),Object(r.b)("p",null,"In this example, invoking ",Object(r.b)("inlineCode",{parentName:"p"},"next()")," will return:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'{\n  "match": "canal",\n  "start": 17,\n  "end": 22,\n  "groups": [],\n  "next": "<native function>#0"\n}\n')),Object(r.b)("p",null,"and so on, until it eventually returns the empty sequence."),Object(r.b)("h2",{id:"writing-a-custom-matcher"},"Writing a custom matcher"),Object(r.b)("p",null,"We've learned that the regex syntax is just a function generator, and the signature and return structure of the generated 'matcher' function is well defined.  The four regex-aware functions (",Object(r.b)("inlineCode",{parentName:"p"},"$match"),", ",Object(r.b)("inlineCode",{parentName:"p"},"$contain"),", ",Object(r.b)("inlineCode",{parentName:"p"},"$split"),", ",Object(r.b)("inlineCode",{parentName:"p"},"$replace"),") simply invoke this function as part of their implementation.  Apart from that, they have no awareness that these matcher functions were generated by the regex syntax."),Object(r.b)("p",null,"So it's possible to write any user-defined matcher function, provided it conforms to this contract.  This can be done as a JSONata lambda function or (more likely) as an extension function.  It can then be passed to these four 'regex-aware' functions and they will search using the custom matcher rather than a regex."),Object(r.b)("h1",{id:"datetime-processing"},"Date/Time processing"),Object(r.b)("h2",{id:"the-evaluation-time---now"},"The 'evaluation time\u2019 - $now()"),Object(r.b)("p",null,"There are two functions that return the 'current' date/time timestamp:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",{parentName:"li",href:"#now"},Object(r.b)("inlineCode",{parentName:"a"},"$now()"))," returns the timestamp in an ISO 8601 formatted string."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",{parentName:"li",href:"#millis"},Object(r.b)("inlineCode",{parentName:"a"},"$millis()"))," returns the same timestamp as the number of milliseconds since midnight on 1st January 1970 UTC (the ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Unix_time"},"Unix epoch"),").")),Object(r.b)("p",null,"The timestamp is captured at the start of the expression evaluation, and that same timestamp value is returned for every occurrence of ",Object(r.b)("inlineCode",{parentName:"p"},"$now()")," and ",Object(r.b)("inlineCode",{parentName:"p"},"$millis()")," in the same expression for the duration of the evaluation."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The timestamp will be the same for all invocations within an expression","  ",Object(r.b)("strong",{parentName:"li"},"Query"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"invoiceTime": $now(),\n"total": $sum(Account.Order.Product.(Price * Quantity)),\n"closingTime": $now()\n}\n')),"  ",Object(r.b)("strong",{parentName:"li"},"Result"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'{\n"invoiceTime": "2018-12-10T13:49:51.141Z",\n"total": 336.36,\n"closingTime": "2018-12-10T13:49:51.141Z"\n}\n')))),Object(r.b)("h2",{id:"json-and-iso-8601"},"JSON and ISO 8601"),Object(r.b)("p",null,"JSON does not have a built-in type for date/time values.  The general ",Object(r.b)("a",{parentName:"p",href:"https://stackoverflow.com/a/15952652/7079134"},"consensus")," is to store the date/time value as a string in ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/ISO_8601"},"ISO 8601")," format."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'{\n    "myDateTime": "2018-12-10T13:45:00.000Z"\n}\n')),Object(r.b)("p",null,"JSONata follows this convention and provides functions for formatting and parsing ISO 8601 formatted timestamps\n(",Object(r.b)("a",{parentName:"p",href:"#tomillis"},Object(r.b)("inlineCode",{parentName:"a"},"toMillis()"))," and ",Object(r.b)("a",{parentName:"p",href:"#frommillis"},Object(r.b)("inlineCode",{parentName:"a"},"fromMillis()")),")"),Object(r.b)("h2",{id:"support-for-other-datetime-formats"},"Support for other date/time formats"),Object(r.b)("p",null,"Since there is no standard for date/time format in JSON, it is entirely possible that the JSON data you are working with will have date/time values formatted in other ways.  JSONata supports the highly versatile picture string notation from the XPath/XQuery ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#func-format-dateTime"},"fn:format-dateTime()")," specification for both the formatting and parsing of a wide variety of date/time formats. "),Object(r.b)("p",null,"See ",Object(r.b)("a",{parentName:"p",href:"#tomillis"},Object(r.b)("inlineCode",{parentName:"a"},"toMillis()"))," and ",Object(r.b)("a",{parentName:"p",href:"#frommillis"},Object(r.b)("inlineCode",{parentName:"a"},"fromMillis()"))," for details."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"The date ",Object(r.b)("inlineCode",{parentName:"p"},"12/10/2018")," in US format and ",Object(r.b)("inlineCode",{parentName:"p"},"10/12/2018")," in European format both refer to the same day."),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$toMillis('10/12/2018', '[D]/[M]/[Y]') ~> $fromMillis('[M]/[D]/[Y]')\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"12/10/2018"\n'))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"More verbose format."),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"$toMillis('10/12/2018', '[D]/[M]/[Y]') \n     ~> $fromMillis('[FNn], [D1o] [MNn] [YI]')\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},'"Monday, 10th December MMXVIII"\n')))),Object(r.b)("h1",{id:"path-operators"},"Path Operators"),Object(r.b)("p",null,"The path operators underpin the declarative nature of the map/filter/reduce processing model in JSONata."),Object(r.b)("h2",{id:"-map"},Object(r.b)("inlineCode",{parentName:"h2"},".")," (Map)"),Object(r.b)("p",null,"The dot operator is one of the fundamental building blocks in JSONata expressions.  It implements the 'for each' or 'map' function that is common in many functional languages."),Object(r.b)("p",null,"The dot operator performs the following logic:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The expression on the LHS is evaluated to produce an array of values.",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"If it evaluates to a single value, that is treated as equivalent to an array containing that single value"),Object(r.b)("li",{parentName:"ul"},"If it evaluates to nothing (no match or empty array), then the result of the operator expression is nothing"))),Object(r.b)("li",{parentName:"ul"},"For each value in the LHS array in turn:",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"The value is known as the ",Object(r.b)("em",{parentName:"li"},"context")," and is used as the basis for any relative path expression on the RHS.  It is also accessible in the RHS expression using the ",Object(r.b)("inlineCode",{parentName:"li"},"$")," symbol."),Object(r.b)("li",{parentName:"ul"},"The RHS expression is evaluated to produce a value or array of values (or nothing).  These values are appended to a combined array of results for the operator as a whole."))),Object(r.b)("li",{parentName:"ul"},"The combined result of the operator is returned.")),Object(r.b)("p",null,"This operator is left associative meaning that the expression ",Object(r.b)("inlineCode",{parentName:"p"},"a.b.c.d")," is evaluated like ",Object(r.b)("inlineCode",{parentName:"p"},"((a.b).c).d"),"; i.e. left to right"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Address.City")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"Winchester"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone.number")," => ",Object(r.b)("inlineCode",{parentName:"li"},'[ "0203 544 1234", "01962 001234", "01962 001235", "077 7700 1234" ]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Account.Order.Product.(Price * Quantity)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[ 68.9, 21.67, 137.8, 107.99 ]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Account.Order.OrderID.$uppercase()")," => ",Object(r.b)("inlineCode",{parentName:"li"},'[ "ORDER103", "ORDER104"]'))),Object(r.b)("h2",{id:"---filter"},Object(r.b)("inlineCode",{parentName:"h2"},"[")," ... ",Object(r.b)("inlineCode",{parentName:"h2"},"]")," (Filter)"),Object(r.b)("p",null,"The filter operator (a.k.a predicate) is used to select only the items in the input sequence that satisfy the predicate expression contained between the square brackets."),Object(r.b)("p",null,"If the predicate expression is an integer, or an expression that evaluates to an integer, then the item at that position (zero offset) in the input sequence is the only item selected for the result sequence.\nIf the number is non-integer, then it is rounded ",Object(r.b)("em",{parentName:"p"},"down")," to the nearest integer."),Object(r.b)("p",null,"If the predicate expression is an array of integers, or an expression that evaluates to an array of integers, then the items at those positions (zero offset) in the input sequence is the only item selected for the result sequence."),Object(r.b)("p",null,"If the predicate expression evaluates to any other value, then it is cast to a Boolean as if using the ",Object(r.b)("inlineCode",{parentName:"p"},"$boolean()")," function.  If this evaluates to ",Object(r.b)("inlineCode",{parentName:"p"},"true"),", then the item is retained in the result sequence.  Otherwise it is rejected."),Object(r.b)("p",null,"See ",Object(r.b)("a",{parentName:"p",href:"#navigating-json-arrays"},"Navigating JSON Arrays")," and ",Object(r.b)("a",{parentName:"p",href:"#predicate"},"Predicates")," for more details and examples."),Object(r.b)("h2",{id:"---order-by"},Object(r.b)("inlineCode",{parentName:"h2"},"^(")," ... ",Object(r.b)("inlineCode",{parentName:"h2"},")")," (Order-by)"),Object(r.b)("p",null,"The order-by operator is used to sort an array of values into ascending or descending order according to one or more expressions defined within the parentheses."),Object(r.b)("p",null,"By default, the array will be sorted into ascending order.  For example:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"Account.Order.Product^(Price)")),Object(r.b)("p",null,"sorts all of the products into order of increasing price (",Object(r.b)("inlineCode",{parentName:"p"},"Price")," is a numeric field in the ",Object(r.b)("inlineCode",{parentName:"p"},"Product")," object)."),Object(r.b)("p",null,"To sort in descending order, the sort expression must be preceded by the ",Object(r.b)("inlineCode",{parentName:"p"},">")," symbol. For example:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"Account.Order.Product^(>Price)")),Object(r.b)("p",null,"sorts all of the products into order of decreasing price.  The ",Object(r.b)("inlineCode",{parentName:"p"},"<")," symbol can be used to explicitly indicate ascending order, although that is the default behaviour."),Object(r.b)("p",null,"Secondary (and more) sort expressions can be specified by separating them with commas (",Object(r.b)("inlineCode",{parentName:"p"},","),").  The secondary expression will be used to determine order if the primary expression ranks two values the same.  For example,"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"Account.Order.Product^(>Price, <Quantity)")),Object(r.b)("p",null,"orders the products primarily by decreasing price, but for products of the same price, by increasing quantity."),Object(r.b)("p",null,"The sort expression(s) can be any valid JSONata expression that evaluates to a number or a string.  If it evaluates to a string then the array is sorted in order of unicode codepoint."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Account.Order.Product^(Price * Quantity)")," => Increasing order of price times quantity."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"student[type='fulltime']^(DoB).name")," => The names of all full time students sorted by date of birth (the DoB value is an ISO 8601 date format)")),Object(r.b)("h2",{id:"---reduce"},Object(r.b)("inlineCode",{parentName:"h2"},"{")," ... ",Object(r.b)("inlineCode",{parentName:"h2"},"}")," (Reduce)"),Object(r.b)("p",null,"The reduce operator can be used as the last step in a path expression to group and aggregate its input sequence into a single object.\nThe key/value pairs between the curly braces determine the groupings (by evaluating the key expression) and the aggregated values for each group.\nSee ",Object(r.b)("a",{parentName:"p",href:"#grouping"},"Grouping and Aggregation")," for more details."),Object(r.b)("h2",{id:"-wildcard"},Object(r.b)("inlineCode",{parentName:"h2"},"*")," (Wildcard)"),Object(r.b)("p",null,"This wildcard selects the values of all the properties of the context object.  It can be used in a path expression in place of a property name, but it cannot be combined with other characters like a glob pattern.  The order of these values in the result sequence is implementation dependent.\nSee ",Object(r.b)("a",{parentName:"p",href:"#wildcards"},"Wildcards")," for examples."),Object(r.b)("h2",{id:"-descendants"},Object(r.b)("inlineCode",{parentName:"h2"},"**")," (Descendants)"),Object(r.b)("p",null,"This wildcard recursively selects the values of all the properties of the context object, and the properties of any objects contained within these values as it descends the hierarchy.\nSee ",Object(r.b)("a",{parentName:"p",href:"#navigate-arbitrary-depths"},"Navigate arbitrary depths"),"."),Object(r.b)("h2",{id:"-parent"},Object(r.b)("inlineCode",{parentName:"h2"},"%")," (Parent)"),Object(r.b)("p",null,"This will select the 'parent' of the current context value.  Here, we define 'parent' to be the enclosing object which has the property representing the context value."),Object(r.b)("p",null,"This is the only operation which searches 'backwards' in the input data structure. It is implemented by static analysis of the expression at ",Object(r.b)("a",{parentName:"p",href:"https://docs.jsonata.org/embedding-extending#jsonatastr"},"compile time")," and can only be used within expressions that navigate through that target parent value in the first place.\nIf, for any reason, the parent location cannot be determined, then a static error (S0217) is thrown."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"Account.Order.Product.{\n  'Product': `Product Name`,\n  'Order': %.OrderID,\n  'Account': %.%.`Account Name`\n}\n")),Object(r.b)("p",null,"This returns an array of objects for each product in each order in each account.  Information from the enclosing Order and Account objects can be accessed using the parent operator.\nThe repeated combination of ",Object(r.b)("inlineCode",{parentName:"p"},"%.%.")," is used to access the grandparent and higher ancestors."),Object(r.b)("h2",{id:"-positional-variable-binding"},Object(r.b)("inlineCode",{parentName:"h2"},"#")," (Positional variable binding)"),Object(r.b)("p",null,"This can be used to determine at which position in the sequence the current context item is.  It can be used following any map, filter or order-by stage in the path.\nThe variable is available for use within subsequent stages of the path (e.g. within filter predicates) and goes out of scope at the end of the path expression."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"library.books#$i['Kernighan' in authors].{\n  'title': title,\n  'index': $i\n}\n")),Object(r.b)("p",null,"This returns an array of objects for each book in the library where Kernighan is one of the authors.  Each object contains the book's title and its position within the books array before it was filtered."),Object(r.b)("h2",{id:"-context-variable-binding"},Object(r.b)("inlineCode",{parentName:"h2"},"@")," (Context variable binding)"),Object(r.b)("p",null,"This is used to bind the current context item (",Object(r.b)("inlineCode",{parentName:"p"},"$"),") to a named variable.  It can only be used directly following a map stage, not a filter or order-by stage.\nThe variable binding remains in scope for the remainder of the path expression."),Object(r.b)("p",null,"Because the current context has now been explicitly bound to a named variable, this context will be carried forward to be the context of the next stage in the path.\nFor example, in this snippet of a path, ",Object(r.b)("inlineCode",{parentName:"p"},"library.loans@$l.books"),", the loans array is a property of the library object and each loan will, in turn, be bound to the variable ",Object(r.b)("inlineCode",{parentName:"p"},"$l"),".\nThe books array, which is also a property of the library object, will then be selected."),Object(r.b)("p",null,"This operator can be used to perform data joins within a path because of its ability to do cross-referencing across objects."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"library.loans@$l.books@$b[$l.isbn=$b.isbn].{\n  'title': $b.title,\n  'customer': $l.customer\n}\n")),Object(r.b)("p",null,"This performs an 'inner join' between objects in the loans array and objects in the books array where the ISBNs match between the structures."),Object(r.b)("p",null,"Block expressions can be used to widen the scope of the data cross-referencing as shown in this example:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(library.loans)@$l.(catalog.books)@$b[$l.isbn=$b.isbn].{\n  'title': $b.title,\n  'customer': $l.customer\n}\n")),Object(r.b)("h1",{id:"numeric-operators"},"Numeric Operators"),Object(r.b)("h2",{id:"-addition"},Object(r.b)("inlineCode",{parentName:"h2"},"+")," (Addition)"),Object(r.b)("p",null,"The addition operator adds the operands to produce the numerical sum.  It is an error if either operand is not a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"5 + 2")," => ",Object(r.b)("inlineCode",{parentName:"p"},"7")),Object(r.b)("h2",{id:"--substractionnegation"},Object(r.b)("inlineCode",{parentName:"h2"},"-")," (Substraction/Negation)"),Object(r.b)("p",null,"The subtraction operator subtracts the RHS value from the LHS value to produce the numerical difference  It is an error if either operand is not a number."),Object(r.b)("p",null,"It can also be used in its unary form to negate a number"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"5 - 2")," => ",Object(r.b)("inlineCode",{parentName:"li"},"3")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"- 42")," => ",Object(r.b)("inlineCode",{parentName:"li"},"-42"))),Object(r.b)("h2",{id:"-multiplication"},Object(r.b)("inlineCode",{parentName:"h2"},"*")," (Multiplication)"),Object(r.b)("p",null,"The multiplication operator multiplies the operands to produce the numerical product.  It is an error if either operand is not a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"5 * 2")," => ",Object(r.b)("inlineCode",{parentName:"p"},"10")),Object(r.b)("h2",{id:"-division"},Object(r.b)("inlineCode",{parentName:"h2"},"/")," (Division)"),Object(r.b)("p",null,"The division operator divides the RHS into the LHS to produce the numerical quotient.  It is an error if either operand is not a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"5 / 2")," => ",Object(r.b)("inlineCode",{parentName:"p"},"2.5")),Object(r.b)("h2",{id:"-modulo"},Object(r.b)("inlineCode",{parentName:"h2"},"%")," (Modulo)"),Object(r.b)("p",null,"The modulo operator divides the RHS into the LHS using whole number division to produce a whole number quotient and a remainder.  This operator returns the remainder.  It is an error if either operand is not a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"5 % 2")," => ",Object(r.b)("inlineCode",{parentName:"p"},"1")),Object(r.b)("h2",{id:"-range"},Object(r.b)("inlineCode",{parentName:"h2"},"..")," (Range)"),Object(r.b)("p",null,"The sequence generation operator is used to create an array of monotonically increasing integer start with the number on the LHS and ending with the number on the RHS.  It is an error if either operand does not evaluate to an integer.  The sequence generator can only be used within an array constructor []."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"[1..5]")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1, 2, 3, 4, 5]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"[1..3, 7..9]")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1, 2, 3, 7, 8, 9]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'[1..$count(Items)].("Item " & $)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'["Item 1","Item 2","Item 3"]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"[1..5].($*$)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1, 4, 9, 16, 25]"))),Object(r.b)("h1",{id:"comparison-operators"},"Comparison Operators"),Object(r.b)("h2",{id:"-equals"},Object(r.b)("inlineCode",{parentName:"h2"},"=")," (Equals)"),Object(r.b)("p",null,"The equality operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if both operands are the same (type and value).  Arrays and objects are checked for deep equality.  Arrays must have the same values in the same order. Objects must have the same key/value pairs (order is not relevant).  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"1+1 = 2")," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"Hello" = "World"')," => ",Object(r.b)("inlineCode",{parentName:"li"},"false"))),Object(r.b)("h2",{id:"-not-equals"},Object(r.b)("inlineCode",{parentName:"h2"},"!=")," (Not equals)"),Object(r.b)("p",null,"The inequality operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"false")," if both operands are the same (type and value, deep equality).  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"true"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"1+1 != 3")," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"Hello" != "World"')," => ",Object(r.b)("inlineCode",{parentName:"li"},"true"))),Object(r.b)("h2",{id:"-greater-than"},Object(r.b)("inlineCode",{parentName:"h2"},">")," (Greater than)"),Object(r.b)("p",null,"The 'greater than' operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the LHS is numerically greater than the RHS.  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"22 / 7 > 3")," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"5 > 5")," => ",Object(r.b)("inlineCode",{parentName:"li"},"false"))),Object(r.b)("h2",{id:"-less-than"},Object(r.b)("inlineCode",{parentName:"h2"},"<")," (Less than)"),Object(r.b)("p",null,"The 'less than' operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the LHS is numerically less than the RHS.  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"22 / 7 < 3")," => ",Object(r.b)("inlineCode",{parentName:"li"},"false")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"5 < 5")," => ",Object(r.b)("inlineCode",{parentName:"li"},"false"))),Object(r.b)("h2",{id:"-greater-than-or-equals"},Object(r.b)("inlineCode",{parentName:"h2"},">=")," (Greater than or equals)"),Object(r.b)("p",null,"The 'greater than or equals' operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the LHS is numerically greater than or equal to the RHS.  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"22 / 7 >= 3")," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"5 >= 5")," => ",Object(r.b)("inlineCode",{parentName:"li"},"true"))),Object(r.b)("h2",{id:"-less-than-or-equals"},Object(r.b)("inlineCode",{parentName:"h2"},"<=")," (Less than or equals)"),Object(r.b)("p",null,"The 'less than or equals' operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the LHS is numerically less than or equal to the RHS.  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"22 / 7 <= 3")," => ",Object(r.b)("inlineCode",{parentName:"li"},"false")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"5 <= 5")," => ",Object(r.b)("inlineCode",{parentName:"li"},"true"))),Object(r.b)("h2",{id:"in-inclusion"},Object(r.b)("inlineCode",{parentName:"h2"},"in")," (Inclusion)"),Object(r.b)("p",null,"The array (sequence) inclusion operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the value of the LHS is included in the array of values on the RHS.  Otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),".  If the RHS is a single value, then it is treated as a singleton array."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"world" in ["hello", "world"]')," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"hello" in "hello"')," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'library.books["Aho" in authors].title'))),Object(r.b)("h1",{id:"boolean-operators"},"Boolean Operators"),Object(r.b)("h2",{id:"and-boolean-and"},Object(r.b)("inlineCode",{parentName:"h2"},"and")," (Boolean AND)"),Object(r.b)("p",null,"The 'and' operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if both operands evaluate to ",Object(r.b)("inlineCode",{parentName:"p"},"true"),".  If either or both operands is not a Boolean type, then they are first cast to a Boolean using the rules of the ",Object(r.b)("inlineCode",{parentName:"p"},"$boolean")," function."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'library.books["Aho" in authors and price < 50].title')),Object(r.b)("h2",{id:"or-boolean-or"},Object(r.b)("inlineCode",{parentName:"h2"},"or")," (Boolean OR)"),Object(r.b)("p",null,"The 'or' operator returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if either operand evaluates to ",Object(r.b)("inlineCode",{parentName:"p"},"true"),".  If either or both operands is not a Boolean type, then they are first cast to a Boolean using the rules of the ",Object(r.b)("inlineCode",{parentName:"p"},"$boolean")," function."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'library.books[price < 10 or section="diy"].title')),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Please note that Boolean 'NOT' is a ",Object(r.b)("a",{parentName:"strong",href:"#not"},"function"),", not an operator.")),Object(r.b)("h1",{id:"other-operators"},"Other Operators"),Object(r.b)("h2",{id:"-concatenation"},Object(r.b)("inlineCode",{parentName:"h2"},"&")," (Concatenation)"),Object(r.b)("p",null,"The string concatenation operator is used to join the string values of the operands into a single resultant string.  If either or both of the operands are not strings, then they are first cast to string using the rules of the ",Object(r.b)("inlineCode",{parentName:"p"},"$string")," function."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'"Hello" & "World"')," => ",Object(r.b)("inlineCode",{parentName:"p"},'"HelloWorld"')),Object(r.b)("h2",{id:"--conditional"},Object(r.b)("inlineCode",{parentName:"h2"},"? :")," (Conditional)"),Object(r.b)("p",null,"The conditional ternary operator is used to evaluate one of two alternative expressions based on the result of a predicate (test) condition.  The operator takes the form:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"<test_expr> ? <expr_T> : <expr_F>")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"<test_expr>")," expression is first evaluated.  If it evaluates to Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true"),", then the operator returns the result of evaluating the ",Object(r.b)("inlineCode",{parentName:"p"},"<expr_T>")," expression.  Otherwise it returns the result of evaluating the ",Object(r.b)("inlineCode",{parentName:"p"},"<expr_F>")," expression. If ",Object(r.b)("inlineCode",{parentName:"p"},"<test_expr>")," evaluates to a non-Boolean value, then the value is first cast to Boolean using the rules of the ",Object(r.b)("inlineCode",{parentName:"p"},"$boolean")," function."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'Price < 50 ? "Cheap" : "Expensive"')),Object(r.b)("h2",{id:"-variable-binding"},Object(r.b)("inlineCode",{parentName:"h2"},":=")," (Variable binding)"),Object(r.b)("p",null,"The variable binding operator is used to bind the value of the RHS to the variable name defined on the LHS.  The variable binding is scoped to the current block and any nested blocks.  It is an error if the LHS is not a ",Object(r.b)("inlineCode",{parentName:"p"},"$")," followed by a valid variable name."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$five := 5")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$square := function($n) { $n * $n }"))),Object(r.b)("h2",{id:"-chain"},Object(r.b)("inlineCode",{parentName:"h2"},"~>")," (Chain)"),Object(r.b)("p",null,"The function chaining operator is used in the situations where multiple nested functions need to be applied to a value, while making it easy to read. The value on the LHS is evaluated, then passed into the function on the RHS as its first argument.  If the function has any other arguments, then these are passed to the function in parenthesis as usual.  It is an error if the RHS is not a function, or an expression that evaluates to a function."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'$uppercase($substringBefore($substringAfter(Customer.Email, "@"), "."))')),Object(r.b)("p",null,"and"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$sum(Account.Order.Product.(Price * Quantity))")),Object(r.b)("p",null,"can be more clearly written:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'Customer.Email ~> $substringAfter("@") ~> $substringBefore(".") ~> $uppercase()')),Object(r.b)("p",null,"and"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"Account.Order.Product.(Price * Quantity) ~> $sum()")),Object(r.b)("p",null,"This operator can also be used in a more abstract form to define new functions based on a combination of existing functions.  In this form, there is no value passed in on the LHS of the first function in the chain."),Object(r.b)("p",null,"For example, the expression"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'(\n  $uppertrim := $trim ~> $uppercase;\n  $uppertrim("   Hello    World   ")\n)\n')),Object(r.b)("p",null,"=> ",Object(r.b)("inlineCode",{parentName:"p"},'"HELLO WORLD"')),Object(r.b)("p",null,"creates a new function ",Object(r.b)("inlineCode",{parentName:"p"},"$uppertrim")," that performs ",Object(r.b)("inlineCode",{parentName:"p"},"$trim")," followed by ",Object(r.b)("inlineCode",{parentName:"p"},"$uppercase"),"."),Object(r.b)("h2",{id:"-------transform"},Object(r.b)("inlineCode",{parentName:"h2"},"... ~> | ... | ... |")," (Transform)"),Object(r.b)("p",null,"The object transform operator is used to modify a copy of an object structure using a pattern/action syntax to target specific modifications while keeping the rest of the structure unchanged."),Object(r.b)("p",null,"The syntax has the following structure:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"head ~> | location | update [, delete] |")),Object(r.b)("p",null,"where"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"head")," evaluates to the object that is to be copied and transformed"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"location")," evaluates to the part(s) within the copied object that are to be updated. The ",Object(r.b)("inlineCode",{parentName:"li"},"location")," expression is evaluated relative to the result of ",Object(r.b)("inlineCode",{parentName:"li"},"head"),". The result of evaluating ",Object(r.b)("inlineCode",{parentName:"li"},"location")," must be an object or array of objects."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"update")," evaluates to an object that is merged into the object matched by each ",Object(r.b)("inlineCode",{parentName:"li"},"location"),". ",Object(r.b)("inlineCode",{parentName:"li"},"update")," is evaluated relative to the result of ",Object(r.b)("inlineCode",{parentName:"li"},"location")," and if ",Object(r.b)("inlineCode",{parentName:"li"},"location")," matched multiple objects, then the update gets evaluated for each one of these. The result of (each) update is merged into the result of ",Object(r.b)("inlineCode",{parentName:"li"},"location"),"."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"delete")," (optional) evaluates to a string or an array of strings. Each string is the name of the name/value pair in each object matched by ",Object(r.b)("inlineCode",{parentName:"li"},"location")," that is to be removed from the resultant object.")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"~>")," operator is the operator for function chaining and passes the value on the left hand side to the function on the right hand side as its first argument. The expression on the right hand side must evaluate to a function, hence the ",Object(r.b)("inlineCode",{parentName:"p"},"|...|...|")," syntax generates a function with one argument."),Object(r.b)("p",null,"Example:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"| Account.Order.Product | {'Price': Price * 1.2} |")),Object(r.b)("p",null,"defines a transform that will return a deep copy the object passed to it, but with the ",Object(r.b)("inlineCode",{parentName:"p"},"Product")," object modified such that its ",Object(r.b)("inlineCode",{parentName:"p"},"Price")," property has had its value increased by 20%. The first part of the expression is the path location that specifies all of the objects within the overall object to change, and the second part defines an object that will get merged into the object(s) matched by the first part. The merging semantics is the same as that of the ",Object(r.b)("inlineCode",{parentName:"p"},"$merge()")," function."),Object(r.b)("p",null,"This transform definition syntax creates a JSONata function which you can either assign to a variable and use multiple times, or invoke inline.\nExample:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"payload ~> |Account.Order.Product|{'Price': Price * 1.2}|")),Object(r.b)("p",null,"or:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$increasePrice := |Account.Order.Product|{'Price': Price * 1.2}|")),Object(r.b)("p",null,"This also has the benefit that multiple transforms can be chained together for more complex transformations."),Object(r.b)("p",null,"In common with ",Object(r.b)("inlineCode",{parentName:"p"},"$merge()"),", multiple changes (inserts or updates) can be made to an object.\nExample:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"|Account.Order.Product|{'Price': Price * 1.2, 'Total': Price * Quantity}|")),Object(r.b)("p",null,"Note that the Total will be calculated using the original price, not the modified one (JSONata is declarative not imperative)."),Object(r.b)("p",null,"Properties can also be removed from objects.  This is done using the optional ",Object(r.b)("inlineCode",{parentName:"p"},"delete")," clause which specifies the name(s) of the properties to delete.\nExample:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$ ~> |Account.Order.Product|{'Total': Price * Quantity}, ['Price', 'Quantity']|")),Object(r.b)("p",null,"This copies the input, but for each ",Object(r.b)("inlineCode",{parentName:"p"},"Product")," it inserts a Total and removes the ",Object(r.b)("inlineCode",{parentName:"p"},"Price")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Quantity")," properties."),Object(r.b)("h1",{id:"string-functions"},"String functions"),Object(r.b)("h2",{id:"string"},Object(r.b)("inlineCode",{parentName:"h2"},"$string()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$string(arg, prettify)")),Object(r.b)("p",null,"Casts the ",Object(r.b)("inlineCode",{parentName:"p"},"arg")," parameter to a string using the following casting rules"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Strings are unchanged"),Object(r.b)("li",{parentName:"ul"},"Functions are converted to an empty string"),Object(r.b)("li",{parentName:"ul"},"Numeric infinity and NaN throw an error because they cannot be represented as a JSON number"),Object(r.b)("li",{parentName:"ul"},"All other values are converted to a JSON string using the ",Object(r.b)("a",{parentName:"li",href:"https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"},"JSON.stringify")," function")),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"arg")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"arg"),"."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"prettify"),' is true, then "prettified" JSON is produced. i.e One line per field and lines will be indented based on the field depth.'),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$string(5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"5"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"[1..5].$string()")," => ",Object(r.b)("inlineCode",{parentName:"li"},'["1", "2", "3", "4", "5"]'))),Object(r.b)("h2",{id:"length"},Object(r.b)("inlineCode",{parentName:"h2"},"$length()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$length(str)")),Object(r.b)("p",null,"Returns the number of characters in the string ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$length("Hello World")')," => ",Object(r.b)("inlineCode",{parentName:"li"},"11"))),Object(r.b)("h2",{id:"substring"},Object(r.b)("inlineCode",{parentName:"h2"},"$substring()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$substring(str, start[, length])")),Object(r.b)("p",null,"Returns a string containing the characters in the first parameter ",Object(r.b)("inlineCode",{parentName:"p"},"str")," starting at position ",Object(r.b)("inlineCode",{parentName:"p"},"start")," (zero-offset).  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with only the numeric argument(s)), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"length")," is specified, then the substring will contain maximum ",Object(r.b)("inlineCode",{parentName:"p"},"length")," characters."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"start")," is negative then it indicates the number of characters from the end of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  See ",Object(r.b)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/substr"},"substr")," for full definition."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substring("Hello World", 3)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"lo World"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substring("Hello World", 3, 5)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"lo Wo"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substring("Hello World", -4)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"orld"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substring("Hello World", -4, 2)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"or"'))),Object(r.b)("h2",{id:"substringbefore"},Object(r.b)("inlineCode",{parentName:"h2"},"$substringBefore()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$substringBefore(str, chars)")),Object(r.b)("p",null,"Returns the substring before the first occurrence of the character sequence ",Object(r.b)("inlineCode",{parentName:"p"},"chars")," in ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with only one argument), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," does not contain ",Object(r.b)("inlineCode",{parentName:"p"},"chars"),", then it returns ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".   An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," and ",Object(r.b)("inlineCode",{parentName:"p"},"chars")," are not strings."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substringBefore("Hello World", " ")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"Hello"'))),Object(r.b)("h2",{id:"substringafter"},Object(r.b)("inlineCode",{parentName:"h2"},"$substringAfter()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$substringAfter(str, chars)")),Object(r.b)("p",null,"Returns the substring after the first occurrence of the character sequence ",Object(r.b)("inlineCode",{parentName:"p"},"chars")," in ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with only one argument), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," does not contain ",Object(r.b)("inlineCode",{parentName:"p"},"chars"),", then it returns ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".   An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," and ",Object(r.b)("inlineCode",{parentName:"p"},"chars")," are not strings."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$substringAfter("Hello World", " ")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"World"'))),Object(r.b)("h2",{id:"uppercase"},Object(r.b)("inlineCode",{parentName:"h2"},"$uppercase()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$uppercase(str)")),Object(r.b)("p",null,"Returns a string with all the characters of ",Object(r.b)("inlineCode",{parentName:"p"},"str")," converted to uppercase.  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$uppercase("Hello World")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"HELLO WORLD"'))),Object(r.b)("h2",{id:"lowercase"},Object(r.b)("inlineCode",{parentName:"h2"},"$lowercase()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$lowercase(str)")),Object(r.b)("p",null,"Returns a string with all the characters of ",Object(r.b)("inlineCode",{parentName:"p"},"str")," converted to lowercase.  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$lowercase("Hello World")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"hello world"'))),Object(r.b)("h2",{id:"trim"},Object(r.b)("inlineCode",{parentName:"h2"},"$trim()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$trim(str)")),Object(r.b)("p",null,"Normalizes and trims all whitespace characters in ",Object(r.b)("inlineCode",{parentName:"p"},"str")," by applying the following steps:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"All tabs, carriage returns, and line feeds are replaced with spaces."),Object(r.b)("li",{parentName:"ul"},"Contiguous sequences of spaces are reduced to a single space."),Object(r.b)("li",{parentName:"ul"},"Trailing and leading spaces are removed.")),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  An error is thrown if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$trim("   Hello    \\n World  ")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"Hello World"'))),Object(r.b)("h2",{id:"pad"},Object(r.b)("inlineCode",{parentName:"h2"},"$pad()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$pad(str, width [, char])")),Object(r.b)("p",null,"Returns a copy of the string ",Object(r.b)("inlineCode",{parentName:"p"},"str")," with extra padding, if necessary, so that its total number of characters is at least the absolute value of the ",Object(r.b)("inlineCode",{parentName:"p"},"width")," parameter.  If ",Object(r.b)("inlineCode",{parentName:"p"},"width")," is a positive number, then the string is padded to the right; if negative, it is padded to the left.  The optional ",Object(r.b)("inlineCode",{parentName:"p"},"char")," argument specifies the padding character(s) to use.  If not specified, it defaults to the space character."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$pad("foo", 5)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"foo  "')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$pad("foo", -5)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"  foo"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$pad("foo", -5, "#")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"##foo"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$formatBase(35, 2) ~> $pad(-8, '0')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"00100011"'))),Object(r.b)("h2",{id:"contains"},Object(r.b)("inlineCode",{parentName:"h2"},"$contains()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$contains(str, pattern)")),Object(r.b)("p",null,"Returns ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is matched by ",Object(r.b)("inlineCode",{parentName:"p"},"pattern"),", otherwise it returns ",Object(r.b)("inlineCode",{parentName:"p"},"false"),". If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified (i.e. this function is invoked with one argument), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),"."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," parameter can either be a string or a regular expression (regex).  If it is a string, the function returns ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the characters within ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," are contained contiguously within ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  If it is a regex, the function will return ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the regex matches the contents of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$contains("abracadabra", "bra")')," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$contains("abracadabra", /a.*a/)')," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$contains("abracadabra", /ar.*a/)')," => ",Object(r.b)("inlineCode",{parentName:"li"},"false")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$contains("Hello World", /wo/)')," => ",Object(r.b)("inlineCode",{parentName:"li"},"false")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$contains("Hello World", /wo/i)')," => ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Phone[$contains(number, /^077/)]")," => ",Object(r.b)("inlineCode",{parentName:"li"},'{ "type": "mobile", "number": "077 7700 1234" }'))),Object(r.b)("h2",{id:"split"},Object(r.b)("inlineCode",{parentName:"h2"},"$split()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$split(str, separator [, limit])")),Object(r.b)("p",null,"Splits the ",Object(r.b)("inlineCode",{parentName:"p"},"str")," parameter into an array of substrings.  If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified, then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  It is an error if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"separator")," parameter can either be a string or a regular expression (regex).  If it is a string, it specifies the characters within ",Object(r.b)("inlineCode",{parentName:"p"},"str")," about which it should be split.  If it is the empty string, ",Object(r.b)("inlineCode",{parentName:"p"},"str")," will be split into an array of single characters.  If it is a regex, it splits the string around any sequence of characters that match the regex."),Object(r.b)("p",null,"The optional ",Object(r.b)("inlineCode",{parentName:"p"},"limit")," parameter is a number that specifies the maximum number of substrings to  include in the resultant array.  Any additional substrings are discarded.  If ",Object(r.b)("inlineCode",{parentName:"p"},"limit")," is not  specified, then ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is fully split with no limit to the size of the resultant array.  It is an error if ",Object(r.b)("inlineCode",{parentName:"p"},"limit")," is not a non-negative number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$split("so many words", " ")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'[ "so", "many", "words" ]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$split("so many words", " ", 2)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'[ "so", "many" ]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$split("too much, punctuation. hard; to read", /[ ,.;]+/)')," => ",Object(r.b)("inlineCode",{parentName:"li"},'["too", "much", "punctuation", "hard", "to", "read"]'))),Object(r.b)("h2",{id:"join"},Object(r.b)("inlineCode",{parentName:"h2"},"$join()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$join(array[, separator])")),Object(r.b)("p",null,"Joins an array of component strings into a single concatenated string with each component string separated by the optional ",Object(r.b)("inlineCode",{parentName:"p"},"separator")," parameter."),Object(r.b)("p",null,"It is an error if the input array contains an item which isn't a string."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"separator")," is not specified, then it is assumed to be the empty string, i.e. no separator between the component strings.  It is an error if ",Object(r.b)("inlineCode",{parentName:"p"},"separator")," is not a string."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$join(['a','b','c'])")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"abc"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$split(\"too much, punctuation. hard; to read\", /[ ,.;]+/, 3) ~> $join(', ')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"too, much, punctuation"'))),Object(r.b)("h2",{id:"match"},Object(r.b)("inlineCode",{parentName:"h2"},"$match()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$match(str, pattern [, limit])")),Object(r.b)("p",null,"Applies the ",Object(r.b)("inlineCode",{parentName:"p"},"str")," string to the ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," regular expression and returns an array of objects, with each object containing information about each occurrence of a match withing ",Object(r.b)("inlineCode",{parentName:"p"},"str"),"."),Object(r.b)("p",null,"The object contains the following fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"match")," - the substring that was matched by the regex."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"index")," - the offset (starting at zero) within ",Object(r.b)("inlineCode",{parentName:"li"},"str")," of this match."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"groups")," - if the regex contains capturing groups (parentheses), this contains an array of strings representing each captured group.")),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified, then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  It is an error if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'$match("ababbabbcc",/a(b+)/)')," =>"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'[\n  {\n    "match": "ab",\n    "index": 0,\n    "groups": ["b"]\n  },\n  {\n    "match": "abb",\n    "index": 2,\n    "groups": ["bb"]\n  },\n  {\n    "match": "abb",\n    "index": 5,\n    "groups": ["bb" ]\n  }\n]\n')),Object(r.b)("h2",{id:"replace"},Object(r.b)("inlineCode",{parentName:"h2"},"$replace()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$replace(str, pattern, replacement [, limit])")),Object(r.b)("p",null,"Finds occurrences of ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," within ",Object(r.b)("inlineCode",{parentName:"p"},"str")," and replaces them with ",Object(r.b)("inlineCode",{parentName:"p"},"replacement"),"."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not specified, then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"str"),".  It is an error if ",Object(r.b)("inlineCode",{parentName:"p"},"str")," is not a string."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," parameter can either be a string or a regular expression (regex).  If it is a string, it specifies the substring(s) within ",Object(r.b)("inlineCode",{parentName:"p"},"str")," which should be replaced.  If it is a regex, its is used to find ."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"replacement")," parameter can either be a string or a function.  If it is a string, it specifies the sequence of characters that replace the substring(s) that are matched by ",Object(r.b)("inlineCode",{parentName:"p"},"pattern"),".  If ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," is a regex, then the ",Object(r.b)("inlineCode",{parentName:"p"},"replacement")," string can refer to the characters that were matched by the regex as well as any of the captured groups using a ",Object(r.b)("inlineCode",{parentName:"p"},"$")," followed by a number ",Object(r.b)("inlineCode",{parentName:"p"},"N"),":"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"If ",Object(r.b)("inlineCode",{parentName:"li"},"N = 0"),", then it is replaced by substring matched by the regex as a whole."),Object(r.b)("li",{parentName:"ul"},"If ",Object(r.b)("inlineCode",{parentName:"li"},"N > 0"),", then it is replaced by the substring captured by the Nth parenthesised group in the regex."),Object(r.b)("li",{parentName:"ul"},"If ",Object(r.b)("inlineCode",{parentName:"li"},"N")," is greater than the number of captured groups, then it is replaced by the empty string."),Object(r.b)("li",{parentName:"ul"},"A literal ",Object(r.b)("inlineCode",{parentName:"li"},"$")," character must be written as ",Object(r.b)("inlineCode",{parentName:"li"},"$$")," in the ",Object(r.b)("inlineCode",{parentName:"li"},"replacement")," string")),Object(r.b)("p",null,"If the ",Object(r.b)("inlineCode",{parentName:"p"},"replacement")," parameter is a function, then it is invoked for each match occurrence of the ",Object(r.b)("inlineCode",{parentName:"p"},"pattern")," regex.  The ",Object(r.b)("inlineCode",{parentName:"p"},"replacement")," function must take a single parameter which will be the object structure of a regex match as described in the ",Object(r.b)("inlineCode",{parentName:"p"},"$match")," function; and must return a string."),Object(r.b)("p",null,"The optional ",Object(r.b)("inlineCode",{parentName:"p"},"limit")," parameter,  is a number that specifies the maximum number of replacements to make before stopping.  The remainder of the input beyond this limit will be copied to the output unchanged."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$replace("John Smith and John Jones", "John", "Mr")\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'"Mr Smith and Mr Jones"\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$replace("John Smith and John Jones", "John", "Mr", 1)\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'"Mr Smith and John Jones"\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$replace("abracadabra", /a.*?a/, "*")\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'"*c*bra"\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$replace("John Smith", /(\\w+)\\s(\\w+)/, "$2, $1")\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'"Smith, John"\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$replace("265USD", /([0-9]+)USD/, "$$$1")\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'"$265"\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'(\n$convert := function($m) {\n  ($number($m.groups[0]) - 32) * 5/9 & "C"\n};\n$replace("temperature = 68F today", /(\\d+)F/, $convert)\n)\n')),Object(r.b)("p",null,"  ",Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'"temperature = 20C today"\n')),Object(r.b)("h2",{id:"eval"},Object(r.b)("inlineCode",{parentName:"h2"},"$eval()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$eval(expr [, context])")),Object(r.b)("p",null,"Parses and evaluates the string ",Object(r.b)("inlineCode",{parentName:"p"},"expr")," which contains literal JSON or a JSONata expression using the current context as the context for evaluation."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$eval("[1,2,3]")\n')),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"[1, 2, 3]\n")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Query")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"$eval('[1,$string(2),3]')\n")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Result")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'[1,"2",3]\n')),Object(r.b)("p",null,"Optionally override the context by specifying the second parameter"),Object(r.b)("h2",{id:"base64encode"},Object(r.b)("inlineCode",{parentName:"h2"},"$base64encode()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$base64encode()")),Object(r.b)("p",null,"Converts an ASCII string to a base 64 representation. Each each character in the string is treated as a byte of binary data. This requires that all characters in the string are in the 0x00 to 0xFF range, which includes all characters in URI encoded strings. Unicode characters outside of that range are not supported."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$base64encode("myuser:mypass")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"bXl1c2VyOm15cGFzcw=="'))),Object(r.b)("h2",{id:"base64decode"},Object(r.b)("inlineCode",{parentName:"h2"},"$base64decode()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$base64decode()")),Object(r.b)("p",null,"Converts base 64 encoded bytes to a string, using a UTF-8 Unicode codepage."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$base64decode("bXl1c2VyOm15cGFzcw==")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"myuser:mypass"'))),Object(r.b)("h2",{id:"encodeurlcomponent"},Object(r.b)("inlineCode",{parentName:"h2"},"$encodeUrlComponent()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$encodeUrlComponent(str)")),Object(r.b)("p",null,"Encodes a Uniform Resource Locator (URL) component by replacing each instance of certain characters by one, two, three, or four escape sequences representing the UTF-8 encoding of the character."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$encodeUrlComponent("?x=test")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"%3Fx%3Dtest"'))),Object(r.b)("h2",{id:"encodeurl"},Object(r.b)("inlineCode",{parentName:"h2"},"$encodeUrl()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$encodeUrl(str)")),Object(r.b)("p",null,"Encodes a Uniform Resource Locator (URL) by replacing each instance of certain characters by one, two, three, or four escape sequences representing the UTF-8 encoding of the character."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$encodeUrl("https://mozilla.org/?x=\u0448\u0435\u043b\u043b\u044b")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"https://mozilla.org/?x=%D1%88%D0%B5%D0%BB%D0%BB%D1%8B"'))),Object(r.b)("h2",{id:"decodeurlcomponent"},Object(r.b)("inlineCode",{parentName:"h2"},"$decodeUrlComponent()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$decodeUrlComponent(str)")),Object(r.b)("p",null,"Decodes a Uniform Resource Locator (URL) component previously created by encodeUrlComponent."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$decodeUrlComponent("%3Fx%3Dtest")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"?x=test"'))),Object(r.b)("h2",{id:"decodeurl"},Object(r.b)("inlineCode",{parentName:"h2"},"$decodeUrl()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$decodeUrl(str)")),Object(r.b)("p",null,"Decodes a Uniform Resource Locator (URL) previously created by encodeUrl."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$decodeUrl("https://mozilla.org/?x=%D1%88%D0%B5%D0%BB%D0%BB%D1%8B")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"https://mozilla.org/?x=\u0448\u0435\u043b\u043b\u044b"'))),Object(r.b)("h1",{id:"numeric-functions"},"Numeric functions"),Object(r.b)("h2",{id:"number"},Object(r.b)("inlineCode",{parentName:"h2"},"$number()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$number(arg)")),Object(r.b)("p",null,"Casts the ",Object(r.b)("inlineCode",{parentName:"p"},"arg")," parameter to a number using the following casting rules"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Numbers are unchanged"),Object(r.b)("li",{parentName:"ul"},"Strings that contain a sequence of characters that represent a legal JSON number are converted to that number"),Object(r.b)("li",{parentName:"ul"},"Boolean ",Object(r.b)("inlineCode",{parentName:"li"},"true")," casts to ",Object(r.b)("inlineCode",{parentName:"li"},"1"),", Boolean ",Object(r.b)("inlineCode",{parentName:"li"},"false")," casts to ",Object(r.b)("inlineCode",{parentName:"li"},"0")),Object(r.b)("li",{parentName:"ul"},"All other values cause an error to be thrown.")),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"arg")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"arg"),". "),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$number("5")')," => ",Object(r.b)("inlineCode",{parentName:"li"},"5"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'["1", "2", "3", "4", "5"].$number()')," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1, 2, 3, 4, 5]"))),Object(r.b)("h2",{id:"abs"},Object(r.b)("inlineCode",{parentName:"h2"},"$abs()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$abs(number)")),Object(r.b)("p",null,"Returns the absolute value of the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," parameter, i.e. if the number is negative, it returns the positive value."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"number")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number"),". "),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$abs(5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"5"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$abs(-5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"-5"))),Object(r.b)("h2",{id:"floor"},Object(r.b)("inlineCode",{parentName:"h2"},"$floor()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$floor(number)")),Object(r.b)("p",null,"Returns the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number")," rounded down to the nearest integer that is smaller or equal to ",Object(r.b)("inlineCode",{parentName:"p"},"number"),". "),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"number")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number"),". "),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$floor(5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"5"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$floor(5.3)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"5"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$floor(5.8)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"5"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$floor(-5.3)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"-6"),"  ")),Object(r.b)("h2",{id:"ceil"},Object(r.b)("inlineCode",{parentName:"h2"},"$ceil()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$ceil(number)")),Object(r.b)("p",null,"Returns the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number")," rounded up to the nearest integer that is greater than or equal to ",Object(r.b)("inlineCode",{parentName:"p"},"number"),". "),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"number")," is not specified (i.e. this function is invoked with no arguments), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number"),". "),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$ceil(5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"5"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$ceil(5.3)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"6"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$ceil(5.8)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"6"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$ceil(-5.3)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"-5"),"  ")),Object(r.b)("h2",{id:"round"},Object(r.b)("inlineCode",{parentName:"h2"},"$round()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$round(number [, precision])")),Object(r.b)("p",null,"Returns the value of the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," parameter rounded to the number of decimal places specified by the optional ",Object(r.b)("inlineCode",{parentName:"p"},"precision")," parameter.  "),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"precision")," parameter (which must be an integer) species the number of decimal places to be present in the rounded number.   If ",Object(r.b)("inlineCode",{parentName:"p"},"precision")," is not specified then it defaults to the value ",Object(r.b)("inlineCode",{parentName:"p"},"0")," and the number is rounded to the nearest integer.  If ",Object(r.b)("inlineCode",{parentName:"p"},"precision")," is negative, then its value specifies which column to round to on the left side of the decimal place"),Object(r.b)("p",null,"This function uses the ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Rounding#Round_half_to_even"},"Round half to even")," strategy to decide which way to round numbers that fall exactly between two candidates at the specified precision.  This strategy is commonly used in financial calculations and is the default rounding mode in IEEE 754."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(123.456)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"123"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(123.456, 2)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"123.46"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(123.456, -1)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"120"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(123.456, -2)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"100"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(11.5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"12"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(12.5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"12"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$round(125, -1)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"120"))),Object(r.b)("h2",{id:"power"},Object(r.b)("inlineCode",{parentName:"h2"},"$power()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$power(base, exponent)")),Object(r.b)("p",null,"Returns the value of ",Object(r.b)("inlineCode",{parentName:"p"},"base")," raised to the power of ",Object(r.b)("inlineCode",{parentName:"p"},"exponent")," (",Object(r.b)("code",null,"base",Object(r.b)("sup",null,"exponent")),")."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"base")," is not specified (i.e. this function is invoked with one argument), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"base"),". "),Object(r.b)("p",null,"An error is thrown if the values of ",Object(r.b)("inlineCode",{parentName:"p"},"base")," and ",Object(r.b)("inlineCode",{parentName:"p"},"exponent")," lead to a value that cannot be represented as a JSON number (e.g. Infinity, complex numbers)."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$power(2, 8)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"256"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$power(2, 0.5)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"1.414213562373"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$power(2, -2)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"0.25"),"  ")),Object(r.b)("h2",{id:"sqrt"},Object(r.b)("inlineCode",{parentName:"h2"},"$sqrt()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$sqrt(number)")),Object(r.b)("p",null,"Returns the square root of the value of the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," parameter."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"number")," is not specified (i.e. this function is invoked with one argument), then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number"),". "),Object(r.b)("p",null,"An error is thrown if the value of ",Object(r.b)("inlineCode",{parentName:"p"},"number")," is negative."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$sqrt(4)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"2")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$sqrt(2)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"1.414213562373"),"  ")),Object(r.b)("h2",{id:"random"},Object(r.b)("inlineCode",{parentName:"h2"},"$random()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$random()")),Object(r.b)("p",null,"Returns a pseudo random number greater than or equal to zero and less than one (",Object(r.b)("code",null,"0 ","\u2264"," n < 1"),") "),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$random()")," => ",Object(r.b)("inlineCode",{parentName:"li"},"0.7973541067127"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$random()")," => ",Object(r.b)("inlineCode",{parentName:"li"},"0.4029142127028"),"  "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$random()")," => ",Object(r.b)("inlineCode",{parentName:"li"},"0.6558078550072"),"  ")),Object(r.b)("h2",{id:"formatnumber"},Object(r.b)("inlineCode",{parentName:"h2"},"$formatNumber()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$formatNumber(number, picture [, options])")),Object(r.b)("p",null,"Casts the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," to a string and formats it to a decimal representation as specified by the ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string."),Object(r.b)("p",null,"The behaviour of this function is consistent with the XPath/XQuery function ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#func-format-number"},"fn:format-number")," as defined in the XPath F&O 3.1 specification.  The picture string parameter defines how the number is formatted and has the ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#syntax-of-picture-string"},"same syntax")," as fn:format-number."),Object(r.b)("p",null,"The optional third argument ",Object(r.b)("inlineCode",{parentName:"p"},"options")," is used to override the default locale specific formatting characters such as the decimal separator.  If supplied, this argument must be an object containing name/value pairs specified in the ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#defining-decimal-format"},"decimal format")," section of the XPath F&O 3.1 specification."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$formatNumber(12345.6, '#,###.00')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"12,345.60"'),"   "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$formatNumber(1234.5678, "00.000e0")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"12.346e2"'),"   "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$formatNumber(34.555, "#0.00;(#0.00)")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"34.56"'),"   "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$formatNumber(-34.555, "#0.00;(#0.00)")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"(34.56)"'),"   "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$formatNumber(0.14, "01%")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"14%"'),"   "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$formatNumber(0.14, "###pm", {"per-mille": "pm"})')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"140pm"'),"   "),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$formatNumber(1234.5678, "\u2460\u2460.\u2460\u2460\u2460e\u2460", {"zero-digit": "\\u245f"})')," => ",Object(r.b)("inlineCode",{parentName:"li"},'"\u2460\u2461.\u2462\u2463\u2465e\u2461"'),"   ")),Object(r.b)("h2",{id:"formatbase"},Object(r.b)("inlineCode",{parentName:"h2"},"$formatBase()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$formatBase(number [, radix])")),Object(r.b)("p",null,"Casts the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," to a string and formats it to an integer represented in the number base specified by the ",Object(r.b)("inlineCode",{parentName:"p"},"radix")," argument.  If ",Object(r.b)("inlineCode",{parentName:"p"},"radix")," is not specified, then it defaults to base 10.  ",Object(r.b)("inlineCode",{parentName:"p"},"radix")," can be between 2 and 36, otherwise an error is thrown."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$formatBase(100, 2)")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"1100100"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$formatBase(2555, 16)")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"9fb"'))),Object(r.b)("h2",{id:"formatinteger"},Object(r.b)("inlineCode",{parentName:"h2"},"$formatInteger()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$formatInteger(number, picture)")),Object(r.b)("p",null,"Casts the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," to a string and formats it to an integer representation as specified by the ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string."),Object(r.b)("p",null,"The behaviour of this function is consistent with the two-argument version of the XPath/XQuery function ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#func-format-integer"},"fn:format-integer")," as defined in the XPath F&O 3.1 specification.  The picture string parameter defines how the number is formatted and has the same syntax as fn:format-integer."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$formatInteger(2789, 'w')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"two thousand, seven hundred and eighty-nine"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$formatInteger(1999, 'I')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"MCMXCIX"'))),Object(r.b)("h2",{id:"parseinteger"},Object(r.b)("inlineCode",{parentName:"h2"},"$parseInteger()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$parseInteger(string, picture)")),Object(r.b)("p",null,"Parses the contents of the ",Object(r.b)("inlineCode",{parentName:"p"},"string")," parameter to an integer (as a JSON number) using the format specified by the ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string.\nThe picture string parameter has the same format as ",Object(r.b)("inlineCode",{parentName:"p"},"$formatInteger"),". Although the XPath specification does not have an equivalent\nfunction for parsing integers, this capability has been added to JSONata."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$parseInteger(\"twelve thousand, four hundred and seventy-six\", 'w')")," => ",Object(r.b)("inlineCode",{parentName:"li"},"12476")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$parseInteger('12,345,678', '#,##0')")," => ",Object(r.b)("inlineCode",{parentName:"li"},"12345678"))),Object(r.b)("h1",{id:"numeric-aggregation-functions"},"Numeric aggregation functions"),Object(r.b)("h2",{id:"sum"},Object(r.b)("inlineCode",{parentName:"h2"},"$sum()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$sum(array)")),Object(r.b)("p",null,"Returns the arithmetic sum of an array of numbers.  It is an error if the input array contains an item which isn't a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$sum([5,1,3,7,4])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"20"))),Object(r.b)("h2",{id:"max"},Object(r.b)("inlineCode",{parentName:"h2"},"$max()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$max(array)")),Object(r.b)("p",null,"Returns the maximum number in an array of numbers.  It is an error if the input array contains an item which isn't a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$max([5,1,3,7,4])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"7"))),Object(r.b)("h2",{id:"min"},Object(r.b)("inlineCode",{parentName:"h2"},"$min()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$min(array)")),Object(r.b)("p",null,"Returns the minimum number in an array of numbers.  It is an error if the input array contains an item which isn't a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$min([5,1,3,7,4])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"1"))),Object(r.b)("h2",{id:"average"},Object(r.b)("inlineCode",{parentName:"h2"},"$average()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$average(array)")),Object(r.b)("p",null,"Returns the mean value of an array of numbers.  It is an error if the input array contains an item which isn't a number."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$average([5,1,3,7,4])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"4"))),Object(r.b)("h1",{id:"boolean-functions"},"Boolean functions"),Object(r.b)("h2",{id:"boolean"},Object(r.b)("inlineCode",{parentName:"h2"},"$boolean()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$boolean(arg)")),Object(r.b)("p",null,"Casts the argument to a Boolean using the following rules:"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Argument type"),Object(r.b)("th",{parentName:"tr",align:null},"Result"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"Boolean"),Object(r.b)("td",{parentName:"tr",align:null},"unchanged")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"string: empty"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"string: non-empty"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"true"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"number: 0"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"number: non-zero"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"true"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"null"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"array: empty"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"array: contains a member that casts to ",Object(r.b)("inlineCode",{parentName:"td"},"true")),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"true"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"array: all members cast to ",Object(r.b)("inlineCode",{parentName:"td"},"false")),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"object: empty"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"object: non-empty"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"true"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"function"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"false"))))),Object(r.b)("h2",{id:"not"},Object(r.b)("inlineCode",{parentName:"h2"},"$not()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$not(arg)")),Object(r.b)("p",null,"Returns Boolean NOT on the argument.  ",Object(r.b)("inlineCode",{parentName:"p"},"arg")," is first cast to a boolean"),Object(r.b)("h2",{id:"exists"},Object(r.b)("inlineCode",{parentName:"h2"},"$exists()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$exists(arg)")),Object(r.b)("p",null,"Returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," if the arg expression evaluates to a value, or ",Object(r.b)("inlineCode",{parentName:"p"},"false")," if the expression does not match anything (e.g. a path to a non-existent field reference)."),Object(r.b)("h1",{id:"array-functions"},"Array Functions"),Object(r.b)("h2",{id:"count"},Object(r.b)("inlineCode",{parentName:"h2"},"$count()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$count(array)")),Object(r.b)("p",null,"Returns the number of items in the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter.  If the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter is not an array, but rather a value of another JSON type, then the parameter is treated as a singleton array containing that value, and this function returns ",Object(r.b)("inlineCode",{parentName:"p"},"1"),"."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"array")," is not specified, then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"array"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$count([1,2,3,1])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"4")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$count("hello")')," => 1")),Object(r.b)("h2",{id:"append"},Object(r.b)("inlineCode",{parentName:"h2"},"$append()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$append(array1, array2)")),Object(r.b)("p",null,"Returns an array containing the values in ",Object(r.b)("inlineCode",{parentName:"p"},"array1")," followed by the values in ",Object(r.b)("inlineCode",{parentName:"p"},"array2"),".  If either parameter is not an array, then it is treated as a singleton array containing that value."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$append([1,2,3], [4,5,6])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1,2,3,4,5,6]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$append([1,2,3], 4)")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1,2,3,4]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$append("Hello", "World")')," => ",Object(r.b)("inlineCode",{parentName:"li"},'["Hello", "World"]'))),Object(r.b)("h2",{id:"sort"},Object(r.b)("inlineCode",{parentName:"h2"},"$sort()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$sort(array [, function])")),Object(r.b)("p",null,"Returns an array containing all the values in the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter, but sorted into order.  If no ",Object(r.b)("inlineCode",{parentName:"p"},"function")," parameter is supplied, then the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter must contain only numbers or only strings, and they will be sorted in order of increasing number, or increasing unicode codepoint respectively."),Object(r.b)("p",null,"If a comparator ",Object(r.b)("inlineCode",{parentName:"p"},"function")," is supplied, then is must be a function that takes two parameters:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function(left, right)")),Object(r.b)("p",null,"This function gets invoked by the sorting algorithm to compare two values ",Object(r.b)("inlineCode",{parentName:"p"},"left")," and ",Object(r.b)("inlineCode",{parentName:"p"},"right"),".  If the value of ",Object(r.b)("inlineCode",{parentName:"p"},"left")," should be placed after the value of ",Object(r.b)("inlineCode",{parentName:"p"},"right")," in the desired sort order, then the function must return Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," to indicate a swap.  Otherwise it must return ",Object(r.b)("inlineCode",{parentName:"p"},"false"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"$sort(Account.Order.Product, function($l, $r) {\n  $l.Description.Weight > $r.Description.Weight\n})\n")),Object(r.b)("p",null,"This sorts the products in order of increasing weight."),Object(r.b)("p",null,"The sorting algorithm is ",Object(r.b)("em",{parentName:"p"},"stable")," which means that values within the original array which are the same according to the comparator function will remain in the original order in the sorted array."),Object(r.b)("h2",{id:"reverse"},Object(r.b)("inlineCode",{parentName:"h2"},"$reverse()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$reverse(array)")),Object(r.b)("p",null,"Returns an array containing all the values from the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter, but in reverse order."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$reverse(["Hello", "World"])')," => ",Object(r.b)("inlineCode",{parentName:"li"},'["World", "Hello"]')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"[1..5] ~> $reverse()")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[5, 4, 3, 2, 1]"))),Object(r.b)("h2",{id:"shuffle"},Object(r.b)("inlineCode",{parentName:"h2"},"$shuffle()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$shuffle(array)")),Object(r.b)("p",null,"Returns an array containing all the values from the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter, but shuffled into random order."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$shuffle([1..9])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[6, 8, 2, 3, 9, 5, 1, 4, 7]"))),Object(r.b)("h2",{id:"distinct"},Object(r.b)("inlineCode",{parentName:"h2"},"$distinct()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature")," ",Object(r.b)("inlineCode",{parentName:"p"},"$distinct(array)")),Object(r.b)("p",null,"Returns an array containing all the values from the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter, but with any duplicates removed.  Values are tested for deep equality as if by using the ",Object(r.b)("a",{parentName:"p",href:"#equals"},"equality operator"),"."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$distinct([1,2,3,3,4,3,5])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[1, 2, 3, 4, 5]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$distinct(Account.Order.Product.Description.Colour)")," => ",Object(r.b)("inlineCode",{parentName:"li"},'[ "Purple", "Orange", "Black" ]'))),Object(r.b)("h2",{id:"zip"},Object(r.b)("inlineCode",{parentName:"h2"},"$zip()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$zip(array1, ...)")),Object(r.b)("p",null,"Returns a convolved (zipped) array containing grouped arrays of values from the ",Object(r.b)("inlineCode",{parentName:"p"},"array1")," ... ",Object(r.b)("inlineCode",{parentName:"p"},"arrayN")," arguments from index 0, 1, 2, etc."),Object(r.b)("p",null,"This function accepts a variable number of arguments.  The length of the returned array is equal to the length of the shortest array in the arguments."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$zip([1,2,3], [4,5,6])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[[1,4] ,[2,5], [3,6]]")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$zip([1,2,3],[4,5],[7,8,9])")," => ",Object(r.b)("inlineCode",{parentName:"li"},"[[1,4,7], [2,5,8]]"))),Object(r.b)("h1",{id:"object-functions"},"Object functions"),Object(r.b)("h2",{id:"keys"},Object(r.b)("inlineCode",{parentName:"h2"},"$keys()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$keys(object)")),Object(r.b)("p",null,"Returns an array containing the keys in the object.  If the argument is an array of objects, then the array returned contains a de-duplicated list of all the keys in all of the objects."),Object(r.b)("h2",{id:"lookup"},Object(r.b)("inlineCode",{parentName:"h2"},"$lookup()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$lookup(object, key)")),Object(r.b)("p",null,"Returns the value associated with ",Object(r.b)("inlineCode",{parentName:"p"},"key")," in ",Object(r.b)("inlineCode",{parentName:"p"},"object"),". If the first argument is an array of objects, then all of the objects in the array are searched, and the values associated with all occurrences of ",Object(r.b)("inlineCode",{parentName:"p"},"key")," are returned."),Object(r.b)("h2",{id:"spread"},Object(r.b)("inlineCode",{parentName:"h2"},"$spread()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$spread(object)")),Object(r.b)("p",null,"Splits an ",Object(r.b)("inlineCode",{parentName:"p"},"object")," containing key/value pairs into an array of objects, each of which has a single key/value pair from the input ",Object(r.b)("inlineCode",{parentName:"p"},"object"),".  If the parameter is an array of objects, then the resultant array contains an object for every key/value pair in every object in the supplied array."),Object(r.b)("h2",{id:"merge"},Object(r.b)("inlineCode",{parentName:"h2"},"$merge()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$merge(array<object>)")),Object(r.b)("p",null,"Merges an array of objects into a single object containing all the key/value pairs from each of the objects in the input array.  If any of the input objects contain the same key, then the returned object will contain the value of the last one in the array.  It is an error if the input array contains an item that is not an object."),Object(r.b)("h2",{id:"sift"},Object(r.b)("inlineCode",{parentName:"h2"},"$sift()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$sift(object, function)")),Object(r.b)("p",null,"See definition under 'Higher-order functions'"),Object(r.b)("h2",{id:"each"},Object(r.b)("inlineCode",{parentName:"h2"},"$each()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$each(object, function)")),Object(r.b)("p",null,"Returns an array containing the values return by the ",Object(r.b)("inlineCode",{parentName:"p"},"function")," when applied to each key/value pair in the ",Object(r.b)("inlineCode",{parentName:"p"},"object"),"."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"function")," parameter will get invoked with two arguments:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function(value, name)")),Object(r.b)("p",null,"where the ",Object(r.b)("inlineCode",{parentName:"p"},"value")," parameter is the value of each name/value pair in the object and ",Object(r.b)("inlineCode",{parentName:"p"},"name")," is its name.  The ",Object(r.b)("inlineCode",{parentName:"p"},"name")," parameter is optional."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},'$each(Address, function($v, $k) {$k & ": " & $v})')),Object(r.b)("p",null,"=>"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'[\n  "Street: Hursley Park",\n  "City: Winchester",\n  "Postcode: SO21 2JN"\n]\n')),Object(r.b)("h2",{id:"error"},Object(r.b)("inlineCode",{parentName:"h2"},"$error()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:"),Object(r.b)("inlineCode",{parentName:"p"},"$error(message)")),Object(r.b)("p",null,"Deliberately throws an error with an optional ",Object(r.b)("inlineCode",{parentName:"p"},"message")),Object(r.b)("h2",{id:"assert"},Object(r.b)("inlineCode",{parentName:"h2"},"$assert()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:"),Object(r.b)("inlineCode",{parentName:"p"},"$assert(condition, message)")),Object(r.b)("p",null,"If condition is true, the function returns undefined. If the condition is false, an exception is thrown with the message as the message of the exception."),Object(r.b)("h2",{id:"type"},Object(r.b)("inlineCode",{parentName:"h2"},"$type()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:"),Object(r.b)("inlineCode",{parentName:"p"},"$type(value)")),Object(r.b)("p",null,"Evaluates the type of ",Object(r.b)("inlineCode",{parentName:"p"},"value")," and returns one of the following strings:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"null"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"number"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"string"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"boolean"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"array"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"object"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'"function"'),"\nReturns (non-string) ",Object(r.b)("inlineCode",{parentName:"li"},"undefined")," when ",Object(r.b)("inlineCode",{parentName:"li"},"value")," is ",Object(r.b)("inlineCode",{parentName:"li"},"undefined"),".")),Object(r.b)("h1",{id:"datetime-functions"},"Date/Time functions"),Object(r.b)("h2",{id:"now"},Object(r.b)("inlineCode",{parentName:"h2"},"$now()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$now([picture [, timezone]])")),Object(r.b)("p",null,"Generates a UTC timestamp in ISO 8601 compatible format and returns it as a string.  All invocations of ",Object(r.b)("inlineCode",{parentName:"p"},"$now()")," within an evaluation of an expression will all return the same timestamp value."),Object(r.b)("p",null,"If the optional ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," and ",Object(r.b)("inlineCode",{parentName:"p"},"timezone")," parameters are supplied, then the current timestamp is formatted as described by the ",Object(r.b)("a",{parentName:"p",href:"#frommillis"},Object(r.b)("inlineCode",{parentName:"a"},"$fromMillis()"))," function."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$now()")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"2017-05-15T15:12:59.152Z"'))),Object(r.b)("h2",{id:"millis"},Object(r.b)("inlineCode",{parentName:"h2"},"$millis()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$millis()")),Object(r.b)("p",null,"Returns the number of milliseconds since the Unix ",Object(r.b)("em",{parentName:"p"},"Epoch")," (1 January, 1970 UTC) as a number.  All invocations of ",Object(r.b)("inlineCode",{parentName:"p"},"$millis()")," within an evaluation of an expression will all return the same value."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples"),"  "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$millis()")," => ",Object(r.b)("inlineCode",{parentName:"li"},"1502700297574"))),Object(r.b)("h2",{id:"frommillis"},Object(r.b)("inlineCode",{parentName:"h2"},"$fromMillis()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$fromMillis(number [, picture [, timezone]])")),Object(r.b)("p",null,"Convert the ",Object(r.b)("inlineCode",{parentName:"p"},"number")," representing milliseconds since the Unix ",Object(r.b)("em",{parentName:"p"},"Epoch")," (1 January, 1970 UTC) to a formatted string representation of the timestamp  as specified by the ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string."),Object(r.b)("p",null,"If the optional ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," parameter is omitted, then the timestamp is formatted in the ",Object(r.b)("a",{parentName:"p",href:"https://www.iso.org/iso-8601-date-and-time-format.html"},"ISO 8601")," format."),Object(r.b)("p",null,"If the optional ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string is supplied, then the timestamp is formatted occording to the representation specified in that string.\nThe behaviour of this function is consistent with the two-argument version of the XPath/XQuery function ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#func-format-dateTime"},"fn:format-dateTime")," as defined in the XPath F&O 3.1 specification.  The picture string parameter defines how the timestamp is formatted and has the ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#date-picture-string"},"same syntax")," as fn:format-dateTime."),Object(r.b)("p",null,"If the optional ",Object(r.b)("inlineCode",{parentName:"p"},"timezone")," string is supplied, then the formatted timestamp will be in that timezone.  The ",Object(r.b)("inlineCode",{parentName:"p"},"timezone"),' string should be in the\nformat "\xb1HHMM", where \xb1 is either the plus or minus sign and HHMM is the offset in hours and minutes from UTC.  Positive offset for timezones\neast of UTC, negative offset for timezones west of UTC. '),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$fromMillis(1510067557121)")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"2017-11-07T15:12:37.121Z"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$fromMillis(1510067557121, '[M01]/[D01]/[Y0001] [h#1]:[m01][P]')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"11/07/2017 3:12pm"')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$fromMillis(1510067557121, '[H01]:[m01]:[s01] [z]', '-0500')")," => ",Object(r.b)("inlineCode",{parentName:"li"},'"10:12:37 GMT-05:00"'))),Object(r.b)("h2",{id:"tomillis"},Object(r.b)("inlineCode",{parentName:"h2"},"$toMillis()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$toMillis(timestamp [, picture])")),Object(r.b)("p",null,"Convert a ",Object(r.b)("inlineCode",{parentName:"p"},"timestamp")," string to the number of milliseconds since the Unix ",Object(r.b)("em",{parentName:"p"},"Epoch")," (1 January, 1970 UTC) as a number. "),Object(r.b)("p",null,"If the optional ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string is not specified, then the format of the timestamp is assumed to be ",Object(r.b)("a",{parentName:"p",href:"https://www.iso.org/iso-8601-date-and-time-format.html"},"ISO 8601"),". An error is thrown if the string is not in the correct format."),Object(r.b)("p",null,"If the ",Object(r.b)("inlineCode",{parentName:"p"},"picture")," string is specified, then the format is assumed to be described by this picture string using the ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#date-picture-string"},"same syntax")," as the XPath/XQuery function ",Object(r.b)("a",{parentName:"p",href:"https://www.w3.org/TR/xpath-functions-31/#func-format-dateTime"},"fn:format-dateTime"),", defined in the XPath F&O 3.1 specification.  "),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},'$toMillis("2017-11-07T15:07:54.972Z")')," => ",Object(r.b)("inlineCode",{parentName:"li"},"1510067274972"))),Object(r.b)("h1",{id:"higher-order-functions-1"},"Higher order functions"),Object(r.b)("h2",{id:"map"},Object(r.b)("inlineCode",{parentName:"h2"},"$map()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$map(array, function)")),Object(r.b)("p",null,"Returns an array containing the results of applying the ",Object(r.b)("inlineCode",{parentName:"p"},"function")," parameter to each value in the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter."),Object(r.b)("p",null,"The function that is supplied as the second parameter must have the following signature:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function(value [, index [, array]])")),Object(r.b)("p",null,"Each value in the input array is passed in as the first parameter in the supplied function.  The index (position) of that value in the input array is passed in as the second parameter, if specified.  The whole input array is passed in as the third parameter, if specified."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Examples")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"$map([1..5], $string)")," => ",Object(r.b)("inlineCode",{parentName:"li"},'["1", "2", "3", "4", "5"]'))),Object(r.b)("p",null,"With user-defined (lambda) function:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"$map(Email.address, function($v, $i, $a) {\n   'Item ' & ($i+1) & ' of ' & $count($a) & ': ' & $v\n})\n")),Object(r.b)("p",null,"evaluates to:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'[\n  "Item 1 of 4: fred.smith@my-work.com",\n  "Item 2 of 4: fsmith@my-work.com",\n  "Item 3 of 4: freddy@my-social.com",\n  "Item 4 of 4: frederic.smith@very-serious.com"\n]\n')),Object(r.b)("h2",{id:"filter"},Object(r.b)("inlineCode",{parentName:"h2"},"$filter()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$filter(array, function)")),Object(r.b)("p",null,"Returns an array containing only the values in the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter that satisfy the ",Object(r.b)("inlineCode",{parentName:"p"},"function")," predicate (i.e. ",Object(r.b)("inlineCode",{parentName:"p"},"function")," returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," when passed the value)."),Object(r.b)("p",null,"The function that is supplied as the second parameter must have the following signature:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function(value [, index [, array]])")),Object(r.b)("p",null,"Each value in the input array is passed in as the first parameter in the supplied function.  The index (position) of that value in the input array is passed in as the second parameter, if specified.  The whole input array is passed in as the third parameter, if specified."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example"),"\nThe following expression returns all the products whose price is higher than average:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"$filter(Account.Order.Product, function($v, $i, $a) {\n  $v.Price > $average($a.Price)\n})\n")),Object(r.b)("h2",{id:"single"},Object(r.b)("inlineCode",{parentName:"h2"},"$single()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$single(array, function)")),Object(r.b)("p",null,"Returns the one and only one value in the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter that satisfy the ",Object(r.b)("inlineCode",{parentName:"p"},"function")," predicate (i.e. ",Object(r.b)("inlineCode",{parentName:"p"},"function")," returns Boolean ",Object(r.b)("inlineCode",{parentName:"p"},"true")," when passed the value).  Throws an exception if the number of matching values is not exactly one."),Object(r.b)("p",null,"The function that is supplied as the second parameter must have the following signature:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function(value [, index [, array]])")),Object(r.b)("p",null,"Each value in the input array is passed in as the first parameter in the supplied function.  The index (position) of that value in the input array is passed in as the second parameter, if specified.  The whole input array is passed in as the third parameter, if specified."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example"),"\nThe following expression the product in the order whose SKU is ",Object(r.b)("inlineCode",{parentName:"p"},'"0406654608"'),":"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'$single(Account.Order.Product, function($v, $i, $a) {\n  $v.SKU = "0406654608"\n})\n')),Object(r.b)("h2",{id:"reduce"},Object(r.b)("inlineCode",{parentName:"h2"},"$reduce()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$reduce(array, function [, init])")),Object(r.b)("p",null,"Returns an aggregated value derived from applying the ",Object(r.b)("inlineCode",{parentName:"p"},"function")," parameter successively to each value in ",Object(r.b)("inlineCode",{parentName:"p"},"array")," in combination with the result of the previous application of the function."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"function")," must accept at least two arguments, and behaves like an infix operator between each value within the ",Object(r.b)("inlineCode",{parentName:"p"},"array"),".  The signature of this supplied function must be of the form:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"myfunc($accumulator, $value[, $index[, $array]])")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"(\n  $product := function($i, $j){$i * $j};\n  $reduce([1..5], $product)\n)\n")),Object(r.b)("p",null,"This multiplies all the values together in the array ",Object(r.b)("inlineCode",{parentName:"p"},"[1..5]")," to return ",Object(r.b)("inlineCode",{parentName:"p"},"120"),"."),Object(r.b)("p",null,"If the optional ",Object(r.b)("inlineCode",{parentName:"p"},"init")," parameter is supplied, then that value is used as the initial value in the aggregation (fold) process.  If not supplied, the initial value is the first value in the ",Object(r.b)("inlineCode",{parentName:"p"},"array")," parameter."),Object(r.b)("h2",{id:"sift-1"},Object(r.b)("inlineCode",{parentName:"h2"},"$sift()")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Signature:")," ",Object(r.b)("inlineCode",{parentName:"p"},"$sift(object, function)")),Object(r.b)("p",null,"Returns an object that contains only the key/value pairs from the ",Object(r.b)("inlineCode",{parentName:"p"},"object")," parameter that satisfy the predicate ",Object(r.b)("inlineCode",{parentName:"p"},"function")," passed in as the second parameter."),Object(r.b)("p",null,"If ",Object(r.b)("inlineCode",{parentName:"p"},"object")," is not specified, then the context value is used as the value of ",Object(r.b)("inlineCode",{parentName:"p"},"object"),".  It is an error if ",Object(r.b)("inlineCode",{parentName:"p"},"object")," is not an object."),Object(r.b)("p",null,"The function that is supplied as the second parameter must have the following signature:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"function(value [, key [, object]])")),Object(r.b)("p",null,"Each value in the input object is passed in as the first parameter in the supplied function.  The key (property name) of that value in the input object is passed in as the second parameter, if specified.  The whole input object is passed in as the third parameter, if specified."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Example")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"Account.Order.Product.$sift(function($v, $k) {$k ~> /^Product/})\n")),Object(r.b)("p",null,"This sifts each of the ",Object(r.b)("inlineCode",{parentName:"p"},"Product"),' objects such that they only contain the fields whose keys start with the string "Product" (using a regex). This example returns:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},'[\n  {\n    "Product Name": "Bowler Hat",\n    "ProductID": 858383\n  },\n  {\n    "Product Name": "Trilby hat",\n    "ProductID": 858236\n  },\n  {\n    "Product Name": "Bowler Hat",\n    "ProductID": 858383\n  },\n  {\n    "ProductID": 345664,\n    "Product Name": "Cloak"\n  }\n]\n')))}s.isMDXComponent=!0},388:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),p=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,b=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),s=p(n),d=a,m=s["".concat(b,".").concat(d)]||s[d]||u[d]||r;return n?i.a.createElement(m,l(l({ref:t},c),{},{components:n})):i.a.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,b=new Array(r);b[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,b[1]=l;for(var c=2;c<r;c++)b[c]=n[c];return i.a.createElement.apply(null,b)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);