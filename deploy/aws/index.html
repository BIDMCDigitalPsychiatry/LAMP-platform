<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-deploy/aws" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.0">
<title data-rh="true">Preparing Resources on AWS | LAMP Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.lamp.digital/logo.png"><meta data-rh="true" name="twitter:image" content="https://docs.lamp.digital/logo.png"><meta data-rh="true" property="og:url" content="https://docs.lamp.digital/deploy/aws"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Preparing Resources on AWS | LAMP Platform"><meta data-rh="true" name="description" content="Although AWS is not strictly required, it is highly recommended. If you choose not to use AWS resources, members from the mindLAMP team will not be able to provide support or answer questions."><meta data-rh="true" property="og:description" content="Although AWS is not strictly required, it is highly recommended. If you choose not to use AWS resources, members from the mindLAMP team will not be able to provide support or answer questions."><link data-rh="true" rel="icon" href="/logo.png"><link data-rh="true" rel="canonical" href="https://docs.lamp.digital/deploy/aws"><link data-rh="true" rel="alternate" href="https://docs.lamp.digital/deploy/aws" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.lamp.digital/deploy/aws" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="LAMP Platform RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="LAMP Platform Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="LAMP Platform JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-192736629-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.49a494fd.css">
<script src="/assets/js/runtime~main.44ec7866.js" defer="defer"></script>
<script src="/assets/js/main.eacbe3dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="LAMP Platform" class="themedComponent__dKv themedComponent--light_rzkv"><img src="/logo.png" alt="LAMP Platform" class="themedComponent__dKv themedComponent--dark_mMAk"></div><b class="navbar__title text--truncate">LAMP Platform</b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/">User Guide</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/app">Download App</a></li><li><a class="dropdown__link" href="/bug">Report Bug</a></li><li><a class="dropdown__link" href="/faq">FAQ</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">What&#x27;s New</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://mindlamp.discourse.group/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/BIDMCDigitalPsychiatry/LAMP-platform/" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="mailto:team@digitalpsych.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Contact<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">LAMP Platform</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/app">Quick Links</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/about/intro">Users and Publications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/using/learn">How to use mindLAMP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/start_here/overview">Setting up mindLAMP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/deploy/prereqs">Deploying LAMP</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/prereqs">Prerequisites for Deploying the LAMP Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/recs">Deployment Recommendations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/costs">Costs of Deploying the LAMP Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/provisioning">Provisioning the LAMP Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/deploy/aws">Preparing Resources on AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/cloudformation">Deploying via CloudFormation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/deploying">Deploying the LAMP Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/testing">Testing the LAMP Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/troubleshooting">Troubleshooting Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/passwords">Complex Password Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/configure_oauth_google">Configure OAuth for Google</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/deploy/enabling_sensors_and_activities">Configuring your server to add Sensors and Activities</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/develop/intro">Developing LAMP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/data_science/intro">Cortex &amp; API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/consortium/admin/checklist">Consortium</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/troubleshooting">Troubleshooting</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deploying LAMP</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Preparing Resources on AWS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Preparing Resources on AWS</h1></header>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Although AWS is not strictly required, it is highly recommended. If you choose not to use AWS resources, members from the mindLAMP team will not be able to provide support or answer questions.</p></div></div>
<p>The following instructions will result in a Docker Swarm setup prepared to deploy LAMP. You will need to continue following the instructions after this phase to successfully configure LAMP.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Untitled_AWS-3d6dab11c58abe7d166f0f2215a33889.png" width="1920" height="1080" class="img_ev3q"></p>
<p><em>Digital Psychiatry&#x27;s AWS Network Diagram for the LAMP Platform</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-ec2-instances-only">For EC2 Instances Only:<a href="#for-ec2-instances-only" class="hash-link" aria-label="Direct link to For EC2 Instances Only:" title="Direct link to For EC2 Instances Only:">​</a></h3>
<p>A <strong>HARD</strong> requirement for the successful operation of the LAMP Platform is the use of a high performance SSD volume. For more information on these hard limitations and requirements, <a href="https://docs.mongodb.com/manual/administration/production-notes/" target="_blank" rel="noopener noreferrer">see the MongoDB documentation here.</a></p>
<ol>
<li>Required maximum (saturable) disk bandwidth: <code>4750 Mbps</code></li>
<li>Required maximum disk throughput: <code>593.75 MB/s</code></li>
<li>Required maximum disk I/O operations: <code>20000 IOPS</code></li>
<li>Required minimum disk throughput: <code>125 MB/s</code></li>
<li>Required minimum disk I/O operations: <code>3000 IOPS</code></li>
<li>Required minimum disk space: <code>64 GB</code></li>
</ol>
<p>If using AWS, provisioning a DocumentDB cluster is the simplest way to achieve these baseline requirements for efficient and accurate data collection with no database outages or upload rejections.</p>
<p><strong>You must replace the value of <code>MY_DNS_NAME</code> in the commands below.</strong></p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token list punctuation" style="color:rgb(199, 146, 234)">1.</span><span class="token plain"> Create an EC2 instance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; AMI: AWS Linux 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Instance Type: [MINIMUM] t2.medium</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Create a new IAM role with the </span><span class="token code-snippet code keyword" style="font-style:italic">`AmazonSSMManagedInstanceCore`</span><span class="token plain"> policy.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Enable termination protection.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Create a [RECOMMENDED] 1TB EBS volume WITH encryption enabled.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Configure security group:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; HTTP: TCP 80 from anywhere</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; HTTPS: TCP 443 from anywhere</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; Docker Daemon: TCP 2375 from this Security Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; Docker Machine: TCP 2376 from this Security Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; Docker Swarm: TCP 2377 from this Security Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; Docker Swarm: TCP 7946 from this Security Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; Docker Swarm: UDP 7946 from this Security Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						-&gt; Docker Overlay: UDP 4789 from this Security Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Create a new key pair and keep it private.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				-&gt; Allocate and assign an elastic IP to the instance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token list punctuation" style="color:rgb(199, 146, 234)">2.</span><span class="token plain"> Run the following commands in the instance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				sudo yum -y update &amp;&amp; sudo yum -y install docker -y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				sudo usermod -a -G docker ec2-user</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				sudo hostnamectl set-hostname </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">MY_DNS_NAME</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				sudo printf &quot;[Service]\nExecStart=\nExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H fd:// --containerd=/run/containerd/containerd.sock\n&quot; | sudo tee /etc/systemd/system/docker.service.d/override.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				sudo systemctl daemon-reload &amp;&amp; sudo service docker restart</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				sudo docker swarm init</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token list punctuation" style="color:rgb(199, 146, 234)">3.</span><span class="token plain"> Create your DNS binding in Route53.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ec2-commands">EC2 Commands<a href="#ec2-commands" class="hash-link" aria-label="Direct link to EC2 Commands" title="Direct link to EC2 Commands">​</a></h3>
<p>The following is a set of bash commands to be used from within AWS Systems Manager once a new EC2 instance and EBS volume are created with the AWS SSM IAM role.</p>
<p><strong>DO NOT USE THIS AS A SCRIPT!
THOROUGHLY READ IT AND RUN EACH COMMAND INDIVIDUALLY!
SUBSTITUTE ALL VARIABLES BEFORE CONTINUING!</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Assumes nvme1n1 is the name of the EBS volume. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Use lsblk to confirm this before running the script.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Attach EBS volume and configure auto-reattach on restart.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkfs -t xfs /dev/nvme1n1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir /data &amp;&amp; mount /dev/nvme1n1 /data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">printf &quot;\nUUID=$(blkid -s UUID -o value /dev/nvme1n1)     /data       xfs    defaults,nofail   0   2&quot; &gt;&gt; /etc/fstab</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">umount /data &amp;&amp; mount -a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Install Docker and move Docker root to EBS volume.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">yum install docker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p /data/var/lib/docker &amp;&amp; ln -s /data/var/lib/docker /var/lib/docker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set hostname before starting Docker and join the Swarm.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hostnamectl set-hostname node-01.example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service docker start</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker swarm join --token SWARM_TOKEN IP_ADDR:2377</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>In case your EBS volume runs out of storage space, follow the instructions below:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># expand the EBS volume using the AWS management console first</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lsblk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">growpart /dev/nvme1n1 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">xfs_growfs -d /data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-ssm-instructions">AWS SSM Instructions<a href="#aws-ssm-instructions" class="hash-link" aria-label="Direct link to AWS SSM Instructions" title="Direct link to AWS SSM Instructions">​</a></h3>
<p>We recommend disabling all SSH (port 22) or remote access to any EC2 instances you configure. <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-start.html#start-ec2-console" target="_blank" rel="noopener noreferrer">Use AWS Systems Session Manager (AWS SSM) to access your node.</a> Additionally, follow the instructions below on your local computer to securely communicate with the instance(s).</p>
<ol>
<li>
<p><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html" target="_blank" rel="noopener noreferrer">Install the AWS CLI SSM plugin.</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-getting-started-enable-ssh-connections.html" target="_blank" rel="noopener noreferrer">Configure SSH to support AWS SSM tunneling.</a></p>
</li>
<li>
<p>Alternatively, manually open a port forwarding tunnel.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws ssm start-session \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	--target $(aws ec2 describe-instances \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		--filter &quot;Name=tag:Name,Values=node-01&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		--query &quot;Reservations[].Instances[?State.Name == &#x27;running&#x27;].InstanceId[]&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		--output text) \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	--document-name AWS-StartPortForwardingSession \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	--parameters &#x27;{ &quot;portNumber&quot;: [&quot;22&quot;], &quot;localPortNumber&quot;: [&quot;9999&quot;] }&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Alternatively, manually open a secure SSH tunnel session.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws ssm start-session \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	--target $(aws ec2 describe-instances \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		--filter &quot;Name=tag:Name,Values=node-01&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		--query &quot;Reservations[].Instances[?State.Name == &#x27;running&#x27;].InstanceId[]&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		--output text) \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	--document-name AWS-StartSSHSession \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	--parameters &#x27;portNumber=%p&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-aws-documentdb-instead-of-mongodb-coming-soon">Using AWS DocumentDB instead of MongoDB (Coming Soon)<a href="#using-aws-documentdb-instead-of-mongodb-coming-soon" class="hash-link" aria-label="Direct link to Using AWS DocumentDB instead of MongoDB (Coming Soon)" title="Direct link to Using AWS DocumentDB instead of MongoDB (Coming Soon)">​</a></h3>
<p>The Division of Digital Psychiatry has been working closely with Solutions Architects at Amazon Web Services (AWS) to improve performance and reliability, as well as reduce maintenance overhead and IT skills required for deployment. For this reason, we support MongoDB in addition to the Apache CouchDB database. AWS offers a managed solution for MongoDB databases called DocumentDB that abstracts and simplifies all MongoDB database setup and operations needs, including routine backups and HIPAA-compliant encryption of data at rest and in transit.</p>
<p>DocumentDB is a high performance database solution built on the AWS Aurora technology that supports global replicated clusters that span across multiple regions (i.e. U.S. East and Mumbai, for example) and up to 15 read replicas in a single region. This provides high availability and performance for the LAMP API and in turn the clinical dashboard and mobile apps that are built upon it.</p>
<p>This advanced technology and other AWS managed solutions are natively integrated into the LAMP Platform and the Cortex data analysis toolkit, enabling both advanced clinical care management features (such as just-in-time adaptive interventions) and advanced research/data analysis methods.</p>
<p><strong>We are working closely with Amazon Web Services (AWS) to bring this feature to all organizations using the LAMP Platform. If you or your organization are interested, please contact us.</strong></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/BIDMCDigitalPsychiatry/LAMP-platform/edit/master/docs/07-deploy/05-aws.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-11-19T19:16:36.000Z" itemprop="dateModified">Nov 19, 2024</time></b> by <b>Juan</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/deploy/provisioning"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Provisioning the LAMP Platform</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/deploy/cloudformation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploying via CloudFormation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#for-ec2-instances-only" class="table-of-contents__link toc-highlight">For EC2 Instances Only:</a></li><li><a href="#ec2-commands" class="table-of-contents__link toc-highlight">EC2 Commands</a></li><li><a href="#aws-ssm-instructions" class="table-of-contents__link toc-highlight">AWS SSM Instructions</a></li><li><a href="#using-aws-documentdb-instead-of-mongodb-coming-soon" class="table-of-contents__link toc-highlight">Using AWS DocumentDB instead of MongoDB (Coming Soon)</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">2024 LAMP Consortium & Division of Digital Psychiatry @ BIDMC</div></div></div></footer></div>
</body>
</html>